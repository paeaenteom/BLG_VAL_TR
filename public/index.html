<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="BLG Tracker">
<meta name="theme-color" content="#07070c">
<meta name="mobile-web-app-capable" content="yes">
<title>BLG VALORANT ‚Äî Ïã§ÏãúÍ∞Ñ ÎåÄÏ†Ñ Í∏∞Î°ù</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0%25' stop-color='%2300d4ff'/%3E%3Cstop offset='100%25' stop-color='%230088ff'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='64' height='64' rx='14' fill='%230d1117'/%3E%3Crect x='2' y='2' width='60' height='60' rx='12' fill='none' stroke='url(%23g)' stroke-width='2.5'/%3E%3Ctext x='32' y='44' text-anchor='middle' font-family='Arial Black,sans-serif' font-weight='900' font-size='32' fill='url(%23g)'%3EBLG%3C/text%3E%3C/svg%3E">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Orbitron:wght@400;500;700;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#07070c;--surface:#0f0f18;--s2:#161622;--s3:#1e1e30;--s4:#282840;--blue:#00a1d6;--blue-d:rgba(0,161,214,.15);--pink:#fb7299;--pink-d:rgba(251,114,153,.15);--win:#22c55e;--win-bg:rgba(34,197,94,.08);--win-b:rgba(34,197,94,.25);--loss:#ef4444;--loss-bg:rgba(239,68,68,.08);--loss-b:rgba(239,68,68,.25);--gold:#fbbf24;--gold-bg:rgba(251,191,36,.08);--gold-b:rgba(251,191,36,.25);--cyan:#06b6d4;--cyan-bg:rgba(6,182,212,.08);--cyan-b:rgba(6,182,212,.25);--txt:#e4e4f0;--dim:#8585a8;--dimmer:#4e4e6a;--brd:rgba(255,255,255,.05);--brd2:rgba(255,255,255,.08)}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--txt);font-family:'Noto Sans KR',sans-serif;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.025'/%3E%3C/svg%3E");pointer-events:none;z-index:9999}

/* HERO */
.hero{position:relative;padding:48px 24px 28px;text-align:center;overflow:hidden}
.hero::before{content:'';position:absolute;top:-220px;left:50%;transform:translateX(-50%);width:900px;height:600px;background:radial-gradient(ellipse,rgba(0,161,214,.18),transparent 55%),radial-gradient(ellipse at 35% 55%,rgba(251,114,153,.14),transparent 50%);filter:blur(90px);pointer-events:none}
.badge{display:inline-flex;align-items:center;gap:8px;padding:5px 14px;border-radius:100px;background:var(--blue-d);border:1px solid rgba(0,161,214,.25);font-family:'JetBrains Mono',monospace;font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--blue);margin-bottom:16px;animation:fi .5s ease}
.badge .dot{width:6px;height:6px;border-radius:50%;background:var(--blue);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.hero h1{font-family:'Orbitron',sans-serif;font-weight:900;font-size:clamp(28px,5.5vw,50px);letter-spacing:-1px;animation:fi .5s ease .05s both}
.hero h1 .blg{background:linear-gradient(135deg,var(--blue),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-sub{font-size:13px;color:var(--dim);margin-top:10px;font-weight:300;animation:fi .5s ease .1s both}
.hero-sub strong{color:var(--txt);font-weight:500}
@keyframes fi{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

/* LIVE BAR */
.live-bar{display:flex;align-items:center;justify-content:center;gap:10px;padding:10px;margin:0 auto 8px;max-width:600px;flex-wrap:wrap;animation:fi .5s ease .15s both}
.live-dot{width:8px;height:8px;border-radius:50%;background:var(--win);box-shadow:0 0 8px var(--win);animation:lp 1.5s infinite}
.live-dot.loading{background:var(--blue);box-shadow:0 0 8px var(--blue)}
.live-dot.error{background:var(--loss);box-shadow:0 0 8px var(--loss);animation:none}
@keyframes lp{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.8)}}
.live-text{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--dim)}
.refresh-btn{padding:4px 12px;border-radius:6px;border:1px solid var(--brd2);background:transparent;color:var(--blue);font-family:'JetBrains Mono',monospace;font-size:11px;cursor:pointer;transition:all .2s}
.refresh-btn:hover{background:var(--blue-d);border-color:var(--blue)}
.refresh-btn:disabled{opacity:.4;cursor:not-allowed}
.spin-i{display:inline-block;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* STATS */
.stats-bar{display:flex;justify-content:center;gap:28px;padding:20px 24px;margin:0 auto 12px;max-width:750px;flex-wrap:wrap;animation:fi .5s ease .2s both}
.si{text-align:center}.sv{font-family:'Orbitron',sans-serif;font-size:26px;font-weight:700}
.sv.wc{color:var(--win)}.sv.lc{color:var(--loss)}.sv.bc{color:var(--blue)}
.sl{font-size:10px;color:var(--dimmer);text-transform:uppercase;letter-spacing:1.5px;margin-top:3px;font-family:'JetBrains Mono',monospace}

/* ===== UPCOMING SECTION ===== */
.upcoming-section{max-width:920px;margin:0 auto 28px;padding:0 24px;animation:fi .5s ease .25s both}
.upcoming-title{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.upcoming-title h2{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:700;color:var(--cyan)}
.upcoming-title .live-badge{font-size:9px;padding:3px 10px;border-radius:100px;background:var(--cyan-bg);border:1px solid var(--cyan-b);color:var(--cyan);font-family:'JetBrains Mono',monospace;letter-spacing:1px;text-transform:uppercase;animation:pulse 2s infinite}
.upcoming-card{padding:20px;border-radius:12px;background:linear-gradient(135deg,var(--surface),var(--s2));border:1px solid var(--cyan-b);position:relative;overflow:hidden;margin-bottom:8px}
.upcoming-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--cyan),var(--blue),var(--pink));border-radius:2px 2px 0 0}
.upcoming-card .uc-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px}
.uc-event{font-size:13px;font-weight:700;color:var(--txt)}
.uc-date{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--cyan)}
.uc-teams{display:flex;align-items:center;justify-content:center;gap:20px;margin-bottom:14px}
.uc-team{text-align:center;min-width:80px}
.uc-team-name{font-family:'Orbitron',sans-serif;font-weight:700;font-size:16px;margin-bottom:2px}
.uc-team-name.blg{color:var(--blue)}
.uc-team-sub{font-size:10px;color:var(--dimmer);font-family:'JetBrains Mono',monospace}
.uc-vs{font-family:'Orbitron',sans-serif;font-size:20px;font-weight:900;color:var(--dimmer)}
.uc-info{display:flex;gap:6px;flex-wrap:wrap;justify-content:center}
.uc-tag{font-size:10px;padding:3px 10px;border-radius:5px;background:var(--s3);color:var(--dim);font-family:'JetBrains Mono',monospace}
.uc-tag.tbd{background:var(--cyan-bg);color:var(--cyan);border:1px solid var(--cyan-b)}
/* countdown */
.countdown-row{display:flex;justify-content:center;gap:12px;margin-top:14px}
.cd-block{text-align:center;min-width:48px}
.cd-num{font-family:'Orbitron',sans-serif;font-size:20px;font-weight:700;color:var(--cyan)}
.cd-label{font-size:9px;color:var(--dimmer);font-family:'JetBrains Mono',monospace;letter-spacing:1px;text-transform:uppercase}

/* Group preview */
.group-preview{margin-top:12px;padding:14px;border-radius:8px;background:var(--surface);border:1px solid var(--brd)}
.gp-title{font-size:10px;font-family:'JetBrains Mono',monospace;color:var(--dimmer);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.gp-title::before{content:'';width:12px;height:2px;background:var(--cyan);border-radius:1px}
.gp-teams{display:flex;gap:6px;flex-wrap:wrap}
.gp-team{font-size:11px;padding:4px 10px;border-radius:5px;background:var(--s3);color:var(--dim);font-family:'JetBrains Mono',monospace;transition:all .2s}
.gp-team.self{background:var(--blue-d);color:var(--blue);border:1px solid rgba(0,161,214,.3);font-weight:700}

/* YEAR TABS */
.year-tabs{display:flex;justify-content:center;gap:4px;padding:0 24px 24px;flex-wrap:wrap;animation:fi .5s ease .3s both}
.yt{padding:10px 28px;border-radius:10px;border:1px solid var(--brd);background:transparent;color:var(--dim);font-family:'Orbitron',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .25s;position:relative}
.yt:hover{border-color:rgba(0,161,214,.3);color:var(--blue)}
.yt.active{background:var(--blue-d);border-color:var(--blue);color:var(--blue)}
.yt .cnt{position:absolute;top:-6px;right:-6px;background:var(--pink);color:#fff;font-size:9px;padding:1px 6px;border-radius:10px;font-family:'JetBrains Mono',monospace}

/* MAIN */
.main{max-width:920px;margin:0 auto;padding:0 24px 60px}
.ys{display:none}.ys.active{display:block;animation:si .3s ease}
@keyframes si{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.yh{display:flex;align-items:center;gap:16px;margin-bottom:20px;padding:0 4px}
.yn{font-family:'Orbitron',sans-serif;font-size:48px;font-weight:900;background:linear-gradient(180deg,var(--blue),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;opacity:.3;line-height:1}
.ysm{font-size:12px;color:var(--dim);font-family:'JetBrains Mono',monospace}.ysm span{font-weight:700}.ysm .w{color:var(--win)}.ysm .l{color:var(--loss)}
.tg{margin-bottom:28px}
.th{display:flex;align-items:center;gap:10px;margin-bottom:8px;padding:0 2px;flex-wrap:wrap}
.tb{width:3px;height:20px;border-radius:2px;background:linear-gradient(180deg,var(--blue),var(--pink))}.tb.intl{background:linear-gradient(180deg,#fbbf24,#f59e0b)}
.tn{font-size:13px;font-weight:700;letter-spacing:.3px}
.tbg{font-size:9px;padding:2px 8px;border-radius:4px;font-family:'JetBrains Mono',monospace;background:var(--s3);color:var(--dim)}.tbg.intl{background:rgba(251,191,36,.1);color:#fbbf24}

/* MATCH CARD */
.mw{margin-bottom:4px}
.mc{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:12px;padding:14px 18px;padding-right:36px;border-radius:10px;background:var(--surface);border:1px solid var(--brd);transition:all .25s;cursor:pointer;position:relative}
.mw.open .mc{border-radius:10px 10px 0 0;border-bottom-color:transparent;background:var(--s2)}
.mc:hover{border-color:rgba(0,161,214,.2);background:var(--s2)}
.mc.win{border-left:3px solid var(--win)}.mc.loss{border-left:3px solid var(--loss)}
.ea{position:absolute;right:14px;top:50%;transform:translateY(-50%);font-size:10px;color:var(--dimmer);transition:transform .35s cubic-bezier(.4,0,.2,1);width:20px;height:20px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:var(--s3)}
.mw.open .ea{transform:translateY(-50%) rotate(180deg);background:var(--blue-d);color:var(--blue)}
.tl{display:flex;align-items:center;gap:10px;min-width:0}.tr{display:flex;align-items:center;gap:10px;justify-content:flex-end;min-width:0}
.tm{font-weight:700;font-size:14px}.tm.blg{color:var(--blue)}
.tt{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--dimmer)}
.scc{text-align:center;min-width:76px}
.sc{font-family:'Orbitron',sans-serif;font-size:20px;font-weight:700;letter-spacing:2px}
.sc .ws{color:var(--win)}.sc .ls{color:var(--loss)}.sc .sp{color:var(--dimmer);margin:0 3px;font-size:14px}
.sm{font-size:9px;color:var(--dimmer);font-family:'JetBrains Mono',monospace;margin-top:2px}
.rb{display:inline-block;padding:1px 8px;border-radius:3px;font-family:'Orbitron',sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;margin-top:3px}
.rb.win{background:var(--win-bg);color:var(--win);border:1px solid var(--win-b)}.rb.loss{background:var(--loss-bg);color:var(--loss);border:1px solid var(--loss-b)}
.mr{grid-column:1/-1;display:flex;gap:5px;flex-wrap:wrap;margin-top:4px;justify-content:center}
.mp{font-size:9px;padding:2px 7px;border-radius:3px;font-family:'JetBrains Mono',monospace;background:var(--s3);color:var(--dim)}.mp.mw2{color:var(--win);background:var(--win-bg)}.mp.ml2{color:var(--loss);background:var(--loss-bg)}
.sr{grid-column:1/-1;display:flex;justify-content:center;align-items:center;gap:8px;margin-top:2px}
.sb{font-size:10px;color:var(--dim);padding:2px 10px;border-radius:4px;background:var(--s3)}
.vod-btn{display:inline-flex;align-items:center;gap:3px;padding:3px 9px;border-radius:5px;background:rgba(255,0,0,.1);border:1px solid rgba(255,0,0,.2);color:#ff6b6b;font-size:10px;font-family:'JetBrains Mono',monospace;font-weight:600;text-decoration:none;transition:all .2s;letter-spacing:.3px;cursor:pointer}
.vod-btn:hover{background:rgba(255,0,0,.2);border-color:rgba(255,0,0,.35);color:#ff8a8a;transform:translateY(-1px)}

/* VOD MODAL */
.vod-overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(12px);z-index:10000;display:none;align-items:center;justify-content:center;animation:vodFi .25s ease}
.vod-overlay.active{display:flex}
@keyframes vodFi{from{opacity:0}to{opacity:1}}
.vod-modal{position:relative;width:90vw;max-width:960px;background:var(--s2);border:1px solid var(--brd2);border-radius:16px;overflow:hidden;box-shadow:0 40px 80px rgba(0,0,0,.6)}
.vod-modal-header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid var(--brd);background:var(--surface)}
.vod-modal-title{font-size:13px;font-weight:600;color:var(--txt);display:flex;align-items:center;gap:8px}
.vod-modal-title .vod-icon{font-size:16px}
.vod-close{width:32px;height:32px;border-radius:8px;border:1px solid var(--brd2);background:var(--s3);color:var(--dim);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.vod-close:hover{background:var(--loss-bg);border-color:var(--loss-b);color:var(--loss)}
.vod-body{position:relative;width:100%;aspect-ratio:16/9;background:#000;overflow:hidden}
.vod-body iframe{width:100%;height:100%;border:none}
.bili-parts{background:var(--s2);padding:10px 14px;border-top:1px solid var(--brd)}
.bili-parts-label{font-size:11px;color:var(--dim);margin-bottom:6px;padding-left:2px}
.bili-parts-list{display:flex;gap:6px;overflow-x:auto;padding-bottom:4px;scrollbar-width:thin}
.bili-parts-list::-webkit-scrollbar{height:4px}
.bili-parts-list::-webkit-scrollbar-thumb{background:var(--s4);border-radius:2px}
.bili-part-btn{flex-shrink:0;padding:6px 12px;border-radius:8px;border:1px solid var(--s4);background:var(--s3);color:var(--dim);font-size:11px;cursor:pointer;transition:all .2s;white-space:nowrap}
.bili-part-btn:hover{border-color:var(--cyan);color:var(--txt)}
.bili-part-btn.active{background:rgba(0,212,255,.15);border-color:var(--cyan);color:var(--cyan);font-weight:600}
.vod-loading{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;color:var(--dim);font-size:13px}
.vod-spinner{width:36px;height:36px;border:3px solid var(--s4);border-top-color:var(--pink);border-radius:50%;animation:spin .7s linear infinite}
.vod-error{text-align:center;padding:8px 16px}
.vod-error a{color:var(--pink);text-decoration:underline}
.vod-match-info{padding:10px 20px;border-top:1px solid var(--brd);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.vod-match-label{font-size:11px;color:var(--dim);font-family:'JetBrains Mono',monospace}
.vod-yt-link{font-size:11px;color:#ff6b6b;text-decoration:none;font-family:'JetBrains Mono',monospace;display:flex;align-items:center;gap:4px;transition:color .2s;padding:4px 10px;border-radius:6px;background:rgba(255,0,0,.08);border:1px solid rgba(255,0,0,.15)}
.vod-yt-link:hover{color:#ff8a8a;background:rgba(255,0,0,.15)}
.vod-bili-link{font-size:11px;color:#00a1d6;text-decoration:none;font-family:'JetBrains Mono',monospace;display:flex;align-items:center;gap:4px;transition:color .2s;padding:4px 10px;border-radius:6px;background:rgba(0,161,214,.08);border:1px solid rgba(0,161,214,.15)}
.vod-bili-link:hover{color:#23c9ed;background:rgba(0,161,214,.15)}
.vod-links{display:flex;gap:8px;align-items:center}
.vod-platform-tabs{display:flex;gap:0;margin:0 20px;border-bottom:1px solid var(--brd)}
.vod-tab{padding:8px 16px;font-size:12px;font-family:'JetBrains Mono',monospace;font-weight:600;cursor:pointer;border:none;background:none;color:var(--dim);border-bottom:2px solid transparent;transition:all .2s}
.vod-tab:hover{color:var(--txt)}
.vod-tab.active{color:#ff6b6b;border-bottom-color:#ff6b6b}
.vod-tab.bili.active{color:#00a1d6;border-bottom-color:#00a1d6}

/* DETAIL PANEL */
.dp{max-height:0;overflow:hidden;transition:max-height .45s cubic-bezier(.4,0,.2,1),opacity .3s;opacity:0}
.mw.open .dp{max-height:2200px;opacity:1}
.di{padding:20px;background:linear-gradient(180deg,var(--s2),var(--surface));border:1px solid var(--brd);border-top:1px dashed var(--brd2);border-radius:0 0 10px 10px}
/* Map detail */
.dms{margin-bottom:18px}.dmt{font-size:10px;font-family:'JetBrains Mono',monospace;color:var(--dimmer);text-transform:uppercase;letter-spacing:2px;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.dmt::before{content:'';width:16px;height:2px;background:var(--blue);border-radius:1px}
.md{display:flex;align-items:center;gap:10px;padding:10px 14px;margin-bottom:3px;border-radius:8px;background:var(--surface);border:1px solid var(--brd);transition:background .2s}
.md:hover{background:var(--s2)}
.md-n{font-family:'Orbitron',sans-serif;font-size:9px;color:var(--dimmer);width:44px;text-align:center;flex-shrink:0}
.md-m{font-size:12px;font-weight:700;width:68px;flex-shrink:0}
.md-bw{flex:1;min-width:80px}.md-bar{flex:1;height:5px;border-radius:3px;background:var(--s4);overflow:hidden}
.md-bf{height:100%;border-radius:3px;transition:width .8s cubic-bezier(.4,0,.2,1) .2s}
.md-bf.bw{background:linear-gradient(90deg,var(--win),#4ade80)}.md-bf.bl{background:linear-gradient(90deg,var(--loss),#f87171)}
.md-s{font-family:'Orbitron',sans-serif;font-size:14px;font-weight:700;min-width:52px;text-align:center}.md-s .mws{color:var(--win)}.md-s .mls{color:var(--loss)}.md-s .msp{color:var(--dimmer);margin:0 2px;font-size:10px}
.md-r{font-size:9px;font-family:'Orbitron',sans-serif;font-weight:700;padding:2px 8px;border-radius:3px;min-width:32px;text-align:center}
.md-r.rw{background:var(--win-bg);color:var(--win);border:1px solid var(--win-b)}.md-r.rl{background:var(--loss-bg);color:var(--loss);border:1px solid var(--loss-b)}
/* Narrative */
.dn{padding:16px 18px;border-radius:8px;background:var(--surface);border:1px solid var(--brd)}
.dnt{font-size:10px;font-family:'JetBrains Mono',monospace;color:var(--blue);text-transform:uppercase;letter-spacing:2px;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.dnt::before{content:'';display:inline-block;width:8px;height:8px;border-radius:2px;background:linear-gradient(135deg,var(--blue),var(--pink))}
.dtx{font-size:13px;line-height:1.8;color:var(--dim)}.dtx strong{color:var(--txt);font-weight:600}
.dmeta{display:flex;gap:6px;flex-wrap:wrap;margin-top:14px}
.mt{font-size:10px;padding:4px 10px;border-radius:5px;background:var(--s3);color:var(--dim);font-family:'JetBrains Mono',monospace}
.mt.mtwn{background:var(--win-bg);color:var(--win);border:1px solid var(--win-b)}.mt.mtls{background:var(--loss-bg);color:var(--loss);border:1px solid var(--loss-b)}.mt.mtil{background:var(--gold-bg);color:var(--gold);border:1px solid var(--gold-b)}

.loading-state{text-align:center;padding:60px 20px}.loader{width:40px;height:40px;border:3px solid var(--s3);border-top-color:var(--blue);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 16px}.loading-text{color:var(--dimmer);font-size:13px}
.footer{text-align:center;padding:32px 24px;font-size:11px;color:var(--dimmer);border-top:1px solid var(--brd)}.footer a{color:var(--blue);text-decoration:none}

@media(max-width:600px){.mc{grid-template-columns:1fr;gap:6px;text-align:center;padding-right:36px}.tl,.tr{justify-content:center}.stats-bar{gap:16px}.sv{font-size:20px}.yn{font-size:36px}.yt{padding:8px 18px;font-size:12px}.md{flex-wrap:wrap;gap:6px}.md-bw{min-width:100%;order:10}.md-n{width:auto}.md-m{width:auto}.uc-teams{gap:12px}}
/* TEAM LOGOS */
.tlogo{width:24px;height:24px;object-fit:contain;border-radius:4px;flex-shrink:0;vertical-align:middle}
.tlogo.lg{width:32px;height:32px}
.tlogo.big{width:44px;height:44px;border-radius:6px}
.tlogo-ph.big{width:44px;height:44px;font-size:16px;border-radius:6px}
.tlogo.sm{width:18px;height:18px;border-radius:3px}
.tlogo-ph{display:inline-flex;align-items:center;justify-content:center;border-radius:4px;background:var(--s4);color:var(--dimmer);font-weight:700;font-family:'Orbitron',sans-serif;flex-shrink:0;vertical-align:middle}
.tlogo-ph{width:24px;height:24px;font-size:9px}
.tlogo-ph.lg{width:32px;height:32px;font-size:12px}
.tlogo-ph.sm{width:18px;height:18px;font-size:7px}
.gp-team img{vertical-align:middle;margin-right:4px}
/* PAGE NAV */
.page-nav{display:flex;gap:6px;padding:8px 16px;margin:0 auto 6px;max-width:600px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;justify-content:center}
.page-nav::-webkit-scrollbar{display:none}
.pn-btn{padding:8px 14px;border:1px solid var(--brd2);border-radius:10px;background:var(--surface);color:var(--dim);font-family:'Noto Sans KR',sans-serif;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s;text-align:center;display:flex;align-items:center;gap:5px;white-space:nowrap;flex-shrink:0}
.pn-btn:hover{background:var(--s2);color:var(--txt)}
.pn-btn.active{background:linear-gradient(135deg,rgba(0,161,214,.15),rgba(251,114,153,.12));border-color:rgba(0,161,214,.35);color:var(--txt);font-weight:700}
.pn-btn .pn-icon{font-size:15px}
.page-view{display:none}.page-view.active{display:block}

/* SKINS SECTION */
.skins-wrap{max-width:900px;margin:0 auto;padding:0 16px 32px}
.skins-title{font-family:'Orbitron',sans-serif;font-size:clamp(18px,3vw,26px);font-weight:900;text-align:center;margin-bottom:6px;background:linear-gradient(135deg,var(--blue),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.skins-sub{text-align:center;font-size:12px;color:var(--dim);margin-bottom:24px}
.skins-sync{text-align:center;padding:6px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--dimmer);display:flex;align-items:center;justify-content:center;gap:6px;margin-bottom:12px}
.skins-sync .ss-dot{width:6px;height:6px;border-radius:50%;display:inline-block}
.skins-sync .ss-dot.loading{background:var(--blue);animation:pulse 1.5s infinite}
.skins-sync .ss-dot.done{background:var(--win)}
.skins-sync .ss-dot.err{background:var(--loss)}
.skins-grid{display:flex;flex-direction:column;gap:20px}
.skin-card{border-radius:16px;background:var(--surface);border:1px solid var(--brd2);overflow:hidden;transition:all .3s}
.skin-card:hover{border-color:rgba(0,161,214,.3);box-shadow:0 8px 40px rgba(0,161,214,.08)}
.skin-card.latest{border-color:rgba(0,161,214,.35);background:linear-gradient(160deg,var(--surface),rgba(0,161,214,.04))}
.skin-header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px 12px;cursor:pointer;border-bottom:1px solid var(--brd);user-select:none}
.skin-header:hover{background:rgba(255,255,255,.02)}
.skin-year{font-family:'Orbitron',sans-serif;font-size:28px;font-weight:900;color:var(--txt)}
.skin-hright{display:flex;align-items:center;gap:10px}
.skin-badge{font-family:'JetBrains Mono',monospace;font-size:10px;padding:4px 12px;border-radius:100px;text-transform:uppercase;letter-spacing:1.5px}
.skin-badge.current{background:var(--blue-d);color:var(--blue);border:1px solid rgba(0,161,214,.3)}
.skin-badge.past{background:var(--s3);color:var(--dim);border:1px solid var(--brd2)}
.skin-arrow{color:var(--dimmer);font-size:14px;transition:transform .25s}
.skin-card.open .skin-arrow{transform:rotate(180deg)}
/* Skin body: always visible preview */
.skin-preview{display:flex;align-items:center;gap:20px;padding:16px 20px}
.skin-img-wrap{flex:1.2;min-width:0;display:flex;align-items:center;justify-content:center;background:radial-gradient(ellipse,rgba(0,161,214,.06),transparent 70%);border-radius:12px;padding:8px;min-height:160px}
.skin-img-wrap img{width:100%;max-height:240px;object-fit:contain;filter:drop-shadow(0 4px 24px rgba(0,161,214,.15));transition:transform .3s}
.skin-card:hover .skin-img-wrap img{transform:scale(1.04)}
.skin-info{flex:0 0 220px;display:flex;flex-direction:column;gap:6px}
.skin-name{font-family:'Orbitron',sans-serif;font-size:13px;font-weight:700;color:var(--txt)}
.skin-detail{font-size:11px;color:var(--dim);line-height:1.6}
.skin-tags{display:flex;flex-wrap:wrap;gap:5px;margin-top:4px}
.sk-tag{font-size:10px;padding:3px 8px;border-radius:5px;font-family:'JetBrains Mono',monospace}
.sk-tag.price{background:var(--gold-bg);color:var(--gold);border:1px solid var(--gold-b)}
.sk-tag.rank{background:var(--cyan-bg);color:var(--cyan);border:1px solid var(--cyan-b)}
.sk-tag.contents{background:var(--s3);color:var(--dim)}
/* Expanded detail */
.skin-expand{max-height:0;overflow:hidden;transition:max-height .4s ease}
.skin-card.open .skin-expand{max-height:1200px}
.skin-detail-inner{padding:0 20px 20px}
/* Items grid */
.items-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;margin-bottom:14px}
.item-cell{background:var(--s2);border:1px solid var(--brd2);border-radius:10px;padding:10px;text-align:center;transition:all .25s}
.item-cell:hover{border-color:rgba(0,161,214,.3);background:var(--s3);transform:translateY(-2px)}
.item-img-box{aspect-ratio:1;border-radius:8px;overflow:hidden;background:linear-gradient(135deg,rgba(0,161,214,.06),rgba(255,255,255,.02));display:flex;align-items:center;justify-content:center;margin-bottom:8px}
.item-img-box img{max-width:100%;max-height:100%;object-fit:contain}
.item-name{font-size:11px;color:var(--dim);font-family:'JetBrains Mono',monospace}
.item-placeholder{font-size:11px;color:var(--dimmer);text-align:center;padding:10px}
.item-label{font-size:13px;font-weight:600;color:var(--txt);margin-bottom:10px}
/* Bundle items */
.bundle-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
.bundle-item{flex:0 0 auto;display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:8px;background:var(--s2);border:1px solid var(--brd)}
.bundle-item img{width:36px;height:36px;object-fit:contain;border-radius:4px}
.bundle-item span{font-size:10px;color:var(--dim)}
.skin-link{display:inline-flex;align-items:center;gap:4px;margin-top:10px;font-size:11px;color:var(--blue);text-decoration:none;font-family:'JetBrains Mono',monospace;opacity:.8;transition:opacity .2s}
.skin-link:hover{opacity:1}
@media(max-width:600px){.skin-preview{flex-direction:column}.skin-info{flex:none;width:100%}.skin-img-wrap{min-height:120px}}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--s4);border-radius:3px}
/* ===== NOTIFICATIONS ===== */
.notif-btn{background:var(--s3);border:1px solid var(--s4);border-radius:8px;padding:4px 10px;font-size:14px;cursor:pointer;transition:all .2s;color:var(--dim)}
.notif-btn:hover{border-color:var(--cyan)}
.notif-btn.on{border-color:var(--cyan);background:rgba(0,212,255,.1);color:var(--cyan)}
.notif-toast{position:fixed;top:20px;right:20px;background:var(--s2);border:1px solid var(--cyan);border-radius:12px;padding:14px 18px;z-index:9999;display:flex;align-items:center;gap:10px;box-shadow:0 8px 30px rgba(0,0,0,.5);animation:toastIn .4s ease;max-width:340px}
@keyframes toastIn{0%{transform:translateX(120%);opacity:0}100%{transform:translateX(0);opacity:1}}
.notif-toast.out{animation:toastOut .3s ease forwards}
@keyframes toastOut{0%{transform:translateX(0);opacity:1}100%{transform:translateX(120%);opacity:0}}
.notif-toast .nt-icon{font-size:24px;flex-shrink:0}
.notif-toast .nt-body{flex:1}
.notif-toast .nt-title{font-size:13px;font-weight:700;color:var(--txt)}
.notif-toast .nt-desc{font-size:11px;color:var(--dim);margin-top:2px}
.notif-toast .nt-close{background:none;border:none;color:var(--dim);font-size:16px;cursor:pointer;padding:0 0 0 8px}
/* ===== STATS PAGE ===== */
.stats-section{max-width:700px;margin:0 auto 20px}
.stats-section-title{font-size:15px;font-weight:700;color:var(--cyan);margin-bottom:12px;display:flex;align-items:center;gap:8px}
.stat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;margin-bottom:16px}
.stat-card{background:var(--s3);border:1px solid var(--s4);border-radius:10px;padding:12px;text-align:center}
.stat-card .sv{font-size:22px;font-weight:800;font-family:'Orbitron',sans-serif}
.stat-card .sl{font-size:10px;color:var(--dim);margin-top:2px;text-transform:uppercase}
.map-bar-wrap{margin-bottom:8px}
.map-bar-label{display:flex;justify-content:space-between;font-size:12px;margin-bottom:3px}
.map-bar-label .mn{color:var(--txt);font-weight:600}
.map-bar-label .mr{color:var(--dim)}
.map-bar{height:8px;border-radius:4px;background:var(--s4);overflow:hidden}
.map-bar-fill{height:100%;border-radius:4px;transition:width .8s ease}
.h2h-row{display:flex;align-items:center;gap:10px;padding:8px 12px;background:var(--s3);border-radius:8px;margin-bottom:6px;border:1px solid var(--s4)}
.h2h-team{display:flex;align-items:center;gap:6px;min-width:90px}
.h2h-team .tm{font-size:13px;font-weight:700}
.h2h-record{flex:1;text-align:center;font-family:'Orbitron',sans-serif;font-size:14px;font-weight:700}
.h2h-bar{flex:2;height:8px;border-radius:4px;background:var(--s4);overflow:hidden;display:flex}
.h2h-bar .hw{background:var(--win);height:100%;transition:width .6s}
.h2h-bar .hl{background:var(--loss);height:100%;transition:width .6s}
/* ===== ROSTER PAGE ===== */
.roster-year-tabs{display:flex;gap:6px;flex-wrap:wrap;margin:0 auto 16px;max-width:700px;justify-content:center}
.roster-year-btn{padding:6px 14px;border-radius:8px;border:1px solid var(--s4);background:var(--s3);color:var(--dim);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s}
.roster-year-btn.active{background:var(--cyan);color:#000;border-color:var(--cyan)}
.roster-card{max-width:700px;margin:0 auto 12px;background:var(--s3);border:1px solid var(--s4);border-radius:12px;overflow:hidden}
.roster-header{padding:12px 16px;background:var(--s2);display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--s4)}
.roster-header .rh-year{font-size:18px;font-weight:800;font-family:'Orbitron',sans-serif;color:var(--cyan)}
.roster-header .rh-event{font-size:12px;color:var(--dim)}
.roster-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px;padding:14px}
.player-card{background:var(--s2);border:1px solid var(--s4);border-radius:10px;padding:12px 10px;text-align:center;transition:all .2s}
.player-card:hover{border-color:var(--cyan);transform:translateY(-2px)}
.player-card .p-role{font-size:9px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.player-card .p-name{font-size:15px;font-weight:800;color:var(--txt)}
.player-card .p-real{font-size:10px;color:var(--dim);margin-top:2px}
.player-card .p-flag{font-size:14px;margin-bottom:4px}
.player-card.coach{border-style:dashed;opacity:.8}
.player-card.sub{opacity:.7}
.roster-note{font-size:11px;color:var(--dimmer);padding:0 14px 10px;font-style:italic}
/* ===== STANDINGS PAGE ===== */
.standings-wrap{max-width:700px;margin:0 auto}
.standings-card{background:var(--s3);border:1px solid var(--s4);border-radius:12px;overflow:hidden;margin-bottom:14px}
.standings-title{padding:12px 16px;background:var(--s2);font-size:14px;font-weight:700;color:var(--cyan);border-bottom:1px solid var(--s4);display:flex;align-items:center;gap:8px}
.standings-table{width:100%;border-collapse:collapse}
.standings-table th{padding:8px 12px;font-size:10px;color:var(--dim);text-transform:uppercase;text-align:left;border-bottom:1px solid var(--s4)}
.standings-table td{padding:8px 12px;font-size:13px;border-bottom:1px solid rgba(255,255,255,.03)}
.standings-table tr:last-child td{border-bottom:none}
.standings-table tr.blg-row{background:rgba(0,212,255,.06)}
.standings-table tr.blg-row td{font-weight:700;color:var(--cyan)}
.standings-table .rank-num{font-family:'Orbitron',sans-serif;font-weight:700;color:var(--dim);width:30px}
.standings-table .team-cell{display:flex;align-items:center;gap:8px}
.standings-table .record{font-family:'Orbitron',sans-serif}
.standings-note{padding:10px 16px;font-size:11px;color:var(--dimmer);border-top:1px solid var(--s4)}
.standings-updated{text-align:center;font-size:11px;color:var(--dimmer);margin-top:8px}
/* ===== LIVE MATCH BANNER ===== */
#liveBanner{margin:0 auto 16px;max-width:700px;border-radius:14px;overflow:hidden}
.live-match-banner{background:linear-gradient(135deg,#1a0a2e 0%,#2d1b4e 50%,#1a0a2e 100%);border:2px solid #ff4655;border-radius:14px;padding:16px 20px;position:relative;overflow:hidden;animation:livePulse 3s ease-in-out infinite}
@keyframes livePulse{0%,100%{border-color:#ff4655;box-shadow:0 0 20px rgba(255,70,85,.2)}50%{border-color:#ff6b7a;box-shadow:0 0 30px rgba(255,70,85,.35)}}
.live-match-banner::before{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,70,85,.06),transparent);animation:liveShimmer 3s infinite}
.live-stream-wrap{margin:12px 0 4px;border-radius:10px;overflow:hidden;background:#000;animation:fi .3s ease}
@keyframes liveShimmer{0%{left:-100%}100%{left:200%}}
.live-top{display:flex;align-items:center;gap:8px;margin-bottom:12px}
.live-dot-big{width:12px;height:12px;background:#ff4655;border-radius:50%;animation:blink 1s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.live-label{font-size:13px;font-weight:700;color:#ff4655;text-transform:uppercase;letter-spacing:1.5px}
.live-event{font-size:11px;color:var(--dim);margin-left:auto}
.live-teams{display:flex;align-items:center;justify-content:center;gap:16px}
.live-team{display:flex;align-items:center;gap:10px;flex:1}
.live-team.right{flex-direction:row-reverse;text-align:right}
.live-team-name{font-size:18px;font-weight:800;color:var(--txt)}
.live-team-full{font-size:11px;color:var(--dim)}
.live-vs{font-size:14px;font-weight:700;color:var(--dim);padding:0 4px}
.live-score-live{font-size:28px;font-weight:900;color:#ff4655;text-align:center;min-width:60px;letter-spacing:2px}
.live-links{display:flex;gap:8px;margin-top:12px;justify-content:center;flex-wrap:wrap}
.live-link{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:8px;font-size:12px;font-weight:600;text-decoration:none;cursor:pointer;transition:all .2s}
.live-link.yt{background:rgba(255,0,0,.15);color:#ff4444;border:1px solid rgba(255,0,0,.25)}
.live-link.yt:hover{background:rgba(255,0,0,.25)}
.live-link.bili{background:rgba(0,161,214,.12);color:#00a1d6;border:1px solid rgba(0,161,214,.25)}
.live-link.bili:hover{background:rgba(0,161,214,.22)}
.live-link.twitch{background:rgba(145,70,255,.12);color:#9146ff;border:1px solid rgba(145,70,255,.25)}
.live-link.twitch:hover{background:rgba(145,70,255,.22)}
.live-link.vlr{background:rgba(255,255,255,.06);color:var(--dim);border:1px solid rgba(255,255,255,.1)}
/* New VOD badge */
.new-vod-badge{display:inline-block;font-size:9px;font-weight:700;padding:1px 5px;border-radius:4px;background:rgba(0,161,214,.2);color:#00a1d6;margin-left:4px;vertical-align:middle;animation:newVodPop .5s ease}
@keyframes newVodPop{0%{transform:scale(0)}50%{transform:scale(1.2)}100%{transform:scale(1)}}

/* ===== TRANSFER TIMELINE ===== */
.tf-section{max-width:700px;margin:20px auto 0}
.tf-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.tf-title{font-size:14px;font-weight:700;color:var(--txt);display:flex;align-items:center;gap:8px}
.tf-title::before{content:'';width:3px;height:16px;background:var(--cyan);border-radius:2px}
.tf-badge{font-size:10px;padding:2px 8px;border-radius:4px;background:rgba(6,182,212,.1);color:var(--cyan);font-family:'JetBrains Mono',monospace}
.tf-year-filter{display:flex;gap:4px}
.tf-year-btn{font-size:11px;padding:4px 10px;border-radius:6px;border:1px solid var(--s4);background:var(--s3);color:var(--dim);cursor:pointer;transition:all .2s;font-family:inherit}
.tf-year-btn.active{background:var(--cyan);color:#000;border-color:var(--cyan);font-weight:600}
.tf-timeline{position:relative;padding-left:20px}
.tf-timeline::before{content:'';position:absolute;left:6px;top:0;bottom:0;width:2px;background:var(--s4);border-radius:1px}
.tf-item{position:relative;padding:10px 14px;margin-bottom:8px;background:var(--s3);border:1px solid var(--s4);border-radius:10px;transition:all .2s}
.tf-item:hover{border-color:var(--brd2);background:var(--s2)}
.tf-item::before{content:'';position:absolute;left:-17px;top:16px;width:10px;height:10px;border-radius:50%;border:2px solid var(--s4);background:var(--surface)}
.tf-item.join::before{border-color:var(--win);background:var(--win-bg)}
.tf-item.leave::before{border-color:var(--loss);background:var(--loss-bg)}
.tf-item.role::before{border-color:var(--blue);background:rgba(96,165,250,.15)}
.tf-item.promote::before{border-color:var(--cyan);background:rgba(6,182,212,.15)}
.tf-date{font-size:10px;color:var(--dimmer);font-family:'JetBrains Mono',monospace;margin-bottom:4px}
.tf-content{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.tf-type{font-size:10px;font-weight:700;padding:2px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.5px;flex-shrink:0}
.tf-type.join{background:var(--win-bg);color:var(--win);border:1px solid var(--win-b)}
.tf-type.leave{background:var(--loss-bg);color:var(--loss);border:1px solid var(--loss-b)}
.tf-type.role{background:rgba(96,165,250,.1);color:var(--blue);border:1px solid rgba(96,165,250,.2)}
.tf-type.promote{background:rgba(6,182,212,.1);color:var(--cyan);border:1px solid rgba(6,182,212,.2)}
.tf-player{font-size:13px;font-weight:700;color:var(--txt)}
.tf-detail{font-size:12px;color:var(--dim)}
.tf-from{font-size:11px;color:var(--dimmer);font-style:italic}
.tf-empty{text-align:center;color:var(--dimmer);padding:30px;font-size:13px}
/* Opponent stats from Liquipedia */
.opp-section{margin-top:16px}
.opp-title{font-size:13px;font-weight:700;color:var(--txt);margin-bottom:8px;display:flex;align-items:center;gap:6px}
</style>
</head>
<body>

<div class="hero">
  <div class="badge"><span class="dot"></span>VALORANT ESPORTS ¬∑ LIVE TRACKER</div>
  <h1><span class="blg">BILIBILI GAMING</span></h1>
  <h1 style="font-size:clamp(16px,2.5vw,24px);margin-top:4px;color:var(--dim)">Ïã§ÏãúÍ∞Ñ ÎåÄÏ†Ñ Í∏∞Î°ù & Í≤∞Í≥º</h1>
  <p class="hero-sub"><strong>VCT China</strong> ¬∑ whz ¬∑ Knight ¬∑ nephh ¬∑ rushia ¬∑ bud</p>
</div>
<div class="live-bar"><span class="live-dot loading" id="liveDot"></span><span class="live-text" id="liveText">Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë...</span><button class="refresh-btn" id="refreshBtn" onclick="fetchLiveData()" disabled><span id="refreshIcon">‚Üª</span> ÏÉàÎ°úÍ≥†Ïπ®</button><button class="notif-btn" id="notifBtn" onclick="toggleNotif()" title="ÏïåÎ¶º ÏÑ§Ï†ï"><span id="notifIcon">üîî</span></button></div>
<div class="stats-bar" id="statsBar"></div>

<!-- PAGE NAV -->
<div class="page-nav">
<button class="pn-btn active" data-page="matches" onclick="switchPage('matches')"><span class="pn-icon">‚öîÔ∏è</span>Í≤ΩÍ∏∞ Í∏∞Î°ù</button>
<button class="pn-btn" data-page="stats" onclick="switchPage('stats')"><span class="pn-icon">üìä</span>ÌÜµÍ≥Ñ</button>
<button class="pn-btn" data-page="roster" onclick="switchPage('roster')"><span class="pn-icon">üë§</span>Î°úÏä§ÌÑ∞</button>
<button class="pn-btn" data-page="standings" onclick="switchPage('standings')"><span class="pn-icon">üèÜ</span>ÏàúÏúÑ</button>

<button class="pn-btn" data-page="skins" onclick="switchPage('skins')"><span class="pn-icon">üî´</span>Ïä§ÌÇ®</button>
</div>

<!-- MATCHES VIEW -->
<div class="page-view active" id="view-matches">
<!-- LIVE BANNER -->
<div id="liveBanner" style="display:none"></div>
<!-- UPCOMING -->
<div class="upcoming-section" id="upcomingSection"></div>

<div class="year-tabs" id="yearTabs"></div>
<div class="main" id="main"><div class="loading-state"><div class="loader"></div><div class="loading-text">ÏµúÏã† Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Í≥† ÏûàÏäµÎãàÎã§...</div></div></div>
</div>

<!-- STATS VIEW -->
<div class="page-view" id="view-stats">
<div id="statsView"></div>
</div>

<!-- ROSTER VIEW -->
<div class="page-view" id="view-roster">
<div id="rosterView"><div class="loading-state"><div class="loader"></div><div class="loading-text">Î°úÏä§ÌÑ∞ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Í≥† ÏûàÏäµÎãàÎã§...</div></div></div>
</div>

<!-- STANDINGS VIEW -->
<div class="page-view" id="view-standings">
<div id="standingsView"><div class="loading-state"><div class="loader"></div><div class="loading-text">ÏàúÏúÑ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Í≥† ÏûàÏäµÎãàÎã§...</div></div></div>
</div>

<!-- SKINS VIEW -->
<div class="page-view" id="view-skins">
<div class="skins-wrap" id="skinsWrap"></div>
</div>
<div class="footer">Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ¬∑ <a href="https://vlr.gg/team/12498/bilibili-gaming" target="_blank">VLR.gg</a> ¬∑ <a href="https://liquipedia.net/valorant/Bilibili_Gaming" target="_blank">Liquipedia</a> ¬∑ <a href="https://www.youtube.com/@VALORANTEsportsCN" target="_blank">YouTube</a> ¬∑ <a href="https://space.bilibili.com/2071691173" target="_blank">BÁ´ô (Êó†ÁïèÂ•ëÁ∫¶Ëµõ‰∫ã)</a></div>

<script>

// ===== UNIVERSAL FETCH (Vercel ÏûêÏ≤¥ ÌîÑÎ°ùÏãú + fallback) =====
const OWN_PROXY=url=>`/api/proxy?url=${encodeURIComponent(url)}`;
const CORS_PROXIES=[
  OWN_PROXY,
  url=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
];
async function proxyFetch(url,timeout=8000){
  // Try each proxy (own first, then fallbacks)
  for(const proxy of CORS_PROXIES){
    try{const r=await fetch(proxy(url),{signal:AbortSignal.timeout(timeout)});if(r.ok)return await r.text()}catch(e){}
  }
  // Last resort: direct (works if API has CORS headers)
  try{const r=await fetch(url,{signal:AbortSignal.timeout(timeout)});if(r.ok)return await r.text()}catch(e){}
  return null;
}
async function proxyFetchJSON(url,timeout=8000){
  const t=await proxyFetch(url,timeout);if(!t)return null;
  try{return JSON.parse(t)}catch(e){return null}
}

// ===== TEAM LOGOS (VALORANT Esports / static.lolesports.com) =====
const VE="https://am-a.akamaihd.net/image?resize=96:&f=http%3A%2F%2Fstatic.lolesports.com%2Fteams%2F";
const LOGOS={
  // VCT CN
  BLG:VE+"1707126028220_BLG.png",
  EDG:VE+"1735920597800_edg1.png",
  XLG:VE+"1735920774181_XLGA.PNG",
  DRG:VE+"1707126143797_DRG.png",
  WOL:VE+"1707126969882_WOL.png",
  TE:VE+"1736345448590_TE.png",
  FPX:VE+"1644542485597_download38.png",
  TYL:VE+"1768990500116_TYLLOGO.png",
  NOVA:VE+"1741178535000_NOVA.png",
  TEC:VE+"1707127134615_TEC.png",
  TITAN:VE+"1707127134615_TEC.png",
  AG:VE+"1707126806655_AG.png",
  JDG:VE+"1707126862498_JDG.png",
  // VCT Americas
  G2:VE+"1675329807714_G2-Esports-Logo1.png",
  SEN:VE+"1739254422982_sent.png",
  NRG:VE+"1731490666442_NRGWHT.png",
  MIBR:VE+"1648844013086_mibr_white-logo.png",
  C9:VE+"1725635348011_C9-Logo.png",
  EG:VE+"1731490673901_VintageEG.png",
  "100T":VE+"1644966311613_100TVAL.png",
  LOUD:VE+"1644060140569_LOUDGreen.png",
  FURIA:VE+"1644059765262_FURIA-LOGO.png",
  LEV:VE+"1644148043034_Leviatncolor.png",
  // VCT EMEA
  TL:VE+"1637252586938_teamliquid.png",
  FNC:VE+"1644542427486_download37.png",
  KC:VE+"1651626649157_download1.png",
  NAVI:VE+"1627386036528_Natus_Vincere_2021_lightmode.png",
  VIT:VE+"1722030793680_VITALITY_YELLOW.png",
  // VCT Pacific
  PRX:VE+"1630018120582_paper-rex-2021.png",
  T1:VE+"1677137430839_T1_infoboximage1.png",
  RRQ:VE+"1707306458590_LOGO_RRQ_orange.png",
  DRX:VE+"1705652820016_DRXwhite.png",
  GEN:VE+"1678453609404_GenG_logo_200407-051.png",
  NS:VE+"1674219422693_NS_.png",
  DFM:VE+"1675669923678_190px-DetonatioN_FocusMe_2022_darkmode1.png",
  // Teams without hardcoded logos (filled by Riot Esports API or SVG fallback)
  KR√ú:'',LGD:'',RNG:'',WBG:'',NIP:'',ASE:'',NWG:'',ME:'',
};
// Generate SVG text logo for teams without images
function _tsvg(tag,bg='#333',fg='#fff'){
  const sz=tag.length>3?10:12;
  return`data:image/svg+xml,${encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"><rect width="40" height="40" rx="8" fill="${bg}"/><text x="20" y="24" text-anchor="middle" font-family="Arial" font-weight="bold" font-size="${sz}" fill="${fg}">${tag}</text></svg>`)}`;
}
// Fill empty logos with SVG initially (Riot Esports API will replace with real logos)
const _LOGO_COLORS={KR√ú:'#5b21b6',LGD:'#dc2626',RNG:'#eab308',WBG:'#3b82f6',NIP:'#f59e0b',ASE:'#10b981',NWG:'#6366f1',ME:'#ec4899',Wolves:'#f97316',TBD:'#555'};
Object.keys(LOGOS).forEach(k=>{if(!LOGOS[k])LOGOS[k]=_tsvg(k,_LOGO_COLORS[k]||'#333')});
function L(tag,sz=''){const u=LOGOS[tag]||logoCache[tag];if(u&&u!=='pending'&&u!==false)return`<img src="${u}" class="tlogo ${sz}" alt="${tag}" onerror="this.outerHTML='<span class=\\'tlogo-ph ${sz}\\'>${tag[0]}</span>'">`;if(!LOGOS[tag]&&!logoCache[tag])fetchTeamLogo(tag);return`<span class="tlogo-ph ${sz}">${tag[0]||'?'}</span>`}

// ===== RIOT ESPORTS API (valorantesports.com - free, no CORS!) =====
const RIOT_ESPORTS_BASE='https://esports-api.service.valorantesports.com/persisted/val';
const RIOT_ESPORTS_KEY='0TvQnueqKa5mxJntVWt0w4LpLfEkrV1Ta8rQBb9Z';
const VCT_CN_LEAGUE_ID='111691194187846945';
let riotScheduleCache=null;
let riotScheduleTime=0;

async function riotEsportsFetch(endpoint, params={}){
  params.hl=params.hl||'en-US'; params.sport='val';
  const qs=new URLSearchParams(params).toString();
  const url=`${RIOT_ESPORTS_BASE}/${endpoint}?${qs}`;
  // Use own proxy (handles x-api-key server-side)
  for(const proxy of CORS_PROXIES){
    try{const r=await fetch(proxy(url),{signal:AbortSignal.timeout(10000)});if(r.ok)return await r.json()}catch(e){}
  }
  return null;
}

async function getRiotSchedule(forceRefresh=false){
  const now=Date.now();
  if(!forceRefresh && riotScheduleCache && (now-riotScheduleTime)<3*60*1000) return riotScheduleCache;
  const d=await riotEsportsFetch('getSchedule',{leagueId:VCT_CN_LEAGUE_ID});
  if(d&&d.data?.schedule?.events){
    riotScheduleCache=d.data.schedule.events;
    riotScheduleTime=now;
    // Cache official logos from API
    riotScheduleCache.forEach(ev=>{
      (ev.match?.teams||[]).forEach(t=>{
        if(t.code && t.image){
          const aliases=[t.code,{KRU:'KR√ú',Wolves:'WOL',TITAN:'TEC'}[t.code]].filter(Boolean);
          aliases.forEach(c=>{if(!LOGOS[c]||LOGOS[c].startsWith('data:')){LOGOS[c]=t.image;logoCache[c]=t.image}});
        }
      });
    });
  }
  return riotScheduleCache||[];
}

function isBLGTeam(team){return team.code==='BLG'||team.name?.includes('Bilibili')}

// Fetch ALL VCT team logos from Riot Esports API (getStandings has all teams with images)
async function fetchRiotTeamLogos(){
  // Riot API code ‚Üí our code mapping (handles special chars, aliases)
  const CODE_ALIAS={KRU:'KR√ú',KRUE:'KR√ú',Wolves:'WOL',TITAN:'TEC'};
  function applyLogo(code,image){
    const targets=[code,CODE_ALIAS[code]].filter(Boolean);
    targets.forEach(c=>{
      if(!LOGOS[c]||LOGOS[c].startsWith('data:')){
        LOGOS[c]=image;
        logoCache[c]=image;
        document.querySelectorAll(`img.tlogo[alt="${c}"]`).forEach(el=>{if(el.src.startsWith('data:'))el.src=image});
        document.querySelectorAll('span.tlogo-ph').forEach(el=>{
          if(el.textContent===(c[0]||''))el.outerHTML=`<img src="${image}" class="tlogo" alt="${c}" onerror="this.outerHTML='<span class=\\'tlogo-ph\\'>${c[0]}</span>'">`});
      }
    });
  }
  try{
    // VCT league IDs
    const leagueIds=['111691194187846945','111688766498498302','111688766498498301','111688766498498300']; // CN, Americas, EMEA, Pacific
    // Method 1: getSchedule (most reliable - has match team data)
    for(const lid of leagueIds){
      const d=await riotEsportsFetch('getSchedule',{leagueId:lid});
      if(d?.data?.schedule?.events){
        d.data.schedule.events.forEach(ev=>{
          (ev.match?.teams||[]).forEach(t=>{
            if(t.code&&t.image)applyLogo(t.code,t.image);
          });
        });
      }
      await new Promise(r=>setTimeout(r,500));
    }
    // Method 2: getStandings (has all teams in league)
    for(const lid of leagueIds){
      const d=await riotEsportsFetch('getStandings',{leagueId:lid});
      if(d?.data?.standings){
        (Array.isArray(d.data.standings)?d.data.standings:[d.data.standings]).forEach(s=>{
          (s.stages||[]).forEach(st=>{
            (st.sections||[]).forEach(sec=>{
              (sec.rankings||[]).forEach(r=>{
                (r.teams||[]).forEach(t=>{
                  if(t.code&&t.image)applyLogo(t.code,t.image);
                });
              });
            });
          });
        });
      }
      await new Promise(r=>setTimeout(r,500));
    }
    // Method 3: getLeagues to discover all league+tournament IDs
    const leagues=await riotEsportsFetch('getLeagues');
    if(leagues?.data?.leagues){
      leagues.data.leagues.forEach(lg=>{
        (lg.tournaments||[]).forEach(tn=>{
          // Cache tournament IDs for future use
        });
      });
    }
    const filled=Object.keys(LOGOS).filter(k=>LOGOS[k]&&!LOGOS[k].startsWith('data:')).length;
    console.log(`üñºÔ∏è Riot Esports API: ${filled}Í∞ú ÌåÄ Î°úÍ≥† Î°úÎìú`);

    // Phase 2: Liquipedia fallback for teams still using SVG
    await fetchLiquipediaLogos();
  }catch(e){console.log('Team logo fetch failed:',e.message)}
}

// Liquipedia commons API ‚Üí proxyÎ°ú Ïù¥ÎØ∏ÏßÄ ÏÑúÎπô (403 Ïö∞Ìöå)
async function fetchLiquipediaLogos(){
  // tag ‚Üí ÌíÄÎÑ§ÏûÑ prefix (Liquipedia ÌååÏùºÎ™Ö Í∑úÏπô)
  const LP_NAME={
    KR√ú:'KRU_Esports',LGD:'LGD_Gaming',RNG:'Royal_Never_Give_Up',
    WBG:'Weibo_Gaming',NIP:'Ninjas_in_Pyjamas',ASE:'All_Spark_Esports',
    NWG:'Nongshim_World_Gate',ME:'Mystic_Esports',
    BLG:'Bilibili_Gaming',EDG:'EDward_Gaming',FPX:'FunPlus_Phoenix',
    DRG:'Dragon_Ranger_Gaming',WOL:'Wolves_Esports',TE:'Trace_Esports',
    TYL:'TYLOO',NOVA:'Nova_Esports',TEC:'Titan_Esports_Club',
    AG:'AG_Esports',JDG:'JD_Gaming',G2:'G2_Esports',SEN:'Sentinels',
    NRG:'NRG_Esports',MIBR:'MIBR',C9:'Cloud9',EG:'Evil_Geniuses',
    LOUD:'LOUD',FURIA:'FURIA_Esports',LEV:'Leviatan',
    TL:'Team_Liquid',FNC:'Fnatic',KC:'Karmine_Corp',NAVI:'Natus_Vincere',
    VIT:'Team_Vitality',PRX:'Paper_Rex',T1:'T1',DRX:'DRX',GEN:'Gen.G',
    RRQ:'Rex_Regum_Qeon',NS:'Nongshim_RedForce',DFM:'DetonatioN_FocusMe',
    '100T':'100_Thieves',XLG:'XLGA',Wolves:'Wolves_Esports'
  };
  // Only fetch for teams still using SVG data URIs
  const svgTeams=Object.keys(LOGOS).filter(k=>LOGOS[k].startsWith('data:')&&LP_NAME[k]);
  if(!svgTeams.length){console.log('üñºÔ∏è Liquipedia: Î≥¥ÏôÑ ÌïÑÏöî ÏóÜÏùå');return}
  console.log(`üñºÔ∏è Liquipedia: ${svgTeams.length}Í∞ú ÌåÄ Î°úÍ≥† Î≥¥ÏôÑ ÏãúÎèÑ (${svgTeams.join(', ')})`);

  const COMMONS='https://liquipedia.net/commons/api.php';
  for(const tag of svgTeams){
    const prefix=LP_NAME[tag];
    if(!prefix)continue;
    try{
      // allimages prefix Í≤ÄÏÉâ ‚Äî ÌíÄÎÑ§ÏûÑÏúºÎ°ú Ìï¥Îãπ ÌåÄ Î™®Îì† ÌååÏùº ÌÉêÏÉâ
      const d=await proxyFetchJSON(`${COMMONS}?action=query&list=allimages&aiprefix=${encodeURIComponent(prefix)}&ailimit=30&format=json`);
      const imgs=d?.query?.allimages||[];
      if(!imgs.length){console.log(`üñºÔ∏è Liquipedia: ${tag} (${prefix}) ‚Äî ÌååÏùº ÏóÜÏùå`);continue}

      // Î°úÍ≥† ÌååÏùº Ïö∞ÏÑ†ÏàúÏúÑ: allmode > darkmode > lightmode > logo > Í∏∞Î≥∏
      const logoPriority=[
        /_allmode\.(png|svg)$/i,
        /_darkmode\.(png|svg)$/i,
        /_full_allmode\.(png|svg)$/i,
        /_full_darkmode\.(png|svg)$/i,
        /_lightmode\.(png|svg)$/i,
        /logo/i,
      ];
      // ÎπÑÎ°úÍ≥† ÌååÏùº Ï†úÏô∏ (ÏÑ†ÏàòÏÇ¨ÏßÑ, Îßµ, Í≤∞Í≥º Îì±)
      const excluded=/player|map|result|banner|wordmark|trophy|bg_|header|screenshot/i;
      const candidates=imgs.filter(f=>!excluded.test(f.name));
      if(!candidates.length)continue;

      let best=null;
      for(const pat of logoPriority){
        best=candidates.find(f=>pat.test(f.name));
        if(best)break;
      }
      if(!best) best=candidates[0]; // ÏïÑÎ¨¥Í±∞ÎÇòÎùºÎèÑ

      // thumburl ÏÉùÏÑ± (96px)
      const imgUrl=best.url.replace(/\/commons\/images\//,'/commons/images/thumb/')+'?width=96';
      const proxiedUrl=OWN_PROXY(best.url);
      LOGOS[tag]=proxiedUrl;
      logoCache[tag]=proxiedUrl;

      // Update DOM
      document.querySelectorAll(`img.tlogo[alt="${tag}"]`).forEach(el=>{if(el.src.startsWith('data:'))el.src=proxiedUrl});
      document.querySelectorAll('span.tlogo-ph').forEach(el=>{
        if(el.textContent===(tag[0]||''))el.outerHTML=`<img src="${proxiedUrl}" class="tlogo" alt="${tag}" onerror="this.outerHTML='<span class=\\'tlogo-ph\\'>${tag[0]}</span>'">`});
      console.log(`üñºÔ∏è Liquipedia Î≥¥ÏôÑ: ${tag} ‚Üê ${best.name}`);
    }catch(e){console.log(`üñºÔ∏è Liquipedia Ïã§Ìå®: ${tag}`,e.message)}
    await new Promise(r=>setTimeout(r,2000)); // Liquipedia rate limit Ï°¥Ï§ë
  }
  const total=Object.keys(LOGOS).filter(k=>LOGOS[k]&&!LOGOS[k].startsWith('data:')).length;
  console.log(`üñºÔ∏è ÏµúÏ¢Ö: ${total}Í∞ú ÌåÄ Î°úÍ≥† Î°úÎìú ÏôÑÎ£å`);
}

// Fetch logos 3s after page load
setTimeout(fetchRiotTeamLogos,3000);

// ===== UPCOMING MATCHES DATA =====
const upcomingData = [
  {
    event: "VCT 2026: China Stage 1",
    stage: "Group Alpha",
    date: "2026-03-31",
    dateLabel: "3Ïõî 31Ïùº ~ 5Ïõî",
    format: "Round Robin",
    opponents: ["All Gamers", "TYLOO", "JDG Esports", "Titan Esports Club", "FunPlus Phoenix"],
    note: "ÏÉÅÏúÑ 3ÌåÄ ‚Üí Masters London ÏßÑÏ∂ú",
    confirmed: true,
    groupTeams: [
      {name:"BLG",self:true},{name:"AG",self:false},{name:"TYL",self:false},
      {name:"JDG",self:false},{name:"TEC",self:false},{name:"FPX",self:false}
    ]
  }
];

function renderUpcoming() {
  const el = document.getElementById('upcomingSection');
  const now = new Date();
  // ÌôïÏ†ïÎêú ÏùºÏ†ïÎßå ÌëúÏãú
  const confirmed = upcomingData.filter(u => u.confirmed || (u.opponents && u.opponents.length > 0));
  if (!confirmed.length) { el.innerHTML = ''; return; }

  let h = `<div class="upcoming-title"><h2>üìÖ Îã§Ïùå Í≤ΩÍ∏∞ ÏùºÏ†ï</h2><span class="live-badge">confirmed</span></div>`;

  confirmed.forEach(u => {
    const target = new Date(u.date + 'T09:00:00+08:00');
    const diff = target - now;
    const days = Math.max(0, Math.floor(diff / 86400000));
    const hrs = Math.max(0, Math.floor((diff % 86400000) / 3600000));
    const mins = Math.max(0, Math.floor((diff % 3600000) / 60000));

    h += `<div class="upcoming-card">
      <div class="uc-top"><span class="uc-event">${u.event}</span><span class="uc-date">${u.dateLabel}</span></div>`;

    if (u.opponents.length > 0) {
      h += `<div class="uc-teams">
        <div class="uc-team">${L('BLG','lg')}<div class="uc-team-name blg" style="margin-top:4px">BLG</div><div class="uc-team-sub">Bilibili Gaming</div></div>
        <div class="uc-vs">VS</div>
        <div class="uc-team"><div class="uc-team-name">${u.opponents.length}ÌåÄ</div><div class="uc-team-sub">${u.stage}</div></div>
      </div>`;
    } else {
      h += `<div class="uc-teams">
        <div class="uc-team">${L('BLG','lg')}<div class="uc-team-name blg" style="margin-top:4px">BLG</div><div class="uc-team-sub">Bilibili Gaming</div></div>
        <div class="uc-vs">‚Üí</div>
        <div class="uc-team"><div class="uc-team-name" style="color:var(--cyan)">TBD</div><div class="uc-team-sub">${u.stage}</div></div>
      </div>`;
    }

    h += `<div class="uc-info">
      <span class="uc-tag">${u.format}</span>
      <span class="uc-tag">${u.note}</span>
      ${diff > 0 ? '<span class="uc-tag tbd">D-' + days + '</span>' : '<span class="uc-tag tbd">ÏùºÏ†ï ÌôïÏù∏ Ï§ë</span>'}
    </div>`;

    if (diff > 0) {
      h += `<div class="countdown-row">
        <div class="cd-block"><div class="cd-num">${days}</div><div class="cd-label">Ïùº</div></div>
        <div class="cd-block"><div class="cd-num">${hrs}</div><div class="cd-label">ÏãúÍ∞Ñ</div></div>
        <div class="cd-block"><div class="cd-num">${mins}</div><div class="cd-label">Î∂Ñ</div></div>
      </div>`;
    }

    if (u.groupTeams.length > 0) {
      h += `<div class="group-preview"><div class="gp-title">Group Alpha Ìé∏ÏÑ±</div><div class="gp-teams">`;
      u.groupTeams.forEach(gt => {
        h += `<span class="gp-team ${gt.self ? 'self' : ''}">${L(gt.name,'sm')} ${gt.name}</span>`;
      });
      h += `</div></div>`;
    }

    h += `</div>`;
  });

  el.innerHTML = h;
}

// Update countdowns every minute
setInterval(renderUpcoming, 60000);

// ===== MATCH DATA =====
const baselineData = {
  "2024":[
  {tournament:"VCT 2024: China Kickoff",intl:false,matches:[
    {date:"2024-02-27",opp:"Trace Esports",tag:"TE",stage:"Group Stage",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2024-02-27",opp:"Titan Esports Club",tag:"TEC",stage:"Group Stage",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2024-02-26",opp:"Wolves Esports",tag:"WOL",stage:"Group Stage",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2024-02-23",opp:"Wolves Esports",tag:"WOL",stage:"Group Stage",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
  ]},{tournament:"VCT 2024: China Stage 1",intl:false,matches:[
    {date:"2024-05-04",opp:"FunPlus Phoenix",tag:"FPX",stage:"Regular Season",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2024-04-28",opp:"JDG Esports",tag:"JDG",stage:"Regular Season",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2024-04-26",opp:"Titan Esports Club",tag:"TEC",stage:"Regular Season",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2024-04-20",opp:"All Gamers",tag:"AG",stage:"Regular Season",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2024-04-13",opp:"Trace Esports",tag:"TE",stage:"Regular Season",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2024-04-05",opp:"TYLOO",tag:"TYL",stage:"Regular Season",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
  ]},{tournament:"VCT 2024: China Stage 2",intl:false,matches:[
    {date:"2024-07-18",opp:"FunPlus Phoenix",tag:"FPX",stage:"Playoffs",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2024-07-17",opp:"EDward Gaming",tag:"EDG",stage:"Playoffs",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2024-07-16",opp:"JDG Esports",tag:"JDG",stage:"Playoffs",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2024-07-06",opp:"EDward Gaming",tag:"EDG",stage:"Regular Season",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2024-06-30",opp:"Dragon Ranger Gaming",tag:"DRG",stage:"Regular Season",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2024-06-23",opp:"Nova Esports",tag:"NOVA",stage:"Regular Season",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2024-06-16",opp:"Wolves Esports",tag:"WOL",stage:"Regular Season",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
  ]},{tournament:"VALORANT Champions 2024 (Seoul)",intl:true,matches:[
    {date:"2024-08-08",opp:"KR√ú Esports",tag:"KR√ú",stage:"Group B Elim.",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2024-08-02",opp:"FNATIC",tag:"FNC",stage:"Group B Opening",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
  ]},{tournament:"FGC Invitational 2024",intl:false,matches:[
    {date:"2024-11-10",opp:"Wolves Esports",tag:"WOL",stage:"Grand Final",fmt:"Bo5",bs:3,os:1,r:"win",maps:[]},
    {date:"2024-11-08",opp:"Wolves Esports",tag:"WOL",stage:"UB Final",fmt:"Bo3",bs:2,os:1,r:"win",maps:[]},
    {date:"2024-11-06",opp:"Nova Esports",tag:"NOVA",stage:"UB Semi",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2024-11-01",opp:"Xi Lai Gaming",tag:"XLG",stage:"UB Quarter",fmt:"Bo3",bs:2,os:1,r:"win",maps:[]},
  ]},{tournament:"Radiant Asia Invitational 2024",intl:true,matches:[
    {date:"2024-11-24",opp:"Trace Esports",tag:"TE",stage:"Group Stage",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2024-11-22",opp:"DRX",tag:"DRX",stage:"Group Stage",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
  ]},{tournament:"SOOP Valorant League 2024",intl:true,matches:[
    {date:"2024-12-13",opp:"NRG",tag:"NRG",stage:"Group Stage",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2024-12-11",opp:"DRX",tag:"DRX",stage:"Group Stage",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
  ]}],
  "2025":[
  {tournament:"VCT 2025: China Kickoff",intl:false,matches:[
    {date:"2025-01-24",opp:"EDward Gaming",tag:"EDG",stage:"Elimination",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-01-23",opp:"Trace Esports",tag:"TE",stage:"Mid Bracket",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-01-20",opp:"FunPlus Phoenix",tag:"FPX",stage:"Upper Bracket",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2025-01-16",opp:"Xi Lai Gaming",tag:"XLG",stage:"Upper Bracket",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
  ]},{tournament:"China Evolution Series: Act 1",intl:false,matches:[
    {date:"2025-02-15",opp:"JDG Esports",tag:"JDG",stage:"Group Stage",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2025-02-14",opp:"Nova Esports",tag:"NOVA",stage:"Group Stage",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-02-10",opp:"TYLOO",tag:"TYL",stage:"Group Stage",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
  ]},{tournament:"VCT 2025: China Stage 1",intl:false,matches:[
    {date:"2025-05-04",opp:"Xi Lai Gaming",tag:"XLG",stage:"Grand Final",fmt:"Bo5",bs:1,os:3,r:"loss",maps:[]},
    {date:"2025-05-03",opp:"Wolves Esports",tag:"WOL",stage:"LB Final",fmt:"Bo5",bs:3,os:0,r:"win",maps:[]},
    {date:"2025-05-02",opp:"EDward Gaming",tag:"EDG",stage:"LB Semi",fmt:"Bo5",bs:3,os:1,r:"win",maps:[]},
    {date:"2025-04-20",opp:"Trace Esports",tag:"TE",stage:"LB R2",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2025-04-19",opp:"Wolves Esports",tag:"WOL",stage:"UB Semi",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-04-12",opp:"Trace Esports",tag:"TE",stage:"UB Quarter",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-04-04",opp:"Wolves Esports",tag:"WOL",stage:"Regular Season",fmt:"Bo3",bs:2,os:1,r:"win",maps:[]},
    {date:"2025-03-30",opp:"All Gamers",tag:"AG",stage:"Regular Season",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2025-03-23",opp:"JDG Esports",tag:"JDG",stage:"Regular Season",fmt:"Bo3",bs:2,os:1,r:"win",maps:[]},
    {date:"2025-03-13",opp:"Xi Lai Gaming",tag:"XLG",stage:"Regular Season",fmt:"Bo3",bs:2,os:1,r:"win",maps:[]},
  ]},{tournament:"HERO Asian Champions League 2025",intl:true,matches:[
    {date:"2025-05-16",opp:"DRX",tag:"DRX",stage:"3rd Place",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-05-15",opp:"Trace Esports",tag:"TE",stage:"Semifinal",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2025-05-14",opp:"DRX",tag:"DRX",stage:"Group Stage",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
  ]},{tournament:"VCT Masters Toronto 2025",intl:true,matches:[
    {date:"2025-06-11",opp:"Wolves Esports",tag:"WOL",stage:"Swiss R3 (0-2)",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-06-09",opp:"Sentinels",tag:"SEN",stage:"Swiss R2",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-06-07",opp:"Team Liquid",tag:"TL",stage:"Swiss R1",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
  ]},{tournament:"Esports World Cup 2025",intl:true,matches:[
    {date:"2025-07-10",opp:"Karmine Corp",tag:"KC",stage:"Group A Elim.",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-07-09",opp:"G2 Esports",tag:"G2",stage:"Group A",fmt:"Bo1",bs:1,os:0,r:"win",maps:[]},
    {date:"2025-07-08",opp:"Paper Rex",tag:"PRX",stage:"Group A",fmt:"Bo1",bs:0,os:1,r:"loss",maps:[]},
  ]},{tournament:"VCT 2025: China Stage 2",intl:false,matches:[
    {date:"2025-08-24",opp:"Dragon Ranger Gaming",tag:"DRG",stage:"Grand Final",fmt:"Bo5",bs:3,os:1,r:"win",maps:[]},
    {date:"2025-08-23",opp:"EDward Gaming",tag:"EDG",stage:"LB Final",fmt:"Bo5",bs:3,os:1,r:"win",maps:[]},
    {date:"2025-08-22",opp:"Dragon Ranger Gaming",tag:"DRG",stage:"UB Final",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-08-20",opp:"TYLOO",tag:"TYL",stage:"UB Semi",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2025-08-03",opp:"EDward Gaming",tag:"EDG",stage:"UB Quarter",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2025-07-26",opp:"Trace Esports",tag:"TE",stage:"Regular Season",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-07-23",opp:"Titan Esports Club",tag:"TEC",stage:"Regular Season",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2025-07-18",opp:"JDG Esports",tag:"JDG",stage:"Regular Season",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2025-07-04",opp:"TYLOO",tag:"TYL",stage:"Regular Season",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
  ]},{tournament:"VALORANT Champions 2025 (Paris)",intl:true,matches:[
    {date:"2025-09-20",opp:"Rex Regum Qeon",tag:"RRQ",stage:"Group B Elim.",fmt:"Bo3",bs:1,os:2,r:"loss",maps:[]},
    {date:"2025-09-15",opp:"MIBR",tag:"MIBR",stage:"Group B Opening",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
  ]},{tournament:"Super Champions Cup 2025",intl:true,matches:[
    {date:"2025-11-30",opp:"EDward Gaming",tag:"EDG",stage:"3rd Place",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2025-11-29",opp:"LEVIAT√ÅN",tag:"LEV",stage:"Semifinal",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-11-29",opp:"Wolves Esports",tag:"WOL",stage:"Quarterfinal",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2025-11-29",opp:"DRX",tag:"DRX",stage:"Group Stage",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
  ]},{tournament:"Shanghai Esports Masters 2025",intl:false,matches:[
    {date:"2025-12-04",opp:"EDward Gaming",tag:"EDG",stage:"Semifinal",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
  ]},{tournament:"Radiant Intl. Invitational 2025",intl:true,matches:[
    {date:"2025-12-19",opp:"Nova Esports",tag:"NOVA",stage:"Day 2",fmt:"Bo1",bs:0,os:1,r:"loss",maps:[{n:"Pearl",b:11,o:13,r:"loss"}]},
    {date:"2025-12-19",opp:"Paper Rex",tag:"PRX",stage:"Day 2",fmt:"Bo1",bs:0,os:1,r:"loss",maps:[{n:"Split",b:9,o:13,r:"loss"}]},
    {date:"2025-12-18",opp:"G2 Esports",tag:"G2",stage:"Day 1",fmt:"Bo1",bs:0,os:1,r:"loss",maps:[{n:"Corrode",b:3,o:13,r:"loss"}]},
    {date:"2025-12-18",opp:"Gen.G",tag:"GEN",stage:"Day 1",fmt:"Bo1",bs:0,os:1,r:"loss",maps:[{n:"Corrode",b:5,o:13,r:"loss"}]},
  ]}],
  "2026":[
  {tournament:"VCT 2026: China Kickoff",intl:false,matches:[
    {date:"2026-02-09",opp:"EDward Gaming",tag:"EDG",stage:"Lower Final",fmt:"Bo5",bs:1,os:3,r:"loss",maps:[{n:"Pearl",b:13,o:9,r:"win"},{n:"Haven",b:10,o:13,r:"loss"},{n:"Abyss",b:10,o:13,r:"loss"},{n:"Split",b:6,o:13,r:"loss"}]},
    {date:"2026-02-08",opp:"Xi Lai Gaming",tag:"XLG",stage:"Middle Final",fmt:"Bo5",bs:2,os:3,r:"loss",maps:[{n:"Abyss",b:16,o:14,r:"win"},{n:"Bind",b:4,o:13,r:"loss"},{n:"Breeze",b:14,o:12,r:"win"},{n:"Pearl",b:11,o:13,r:"loss"},{n:"Split",b:4,o:13,r:"loss"}]},
    {date:"2026-02-06",opp:"Dragon Ranger Gaming",tag:"DRG",stage:"Mid Round 4",fmt:"Bo3",bs:2,os:0,r:"win",maps:[{n:"Split",b:13,o:6,r:"win"},{n:"Abyss",b:13,o:2,r:"win"}]},
    {date:"2026-02-04",opp:"EDward Gaming",tag:"EDG",stage:"Mid Round 3",fmt:"Bo3",bs:2,os:1,r:"win",maps:[{n:"Abyss",b:13,o:7,r:"win"},{n:"Haven",b:9,o:13,r:"loss"},{n:"Breeze",b:13,o:5,r:"win"}]},
    {date:"2026-01-30",opp:"Trace Esports",tag:"TE",stage:"Mid Round 2",fmt:"Bo3",bs:2,os:0,r:"win",maps:[{n:"Abyss",b:13,o:10,r:"win"},{n:"Breeze",b:13,o:11,r:"win"}]},
    {date:"2026-01-29",opp:"FunPlus Phoenix",tag:"FPX",stage:"Mid Round 1",fmt:"Bo3",bs:2,os:0,r:"win",maps:[{n:"Pearl",b:13,o:9,r:"win"},{n:"Bind",b:17,o:15,r:"win"}]},
    {date:"2026-01-25",opp:"All Gamers",tag:"AG",stage:"Upper Round 2",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[{n:"Split",b:10,o:13,r:"loss"},{n:"Abyss",b:3,o:13,r:"loss"}]},
  ]}],
  "2023":[
  {tournament:"VALORANT Champions 2023 (LA)",intl:true,matches:[
    {date:"2023-08-19",opp:"EDward Gaming",tag:"EDG",stage:"Lower Round 1",fmt:"Bo3",bs:1,os:2,r:"loss",maps:[]},
    {date:"2023-08-18",opp:"DRX",tag:"DRX",stage:"Upper Quarterfinals",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2023-08-14",opp:"NRG Esports",tag:"NRG",stage:"Decider (C)",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2023-08-10",opp:"Fnatic",tag:"FNC",stage:"Winner's (C)",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2023-08-09",opp:"NRG Esports",tag:"NRG",stage:"Opening (C)",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
  ]},
  {tournament:"Champions Tour 2023: Champions CQ",intl:false,matches:[
    {date:"2023-07-16",opp:"EDward Gaming",tag:"EDG",stage:"Grand Final",fmt:"Bo5",bs:1,os:3,r:"loss",maps:[]},
    {date:"2023-07-15",opp:"FunPlus Phoenix",tag:"FPX",stage:"Lower Final",fmt:"Bo5",bs:3,os:2,r:"win",maps:[]},
    {date:"2023-07-13",opp:"EDward Gaming",tag:"EDG",stage:"Upper Final",fmt:"Bo5",bs:0,os:3,r:"loss",maps:[]},
    {date:"2023-07-08",opp:"Trace Esports",tag:"TE",stage:"Playoffs",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2023-07-05",opp:"Mysterious Esports",tag:"ME",stage:"Playoffs",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
  ]},
  {tournament:"China Evolution Series: Act 3",intl:false,matches:[
    {date:"2023-11-21",opp:"Titan Esports Club",tag:"TEC",stage:"Group Stage",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2023-11-19",opp:"Attacking Soul Esports",tag:"ASE",stage:"Group Stage",fmt:"Bo3",bs:2,os:1,r:"win",maps:[]},
    {date:"2023-11-16",opp:"LGD Gaming",tag:"LGD",stage:"Group Stage",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2023-11-07",opp:"Royal Never Give Up",tag:"RNG",stage:"Group Stage",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2023-11-06",opp:"Nongshim Wolves Gaming",tag:"NWG",stage:"Group Stage",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
  ]},
  {tournament:"China Evolution Series: Act 2",intl:false,matches:[
    {date:"2023-10-24",opp:"Trace Esports",tag:"TE",stage:"Playoffs",fmt:"Bo3",bs:2,os:1,r:"win",maps:[]},
    {date:"2023-10-22",opp:"EDward Gaming",tag:"EDG",stage:"Playoffs",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2023-10-21",opp:"Trace Esports",tag:"TE",stage:"Playoffs",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2023-10-12",opp:"Royal Never Give Up",tag:"RNG",stage:"Group Stage",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
    {date:"2023-10-10",opp:"Ninjas in Pyjamas",tag:"NIP",stage:"Group Stage",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
  ]},
  {tournament:"China Evolution Series: Act 1",intl:false,matches:[
    {date:"2023-09-28",opp:"Trace Esports",tag:"TE",stage:"Loser's Bracket",fmt:"Bo3",bs:2,os:1,r:"win",maps:[]},
    {date:"2023-09-26",opp:"FunPlus Phoenix",tag:"FPX",stage:"Winner's Bracket",fmt:"Bo3",bs:0,os:2,r:"loss",maps:[]},
    {date:"2023-09-24",opp:"Weibo Gaming",tag:"WBG",stage:"Winner's Bracket",fmt:"Bo3",bs:2,os:0,r:"win",maps:[]},
  ]}]
};

let allData=JSON.parse(JSON.stringify(baselineData)),activeYear=String(new Date().getFullYear());
// Ensure current year exists
if(!allData[activeYear])allData[activeYear]=[];
// If current year has no data yet, also show latest year with data
const _latestWithData=Object.keys(allData).sort((a,b)=>b-a).find(y=>(allData[y]||[]).some(t=>t.matches.length>0));
if(_latestWithData&&(!allData[activeYear]||!allData[activeYear].some(t=>t.matches.length>0)))activeYear=_latestWithData;

function cs(yf){let w=0,l=0,mw=0,ml=0;(yf==='all'?Object.keys(allData):[yf]).forEach(y=>(allData[y]||[]).forEach(t=>t.matches.forEach(m=>{m.r==='win'?w++:l++;mw+=m.bs;ml+=m.os})));const t=w+l;return{w,l,mw,ml,total:t,wr:t?Math.round(w/t*100):0}}
function cys(y){let w=0,l=0;(allData[y]||[]).forEach(t=>t.matches.forEach(m=>m.r==='win'?w++:l++));return{w,l,total:w+l}}

function renderStats(){const s=cs(activeYear);document.getElementById('statsBar').innerHTML=`<div class="si"><div class="sv bc">${s.total}</div><div class="sl">Ï¥ù Í≤ΩÍ∏∞</div></div><div class="si"><div class="sv wc">${s.w}</div><div class="sl">ÏäπÎ¶¨</div></div><div class="si"><div class="sv lc">${s.l}</div><div class="sl">Ìå®Î∞∞</div></div><div class="si"><div class="sv bc">${s.wr}%</div><div class="sl">ÏäπÎ•†</div></div><div class="si"><div class="sv" style="color:var(--txt)">${s.mw}<span style="color:var(--dimmer)">:</span>${s.ml}</div><div class="sl">Îßµ Ïä§ÏΩîÏñ¥</div></div>`}

function renderYearTabs(){const yrs=Object.keys(allData).sort((a,b)=>b-a);let h='';yrs.forEach(y=>{const s=cys(y);h+=`<button class="yt ${y===activeYear?'active':''}" data-year="${y}">${y}<span class="cnt">${s.total}</span></button>`});document.getElementById('yearTabs').innerHTML=h;document.querySelectorAll('.yt').forEach(b=>{b.onclick=()=>{activeYear=b.dataset.year;renderAll()}})}

function mapHTML(maps){if(!maps||!maps.length)return'<div style="padding:12px;text-align:center;color:var(--dimmer);font-size:12px">Îßµ ÏÉÅÏÑ∏ Ïä§ÏΩîÏñ¥Í∞Ä ÏóÜÏäµÎãàÎã§</div>';let h=`<div class="dms"><div class="dmt">ÎßµÎ≥Ñ ÏÉÅÏÑ∏ Í≤∞Í≥º</div>`;maps.forEach((mp,i)=>{const w=mp.r==='win',t=(mp.b||0)+(mp.o||0)||1,p=Math.round(((mp.b||0)/t)*100);h+=`<div class="md"><div class="md-n">MAP ${i+1}</div><div class="md-m">${mp.n}</div><div class="md-bw"><div class="md-bar"><div class="md-bf ${w?'bw':'bl'}" style="width:${p}%"></div></div></div><div class="md-s"><span class="${w?'mws':'mls'}">${mp.b}</span><span class="msp">:</span><span class="${w?'mls':'mws'}">${mp.o}</span></div><div class="md-r ${w?'rw':'rl'}">${w?'W':'L'}</div></div>`});return h+'</div>'}

function detHTML(m,tn,il){const narr=fbNarr(m,tn);return mapHTML(m.maps)+`<div class="dn"><div class="dnt">Í≤ΩÍ∏∞ Î∂ÑÏÑù</div><div class="dtx">${narr}</div></div><div class="dmeta"><span class="mt">${tn}</span><span class="mt">${m.fmt}</span><span class="mt">${m.stage}</span><span class="mt ${m.r==='win'?'mtwn':'mtls'}">${m.r==='win'?'‚úì ÏäπÎ¶¨':'‚úó Ìå®Î∞∞'}</span>${il?'<span class="mt mtil">üåç Íµ≠Ï†ú ÎåÄÌöå</span>':''}<span class="mt">${m.date}</span></div>`}

function fbNarr(m,tn){const w=m.r==='win',mt=m.maps&&m.maps.length?m.maps.map((p,i)=>`<strong>Map ${i+1} (${p.n})</strong> ${p.b}-${p.o} ${p.r==='win'?'ÏäπÎ¶¨':'Ìå®Î∞∞'}`).join(', ')+'.':'';return w?`<strong>BLG</strong>Í∞Ä <strong>${tn} ${m.stage}</strong>ÏóêÏÑú <strong>${m.opp}</strong>Î•º <strong>${m.bs}:${m.os}</strong>ÏúºÎ°ú Í∫æÏóàÏäµÎãàÎã§. ${mt} ÌåÄ Ï†ÑÏ≤¥Ï†ÅÏúºÎ°ú ÏïàÏ†ïÏ†ÅÏù∏ Ìï©ÏùÑ Î≥¥Ïó¨Ï£ºÎ©∞ ÏäπÎ¶¨Î•º Í∞ÄÏ†∏Í∞îÏäµÎãàÎã§.`:`<strong>BLG</strong>Í∞Ä <strong>${tn} ${m.stage}</strong>ÏóêÏÑú <strong>${m.opp}</strong>ÏóêÍ≤å <strong>${m.bs}:${m.os}</strong>ÏúºÎ°ú Ìå®Î∞∞ÌñàÏäµÎãàÎã§. ${mt} ÏïÑÏâ¨Ïö¥ Í≤∞Í≥ºÏßÄÎßå Îã§Ïùå Í≤ΩÍ∏∞ÏóêÏÑúÏùò Î∞òÎì±Ïù¥ Í∏∞ÎåÄÎê©ÎãàÎã§.`}

function toggleDetail(wid,y,ti,mi){const wrap=document.getElementById(wid);const open=wrap.classList.contains('open');document.querySelectorAll('.mw.open').forEach(el=>{if(el.id!==wid)el.classList.remove('open')});if(open){wrap.classList.remove('open');return}
wrap.classList.add('open');const panel=wrap.querySelector('.di'),t=allData[String(y)][ti],m=t.matches[mi];
panel.innerHTML=detHTML(m,t.tournament,t.intl);setTimeout(()=>{wrap.querySelectorAll('.md-bf').forEach(el=>{const w=el.style.width;el.style.width='0%';requestAnimationFrame(()=>el.style.width=w)})},50)}

// ===== BILIBILI VOD MAP (Í≥µÏãù Ï±ÑÎÑê: Êó†ÁïèÂ•ëÁ∫¶Ëµõ‰∫ã, UID:2071691173) =====
const biliVodMap={
// 2026 VCT CN Kickoff
'BLG vs EDG 2026-02-09':'BV1rTcMzCEUv','EDG vs BLG 2026-02-09':'BV1rTcMzCEUv',
'XLG vs BLG 2026-02-08':'BV1xxcFzbEA7','BLG vs XLG 2026-02-08':'BV1xxcFzbEA7',
'DRG vs BLG 2026-02-06':'BV1hBF6zUEXm','BLG vs DRG 2026-02-06':'BV1hBF6zUEXm',
'EDG vs BLG 2026-02-04':'BV1PLfoB1ENV','BLG vs EDG 2026-02-04':'BV1PLfoB1ENV',
'TE vs BLG 2026-01-30':'BV1sT6qByExf','BLG vs TE 2026-01-30':'BV1sT6qByExf',
'FPX vs BLG 2026-01-29':'BV1Vm6wB8Em4','BLG vs FPX 2026-01-29':'BV1Vm6wB8Em4',
'BLG vs AG 2026-01-25':'BV14wzQBnEWW','AG vs BLG 2026-01-25':'BV14wzQBnEWW',
// 2025 Radiant Intl. Invitational
'NOVA vs BLG 2025-12-19':'BV1LABcB9EQC','BLG vs NOVA 2025-12-19':'BV1LABcB9EQC',
'PRX vs BLG 2025-12-19':'BV1B3qZBDE1y','BLG vs PRX 2025-12-19':'BV1B3qZBDE1y',
'BLG vs G2 2025-12-18':'BV15oqHBLEvM','G2 vs BLG 2025-12-18':'BV15oqHBLEvM',
'BLG vs GEN 2025-12-18':'BV1HpqpB4Efs','GEN vs BLG 2025-12-18':'BV1HpqpB4Efs',
// 2025 Champions (Paris)
'BLG vs RRQ 2025-09-20':'BV1NHpRzTEQQ','RRQ vs BLG 2025-09-20':'BV1NHpRzTEQQ',
'BLG vs MIBR 2025-09-15':'BV1eVpBzqEqM','MIBR vs BLG 2025-09-15':'BV1eVpBzqEqM',
// 2025 Evolution Series Act 3
'WOL vs BLG 2025-08-29':'BV1K8hdzFEKe','BLG vs WOL 2025-08-29':'BV1K8hdzFEKe',
// 2025 VCT CN Stage 2
'DRG vs BLG 2025-08-24':'BV1uneJzgEaZ','BLG vs DRG 2025-08-24':'BV1uneJzgEaZ',
'BLG vs EDG 2025-08-23':'BV1neeBzVEVw','EDG vs BLG 2025-08-23':'BV1neeBzVEVw',
'BLG vs DRG 2025-08-22':'BV1r8e4zjE9V','DRG vs BLG 2025-08-22':'BV1r8e4zjE9V',
'BLG vs TYL 2025-08-20':'BV1MKe3zmEQD','TYL vs BLG 2025-08-20':'BV1MKe3zmEQD',
'BLG vs EDG 2025-08-03':'BV1knhVzNEwH','EDG vs BLG 2025-08-03':'BV1knhVzNEwH',
'BLG vs TE 2025-07-26':'BV1sL88zmEA6','TE vs BLG 2025-07-26':'BV1sL88zmEA6',
'TEC vs BLG 2025-07-23':'BV14c8Az5E2i','BLG vs TEC 2025-07-23':'BV14c8Az5E2i',
'JDG vs BLG 2025-07-18':'BV1PFu2zGE1x','BLG vs JDG 2025-07-18':'BV1PFu2zGE1x',
'BLG vs TYL 2025-07-04':'BV1er3jzUEQv','TYL vs BLG 2025-07-04':'BV1er3jzUEQv',
// 2025 EWC
'KC vs BLG 2025-07-10':'BV177GGzCEaP','BLG vs KC 2025-07-10':'BV177GGzCEaP',
'BLG vs G2 2025-07-09':'BV1RHGczgEC5','G2 vs BLG 2025-07-09':'BV1RHGczgEC5',
'PRX vs BLG 2025-07-08':'BV1ckGJzzExu','BLG vs PRX 2025-07-08':'BV1ckGJzzExu',
// 2025 Masters Toronto
'BLG vs WOL 2025-06-12':'BV1FVMHzYEZ3','WOL vs BLG 2025-06-12':'BV1FVMHzYEZ3',
'BLG vs SEN 2025-06-10':'BV1nLTBzGEDP','SEN vs BLG 2025-06-10':'BV1nLTBzGEDP',
'BLG vs TL 2025-06-08':'BV1VTTUztEoq','TL vs BLG 2025-06-08':'BV1VTTUztEoq',
// 2025 HERO ACL
'BLG vs DRX 2025-05-16':'BV1zhEtz6EBw','DRX vs BLG 2025-05-16':'BV1zhEtz6EBw',
'TE vs BLG 2025-05-15':'BV1PLE2zeE7d','BLG vs TE 2025-05-15':'BV1PLE2zeE7d',
'BLG vs DRX 2025-05-14':'BV1SbEBzQEMF','DRX vs BLG 2025-05-14':'BV1SbEBzQEMF',
// 2025 Evolution Series
'TEC vs BLG 2025-05-08':'BV1xk5Pz3Ern','BLG vs TEC 2025-05-08':'BV1xk5Pz3Ern',
// 2025 VCT CN Stage 1
'XLG vs BLG 2025-05-04':'BV1W5VwzZEEk','BLG vs XLG 2025-05-04':'BV1W5VwzZEEk',
'WOL vs BLG 2025-05-03':'BV1YgVHzAEVP','BLG vs WOL 2025-05-03':'BV1YgVHzAEVP',
'BLG vs EDG 2025-05-02':'BV16fV3zUEwh','EDG vs BLG 2025-05-02':'BV16fV3zUEwh',
'BLG vs TE 2025-04-20':'BV139LFz3EBH','TE vs BLG 2025-04-20':'BV139LFz3EBH',
'BLG vs WOL 2025-04-19':'BV1sr5szaERQ','WOL vs BLG 2025-04-19':'BV1sr5szaERQ',
'BLG vs TE 2025-04-12':'BV1wbdaYzE5h','TE vs BLG 2025-04-12':'BV1wbdaYzE5h',
'BLG vs WOL 2025-04-04':'BV1ooZRYvEqQ','WOL vs BLG 2025-04-04':'BV1ooZRYvEqQ',
'AG vs BLG 2025-03-30':'BV1koZBYhEuv','BLG vs AG 2025-03-30':'BV1koZBYhEuv',
'BLG vs JDG 2025-03-23':'BV1jeXaYsEjN','JDG vs BLG 2025-03-23':'BV1jeXaYsEjN',
'XLG vs BLG 2025-03-13':'BV1nyQwYGEus','BLG vs XLG 2025-03-13':'BV1nyQwYGEus',
// 2025 Evolution Act 1
'BLG vs JDG 2025-02-15':'BV1wjANeEEbx','JDG vs BLG 2025-02-15':'BV1wjANeEEbx',
'BLG vs NOVA 2025-02-14':'BV1utKKe6Ek3','NOVA vs BLG 2025-02-14':'BV1utKKe6Ek3',
'BLG vs TYL 2025-02-10':'BV1KHNZekEWn','TYL vs BLG 2025-02-10':'BV1KHNZekEWn',
// 2025 VCT CN Kickoff
'BLG vs EDG 2025-01-24':'BV1fHfHY5Ext','EDG vs BLG 2025-01-24':'BV1fHfHY5Ext',
'BLG vs AG 2025-01-23':'BV1QEfVY5ECE','AG vs BLG 2025-01-23':'BV1QEfVY5ECE',
'FPX vs BLG 2025-01-20':'BV1PowHewExj','BLG vs FPX 2025-01-20':'BV1PowHewExj',
'BLG vs XLG 2025-01-16':'BV1YMwje8EYq','XLG vs BLG 2025-01-16':'BV1YMwje8EYq',
// 2024 Asian Invitational
'TE vs BLG 2024-11-24':'BV1biBxYZEXq','BLG vs TE 2024-11-24':'BV1biBxYZEXq',
'DRX vs BLG 2024-11-22':'BV1zjBqY3ESQ','BLG vs DRX 2024-11-22':'BV1zjBqY3ESQ',
// 2024 FGC
'BLG vs WOL 2024-11-10':'BV154m6YeEBz','WOL vs BLG 2024-11-10':'BV154m6YeEBz',
'WOL vs BLG 2024-11-08':'BV1vADZY9EYS','BLG vs WOL 2024-11-08':'BV1vADZY9EYS',
'BLG vs NOVA 2024-11-06':'BV1KkDVYJEBk','NOVA vs BLG 2024-11-06':'BV1KkDVYJEBk',
'BLG vs XLG 2024-11-01':'BV1mQSoYMENM','XLG vs BLG 2024-11-01':'BV1mQSoYMENM',
// 2024 Champions (Seoul)
'BLG vs KR√ú 2024-08-08':'BV12f421q7GV','KR√ú vs BLG 2024-08-08':'BV12f421q7GV',
'FNC vs BLG 2024-08-02':'BV1Cz421i7XG','BLG vs FNC 2024-08-02':'BV1Cz421i7XG',
// 2024 VCT CN Stage 2
'FPX vs BLG 2024-07-18':'BV1KS421d7Nz','BLG vs FPX 2024-07-18':'BV1KS421d7Nz',
'EDG vs BLG 2024-07-17':'BV1nz421q7DL','BLG vs EDG 2024-07-17':'BV1nz421q7DL',
'JDG vs BLG 2024-07-16':'BV1yr421T76t','BLG vs JDG 2024-07-16':'BV1yr421T76t',
'EDG vs BLG 2024-07-06':'BV1TT421k73r','BLG vs EDG 2024-07-06':'BV1TT421k73r',
'BLG vs DRG 2024-06-30':'BV1ey411q775','DRG vs BLG 2024-06-30':'BV1ey411q775',
'NOVA vs BLG 2024-06-23':'BV11r421F7du','BLG vs NOVA 2024-06-23':'BV11r421F7du',
'BLG vs WOL 2024-06-16':'BV1ES421d7KH','WOL vs BLG 2024-06-16':'BV1ES421d7KH',
// 2024 VCT CN Stage 1
'BLG vs FPX 2024-05-04':'BV1Mm411y7XQ','FPX vs BLG 2024-05-04':'BV1Mm411y7XQ',
'BLG vs JDG 2024-04-28':'BV1T142197mu','JDG vs BLG 2024-04-28':'BV1T142197mu',
'TEC vs BLG 2024-04-26':'BV1im421s7xu','BLG vs TEC 2024-04-26':'BV1im421s7xu',
'BLG vs AG 2024-04-20':'BV1WD421H7B9','AG vs BLG 2024-04-20':'BV1WD421H7B9',
'TE vs BLG 2024-04-13':'BV1kJ4m1V7Wv','BLG vs TE 2024-04-13':'BV1kJ4m1V7Wv',
'BLG vs TYL 2024-04-05':'BV18J4m1j7JE','TYL vs BLG 2024-04-05':'BV18J4m1j7JE',
// 2024 VCT CN Kickoff
'BLG vs TE 2024-02-27':'BV1Az421X7jZ','TE vs BLG 2024-02-27':'BV1Az421X7jZ',
'BLG vs TEC 2024-02-27':'BV1XC411W7n8','TEC vs BLG 2024-02-27':'BV1XC411W7n8',
'WOL vs BLG 2024-02-26':'BV1xK421t7ER','BLG vs WOL 2024-02-26':'BV1xK421t7ER',
'WOL vs BLG 2024-02-23':'BV1oj421D7RY','BLG vs WOL 2024-02-23':'BV1oj421D7RY',
// 2023 Evolution Series Act 3
'TEC vs BLG 2023-11-21':'BV1EC4y117gz','BLG vs TEC 2023-11-21':'BV1EC4y117gz',
'ASE vs BLG 2023-11-19':'BV14g4y1X7o8','BLG vs ASE 2023-11-19':'BV14g4y1X7o8',
'BLG vs LGD 2023-11-16':'BV1Mz4y1c7Mj','LGD vs BLG 2023-11-16':'BV1Mz4y1c7Mj',
'BLG vs RNG 2023-11-07':'BV1DQ4y1n7nw','RNG vs BLG 2023-11-07':'BV1DQ4y1n7nw',
'NWG vs BLG 2023-11-06':'BV1Ge411X7XE','BLG vs NWG 2023-11-06':'BV1Ge411X7XE',
// 2023 Evolution Series Act 2
'BLG vs TE 2023-10-24':'BV1Vu4y1n7FL','TE vs BLG 2023-10-24':'BV1Vu4y1n7FL',
'BLG vs EDG 2023-10-22':'BV1Kp4y1M7Z5','EDG vs BLG 2023-10-22':'BV1Kp4y1M7Z5',
'BLG vs TE 2023-10-21':'BV1B34y1M7aj','TE vs BLG 2023-10-21':'BV1B34y1M7aj',
'RNG vs BLG 2023-10-12':'BV1mG411m7rh','BLG vs RNG 2023-10-12':'BV1mG411m7rh',
'NIP vs BLG 2023-10-10':'BV1PH4y1R7g3','BLG vs NIP 2023-10-10':'BV1PH4y1R7g3',
// 2023 Evolution Series Act 1
'BLG vs TE 2023-09-28':'BV1ZH4y1o792','TE vs BLG 2023-09-28':'BV1ZH4y1o792',
'FPX vs BLG 2023-09-26':'BV1MC4y1f7C1','BLG vs FPX 2023-09-26':'BV1MC4y1f7C1',
'BLG vs WBG 2023-09-24':'BV1Ww411m7tp','WBG vs BLG 2023-09-24':'BV1Ww411m7tp',
// 2023 Champions (LA) + CQ
'BLG vs EDG 2023-08-19':'BV1cz4y1u77g','EDG vs BLG 2023-08-19':'BV1cz4y1u77g',
'DRX vs BLG 2023-08-18':'BV1m8411972F','BLG vs DRX 2023-08-18':'BV1m8411972F',
'BLG vs NRG 2023-08-14':'BV1au411E71o','NRG vs BLG 2023-08-14':'BV1au411E71o',
'FNC vs BLG 2023-08-10':'BV1aj411z7pH','BLG vs FNC 2023-08-10':'BV1aj411z7pH',
'NRG vs BLG 2023-08-09':'BV1w8411R7Y7','BLG vs NRG 2023-08-09':'BV1w8411R7Y7',
'EDG vs BLG 2023-07-16':'BV118411U7fD','BLG vs EDG 2023-07-16':'BV118411U7fD',
'BLG vs FPX 2023-07-15':'BV1hx4y1o7PL','FPX vs BLG 2023-07-15':'BV1hx4y1o7PL',
'BLG vs EDG 2023-07-13':'BV1tz4y177SS','EDG vs BLG 2023-07-13':'BV1tz4y177SS',
'BLG vs TE 2023-07-08':'BV1cP411y7KL','TE vs BLG 2023-07-08':'BV1cP411y7KL',
'BLG vs ME 2023-07-05':'BV1wu41187NT','ME vs BLG 2023-07-05':'BV1wu41187NT',
};
const cnTeamNames={
  'All Gamers':'AG','AG':'AG','FunPlus Phoenix':'FPX','FPX':'FPX',
  'Trace Esports':'TE','TE':'TE','EDward Gaming':'EDG','EDG':'EDG',
  'Dragon Ranger Gaming':'DRG','DRG':'DRG','Xi Lai Gaming':'XLG','XLG':'XLG',
  'TYLOO':'TYL','TYL':'TYL','JDG Esports':'JDG','JDG':'JDG',
  'Wolves Esports':'WOL','WOL':'WOL','Nova Esports':'NOVA','NOVA':'NOVA',
  'Titan Esports Club':'TEC','TEC':'TEC',
  'Paper Rex':'PRX','PRX':'PRX','G2 Esports':'G2','G2':'G2',
  'Gen.G':'GEN','GEN':'GEN','Sentinels':'SEN','SEN':'SEN',
  'Team Liquid':'TL','TL':'TL','Karmine Corp':'KC','KC':'KC',
  'MIBR':'MIBR','RRQ':'RRQ','Fnatic':'FNC','FNC':'FNC',
  'NRG Esports':'NRG','NRG':'NRG','DRX':'DRX','KR√ú Esports':'KR√ú','KR√ú':'KR√ú',
  'Rex Regum Qeon':'RRQ','Leviat√°n':'LEV','LEV':'LEV',
  'Nongshim RedForce':'NS','NS':'NS',
  'LGD Gaming':'LGD','LGD':'LGD','Royal Never Give Up':'RNG','RNG':'RNG',
  'Ninjas in Pyjamas':'NIP','NIP':'NIP','Weibo Gaming':'WBG','WBG':'WBG',
  'Made in Brazil':'MIBR','Attacking Soul Esports':'ASE','ASE':'ASE',
  'Nongshim Wolves Gaming':'NWG','NWG':'NWG','Mysterious Esports':'ME','ME':'ME',
};
function findBiliVod(opp, date){
  const tag=cnTeamNames[opp]||opp;
  const keys=[`BLG vs ${opp} ${date}`,`${opp} vs BLG ${date}`,`BLG vs ${tag} ${date}`,`${tag} vs BLG ${date}`];
  for(const k of keys){if(biliVodMap[k])return biliVodMap[k];}
  return null;
}
function getBiliSearchUrl(opp, date, tournament){
  const tag=cnTeamNames[opp]||opp;
  const d=new Date(date);const m=d.getMonth()+1;const day=d.getDate();const yr=d.getFullYear();
  // Map tournament names to Chinese search terms
  const tnMap={
    'VCT 2026: China Kickoff':`${yr}VCTCNÂêØÁÇπËµõ`,
    'VCT 2025: China Kickoff':`${yr}VCTCNÂêØÁÇπËµõ`,
    'VCT 2024: China Kickoff':'VCTCNÂêØÁÇπËµõ',
    'VCT 2025: China Stage 1':`${yr}VCTCNÁ¨¨‰∏ÄËµõÊÆµ`,
    'VCT 2025: China Stage 2':`${yr}VCTCNÁ¨¨‰∫åËµõÊÆµ`,
    'VCT 2024: China Stage 1':'VCT CN Á¨¨‰∏ÄËµõÊÆµ',
    'VCT 2024: China Stage 2':'VCT CN Á¨¨‰∫åËµõÊÆµ',
    'China Evolution Series: Act 1':'ËøõÂåñËÄÖÁ≥ªÂàóÂÖ¨ÂºÄËµõ',
    'China Evolution Series: Act 2':'ËøõÂåñËÄÖÁ≥ªÂàóÂÖ¨ÂºÄËµõ Á¨¨‰∫åÂπï',
    'China Evolution Series: Act 3':'ËøõÂåñËÄÖÁ≥ªÂàóÂÖ¨ÂºÄËµõ Á¨¨‰∏âÂπï',
    'China Evolution Series 2025: Act 1':'2025ËøõÂåñËÄÖÊùØÁ¨¨‰∏ÄÂπï',
    'China Evolution Series 2025: Act 2':'2025ËøõÂåñËÄÖÊùØÁ≥ªÂàóËµõ',
    'China Evolution Series 2025: Act 3':'2025ËøõÂåñËÄÖÊùØÁ¨¨‰∏âÂπï',
    'FGC Invitational 2024':'2024FGC',
    'VALORANT Champions 2024 (Seoul)':'2024ÂÖ®ÁêÉÂÜ†ÂÜõËµõ',
    'VALORANT Champions 2023 (LA)':'ÂÖ®ÁêÉÂÜ†ÂÜõËµõ',
    'Champions Tour 2023: Champions CQ':'ÂÖ®ÁêÉÂÜ†ÂÜõËµõCQ',
    'VALORANT Champions 2025 (Paris)':'Êó†ÁïèÂ•ëÁ∫¶Â∑¥ÈªéÂÖ®ÁêÉÂÜ†ÂÜõËµõ',
    'VCT Masters Toronto 2025':'2025Â§ö‰º¶Â§öÂ§ßÂ∏àËµõ',
    'Esports World Cup 2025':'2025EWCÊó†ÁïèÂ•ëÁ∫¶',
    'Super Champions Cup 2025':'Ë∂ÖÁ∫ßÂÜ†ÂÜõÊùØ2025',
    'Shanghai Esports Masters 2025':'‰∏äÊµ∑ÁîµÁ´ûÂ§ßÂ∏àËµõ2025',
    'Radiant Asia Invitational 2024':'2024‰∫öÊ¥≤ÈÇÄËØ∑Ëµõ',
    'SOOP Valorant League 2024':'SOOPÊó†ÁïèÂ•ëÁ∫¶ËÅîËµõ2024',
    'HERO Asian Champions League 2025':'Ëã±ÈõÑ‰∫öÂÜ†ACL',
    'Radiant Intl. Invitational 2025':'Êó†ÁïèÂ•ëÁ∫¶Ê∫êËÉΩÂõΩÈôÖÈÇÄËØ∑Ëµõ',
  };
  const cnTn=tnMap[tournament]||tournament||'Êó†ÁïèÂ•ëÁ∫¶';
  const q=`${cnTn} ${m}Êúà${day}Êó• BLG ${tag}`;
  return `https://search.bilibili.com/all?keyword=${encodeURIComponent(q)}&from_source=webtop_search`;
}

function renderMatches(){const main=document.getElementById('main');const yrs=Object.keys(allData).sort((a,b)=>b-a);let h='';
yrs.forEach(y=>{const a=y===activeYear,s=cys(y);
// Sort tournaments by latest match date (newest first)
const sorted=[...(allData[y]||[])].map((t,oi)=>({...t,_oi:oi}));
sorted.forEach(t=>t.matches.sort((a,b)=>b.date.localeCompare(a.date)));
sorted.sort((a,b)=>{const ad=a.matches[0]?.date||'';const bd=b.matches[0]?.date||'';return bd.localeCompare(ad)});
h+=`<div class="ys ${a?'active':''}" data-year="${y}"><div class="yh"><div class="yn">${y}</div><div class="ysm"><span class="w">${s.w}W</span> / <span class="l">${s.l}L</span> ¬∑ ${s.total}Í≤ΩÍ∏∞</div></div>`;
sorted.forEach((t)=>{const ti=t._oi;h+=`<div class="tg"><div class="th"><div class="tb ${t.intl?'intl':''}"></div><span class="tn">${t.tournament}</span><span class="tbg ${t.intl?'intl':''}">${t.intl?'üåç Íµ≠Ï†ú':'üá®üá≥ Ï§ëÍµ≠'}</span></div>`;
t.matches.forEach((m,mi)=>{const w=m.r==='win',id=`w_${y}_${ti}_${mi}`;
const vodQ=`BLG vs ${m.opp} ${t.tournament} VALORANT ${m.date}`;
const vodQEnc=encodeURIComponent(vodQ);
const vodLabel=('BLG vs '+m.tag+' ¬∑ '+m.date+' ¬∑ '+m.stage).replace(/'/g,"\\'");
const directBvid=findBiliVod(m.opp, m.date)||findBiliVod(m.tag, m.date)||'';
const biliSearchUrl=getBiliSearchUrl(m.opp, m.date, t.tournament);
h+=`<div class="mw" id="${id}"><div class="mc ${m.r}" onclick="toggleDetail('${id}',${y},${ti},${mi})">
<div class="tl">${L('BLG')}<div><div class="tm blg">BLG</div><div class="tt">Bilibili Gaming</div></div></div>
<div class="scc"><div class="sc"><span class="${w?'ws':'ls'}">${m.bs}</span><span class="sp">:</span><span class="${w?'ls':'ws'}">${m.os}</span></div><div class="sm">${m.fmt} ¬∑ ${m.date}</div><span class="rb ${m.r}">${w?'WIN':'LOSS'}</span></div>
<div class="tr"><div><div class="tm">${m.tag}</div><div class="tt">${m.opp}</div></div>${L(m.tag)}</div>
${m.maps&&m.maps.length?'<div class="mr">'+m.maps.map(p=>`<span class="mp ${p.r==='win'?'mw2':'ml2'}">${p.n} ${p.b}-${p.o}</span>`).join('')+'</div>':''}
<div class="sr"><span class="sb">${m.stage}</span><span class="vod-btn" onclick="event.stopPropagation();openVod('${vodQEnc}','${vodLabel}','${directBvid}')" title="VOD ÏßÅÏ†ë Î≥¥Í∏∞">üì∫ VOD</span>${directBvid?`<a class="vod-btn" href="https://www.bilibili.com/video/${directBvid}" target="_blank" onclick="event.stopPropagation()" style="background:rgba(0,161,214,.1);border-color:rgba(0,161,214,.2);color:#00a1d6" title="BilibiliÏóêÏÑú Î≥¥Í∏∞">üÖ± BÁ´ô</a>`:`<a class="vod-btn" href="${biliSearchUrl}" target="_blank" onclick="event.stopPropagation()" style="background:rgba(0,161,214,.1);border-color:rgba(0,161,214,.2);color:#00a1d6" title="Bilibili Í≤ÄÏÉâ">üÖ± BÁ´ô</a>`}</div>
<span class="ea">‚ñº</span></div><div class="dp"><div class="di"></div></div></div>`});h+=`</div>`});h+=`</div>`});
main.innerHTML=h}

function renderAll(){renderStats();renderYearTabs();renderUpcoming();renderLiveBanner();renderMatches();renderStatsView();renderRosterView()}

// ===== NOTIFICATION SYSTEM (ÏÜåÎ¶¨ + Î∏åÎùºÏö∞Ï†Ä Ìë∏Ïãú + ÌÜ†Ïä§Ìä∏) =====
let notifEnabled=localStorage.getItem('blg_notif')==='on';
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();

function playNotifSound(type){
  try{
    // type: 'live' (urgent) or 'info' (gentle)
    const now=audioCtx.currentTime;
    if(audioCtx.state==='suspended')audioCtx.resume();
    if(type==='live'){
      // 3-tone ascending alert
      [440,554,659].forEach((freq,i)=>{
        const osc=audioCtx.createOscillator();
        const gain=audioCtx.createGain();
        osc.type='sine';osc.frequency.value=freq;
        gain.gain.setValueAtTime(0,now+i*0.15);
        gain.gain.linearRampToValueAtTime(0.3,now+i*0.15+0.05);
        gain.gain.linearRampToValueAtTime(0,now+i*0.15+0.3);
        osc.connect(gain);gain.connect(audioCtx.destination);
        osc.start(now+i*0.15);osc.stop(now+i*0.15+0.35);
      });
      // Second burst
      setTimeout(()=>{
        const t=audioCtx.currentTime;
        [554,659,880].forEach((freq,i)=>{
          const osc=audioCtx.createOscillator();
          const gain=audioCtx.createGain();
          osc.type='sine';osc.frequency.value=freq;
          gain.gain.setValueAtTime(0,t+i*0.12);
          gain.gain.linearRampToValueAtTime(0.25,t+i*0.12+0.04);
          gain.gain.linearRampToValueAtTime(0,t+i*0.12+0.25);
          osc.connect(gain);gain.connect(audioCtx.destination);
          osc.start(t+i*0.12);osc.stop(t+i*0.12+0.3);
        });
      },600);
    }else{
      // Single gentle chime
      const osc=audioCtx.createOscillator();
      const gain=audioCtx.createGain();
      osc.type='sine';osc.frequency.value=523;
      gain.gain.setValueAtTime(0,now);
      gain.gain.linearRampToValueAtTime(0.2,now+0.05);
      gain.gain.linearRampToValueAtTime(0,now+0.5);
      osc.connect(gain);gain.connect(audioCtx.destination);
      osc.start(now);osc.stop(now+0.6);
    }
  }catch(e){}
}

function sendBrowserNotif(title,body,icon){
  if(Notification.permission==='granted'){
    try{new Notification(title,{body,icon:icon||'',tag:'blg-'+Date.now(),requireInteraction:false})}catch(e){}
  }
}

let toastTimer=null;
function showToast(icon,title,desc,duration){
  // Remove existing
  document.querySelectorAll('.notif-toast').forEach(el=>el.remove());
  const d=document.createElement('div');
  d.className='notif-toast';
  d.innerHTML=`<span class="nt-icon">${icon}</span><div class="nt-body"><div class="nt-title">${title}</div><div class="nt-desc">${desc}</div></div><button class="nt-close" onclick="this.parentElement.classList.add('out');setTimeout(()=>this.parentElement.remove(),300)">‚úï</button>`;
  document.body.appendChild(d);
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>{d.classList.add('out');setTimeout(()=>d.remove(),300)},duration||6000);
}

function notifyLiveStart(opp,event){
  if(!notifEnabled)return;
  playNotifSound('live');
  showToast('üî¥',`BLG Í≤ΩÍ∏∞ ÏãúÏûë!`,`${event} ¬∑ vs ${opp}`,10000);
  sendBrowserNotif('üî¥ BLG ÎùºÏù¥Î∏å!',`${event} ¬∑ vs ${opp}`);
}

function notifyLiveEnd(opp){
  if(!notifEnabled)return;
  playNotifSound('info');
  showToast('üèÅ','Í≤ΩÍ∏∞ Ï¢ÖÎ£å',`vs ${opp} ¬∑ VOD ÏûêÎèô Í≤ÄÏÉâ Ï§ë...`,6000);
  sendBrowserNotif('üèÅ BLG Í≤ΩÍ∏∞ Ï¢ÖÎ£å',`vs ${opp} ¬∑ BÁ´ô VOD Í≥ß ÏóÖÎç∞Ïù¥Ìä∏`);
}

function notifyNewSchedule(event,date,opp){
  if(!notifEnabled)return;
  playNotifSound('info');
  showToast('üìÖ','ÏÉà ÏùºÏ†ï Î∞úÍ≤¨!',`${event} ¬∑ ${date} ¬∑ vs ${opp||'TBD'}`,8000);
  sendBrowserNotif('üìÖ BLG ÏÉà ÏùºÏ†ï',`${event} ¬∑ ${date}`);
}

function notifyNewVod(count){
  if(!notifEnabled)return;
  playNotifSound('info');
  showToast('üÖ±',`BÁ´ô VOD ${count}Í∞ú Ï∂îÍ∞Ä`,`Í≤ΩÍ∏∞ Ïπ¥ÎìúÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî`,6000);
}

function toggleNotif(){
  if(!notifEnabled){
    // Enable: request permission
    notifEnabled=true;
    localStorage.setItem('blg_notif','on');
    if('Notification' in window && Notification.permission==='default'){
      Notification.requestPermission();
    }
    // Play test sound
    playNotifSound('info');
    showToast('üîî','ÏïåÎ¶º ÏºúÏßê','ÎùºÏù¥Î∏å ÏãúÏûë ¬∑ ÏÉà ÏùºÏ†ï ¬∑ VOD ÏóÖÎç∞Ïù¥Ìä∏ ÏïåÎ¶º',4000);
  }else{
    notifEnabled=false;
    localStorage.setItem('blg_notif','off');
    showToast('üîï','ÏïåÎ¶º Í∫ºÏßê','',3000);
  }
  updateNotifBtn();
}

function updateNotifBtn(){
  const btn=document.getElementById('notifBtn');
  const ico=document.getElementById('notifIcon');
  if(notifEnabled){btn.classList.add('on');ico.textContent='üîî'}
  else{btn.classList.remove('on');ico.textContent='üîï'}
}
updateNotifBtn();

// ===== 1) LIVE MATCH DETECTION (Riot Esports API) =====
let currentLive=null;
let liveCheckCount=0;
const BILI_MID='2071691173';
const YT_LIVE_CN='https://www.youtube.com/@VALORANTEsportsCN/live';
const BILI_LIVE='https://live.bilibili.com/22637261';

async function checkLiveMatch(){
  liveCheckCount++;
  let found=null;
  // 0) Try Riot Esports API (official, direct, no CORS!)
  try{
    const events=await getRiotSchedule();
    const live=events.find(ev=>ev.state==='inProgress'&&ev.match?.teams?.some(t=>isBLGTeam(t)));
    if(live){
      const teams=live.match.teams;
      const isBLG0=isBLGTeam(teams[0]);
      found={team1:isBLG0?teams[0].name:teams[1].name, team2:isBLG0?teams[1].name:teams[0].name,
        score1:String(isBLG0?teams[0].result?.gameWins||0:teams[1].result?.gameWins||0),
        score2:String(isBLG0?teams[1].result?.gameWins||0:teams[0].result?.gameWins||0),
        round_info:live.blockName||'', tournament_name:live.league?.name||'VCT CN',
        match_page:'', _streams:{}};
    }
  }catch(e){}
  // 1) Try vlresports (no API key needed)
  try{
    const d=await proxyFetchJSON('https://vlr.orlandomm.net/api/v1/matches');
    if(d&&Array.isArray(d.data)){
      d.data.forEach(m=>{
        if(!m.teams||m.teams.length<2)return;
        const t1=(m.teams[0].name||'').toLowerCase(),t2=(m.teams[1].name||'').toLowerCase();
        if(t1.includes('bilibili')||t1.includes('blg')||t2.includes('bilibili')||t2.includes('blg')){
          const st=(m.status||'').toLowerCase();
          if(st!=='live'&&st!=='ongoing')return;
          const isBLG1=t1.includes('bilibili')||t1.includes('blg');
          found={team1:isBLG1?'Bilibili Gaming':(m.teams[0].name||'TBD'),team2:isBLG1?(m.teams[1].name||'TBD'):'Bilibili Gaming',
            score1:String(isBLG1?m.teams[0].score:m.teams[1].score)||'0',score2:String(isBLG1?m.teams[1].score:m.teams[0].score)||'0',
            round_info:'',tournament_name:m.event?.name||'VCT',match_page:m.id?`/${m.id}/`:'',_streams:{}};
        }
      });
    }
  }catch(e){}
  const prev=currentLive;currentLive=found||null;renderLiveBanner();
  if(!prev&&currentLive)notifyLiveStart(currentLive.team2||'TBD',currentLive.tournament_name||'VCT');
  if(prev&&!currentLive){notifyLiveEnd(prev.team2||'');setTimeout(()=>checkNewBiliVods(),60000);setTimeout(()=>checkNewBiliVods(),300000)}
}

function renderLiveBanner(){
  const el=document.getElementById('liveBanner');
  if(!currentLive){el.style.display='none';el.innerHTML='';return}
  const m=currentLive;
  const isBLG1=(m.team1||'').includes('Bilibili')||(m.team1||'').includes('BLG');
  const blgScore=isBLG1?m.score1:m.score2;
  const oppScore=isBLG1?m.score2:m.score1;
  const oppName=isBLG1?m.team2:m.team1;
  const oppTag=guessTag(oppName);
  const event=m.tournament_name||m.match_event||'VCT';
  const stage=m.round_info||m.match_series||'';
  const streams=m._streams||{};
  const ytUrl=streams.youtube||YT_LIVE_CN;
  const biliUrl=streams.bilibili||BILI_LIVE;
  const matchUrl=m.match_page?'https://www.vlr.gg'+m.match_page:'https://www.vlr.gg/team/12010/bilibili-gaming';

  // Extract YouTube channel/video for embed
  let ytEmbedUrl='';
  if(ytUrl.includes('/live')){
    // Channel live URL ‚Üí embed with channel
    const chMatch=ytUrl.match(/@([^/]+)/);
    ytEmbedUrl=ytUrl.replace('/live','').replace('www.youtube.com','www.youtube.com/embed/live_stream?channel=');
    // Fallback: use direct embed URL for VCT CN live
    ytEmbedUrl='https://www.youtube.com/embed/live_stream?channel=UCQ4huNOwMm-5kOBSHBBHahg&autoplay=1';
  } else if(ytUrl.includes('watch?v=')){
    const vid=ytUrl.match(/[?&]v=([^&]+)/);
    if(vid) ytEmbedUrl=`https://www.youtube.com/embed/${vid[1]}?autoplay=1`;
  } else if(ytUrl.includes('youtu.be/')){
    const vid=ytUrl.match(/youtu\.be\/([^?]+)/);
    if(vid) ytEmbedUrl=`https://www.youtube.com/embed/${vid[1]}?autoplay=1`;
  }
  if(!ytEmbedUrl) ytEmbedUrl='https://www.youtube.com/embed/live_stream?channel=UCQ4huNOwMm-5kOBSHBHahg&autoplay=1';

  el.style.display='block';
  el.innerHTML=`<div class="live-match-banner">
    <div class="live-top"><div class="live-dot-big"></div><span class="live-label">LIVE NOW</span><span class="live-event">${event} ¬∑ ${stage}</span></div>
    <div class="live-teams">
      <div class="live-team">${L('BLG','big')}<div><div class="live-team-name">BLG</div><div class="live-team-full">Bilibili Gaming</div></div></div>
      <div><div class="live-score-live">${blgScore} : ${oppScore}</div><div class="live-vs">${stage||'LIVE'}</div></div>
      <div class="live-team right"><div><div class="live-team-name">${oppTag}</div><div class="live-team-full">${oppName}</div></div>${L(oppTag,'big')}</div>
    </div>
    <div class="live-stream-wrap" id="liveStreamWrap" style="display:none">
      <iframe id="liveStreamFrame" src="" allow="autoplay; encrypted-media; fullscreen" style="width:100%;aspect-ratio:16/9;border:0;border-radius:10px;background:#000"></iframe>
    </div>
    <div class="live-links">
      <button onclick="toggleLiveStream('${ytEmbedUrl}')" class="live-link yt" style="border:none;cursor:pointer;font-family:inherit">üì∫ ÎùºÏù¥Î∏å ÏãúÏ≤≠</button>
      <a href="${biliUrl}" target="_blank" class="live-link bili">‚ñ∂ BÁ´ô ÎùºÏù¥Î∏å</a>
      <a href="${matchUrl}" target="_blank" class="live-link vlr">üìä VLR.gg</a>
    </div>
  </div>`;
}

function toggleLiveStream(embedUrl){
  const wrap=document.getElementById('liveStreamWrap');
  const frame=document.getElementById('liveStreamFrame');
  if(wrap.style.display==='none'){
    wrap.style.display='block';
    frame.src=embedUrl;
  } else {
    wrap.style.display='none';
    frame.src='';
  }
}

function guessTag(name){
  if(!name)return'?';
  const map={'EDward Gaming':'EDG','FunPlus Phoenix':'FPX','Trace Esports':'TE','Dragon Ranger Gaming':'DRG',
    'Xi Lai Gaming':'XLG','Wolves Esports':'WOL','All Gamers':'AG','JDG Esports':'JDG','Titan Esports Club':'TEC',
    'TYLOO':'TYL','Nova Esports':'NOVA','Paper Rex':'PRX','DRX':'DRX','Gen.G':'GEN','T1':'T1',
    'Team Liquid':'TL','Fnatic':'FNC','Sentinels':'SEN','NRG Esports':'NRG','G2 Esports':'G2',
    'Karmine Corp':'KC','LOUD':'LOUD','LEVIAT√ÅN':'LEV','Natus Vincere':'NAVI','Team Vitality':'VIT',
    'Cloud9':'C9','100 Thieves':'100T','Evil Geniuses':'EG','FURIA':'FURIA','MIBR':'MIBR',
    'Rex Regum Qeon':'RRQ','DetonatioN FocuseMe':'DFM','KR√ú Esports':'KR√ú',
    'LGD Gaming':'LGD','Royal Never Give Up':'RNG','Weibo Gaming':'WBG','Attacking Soul Esports':'ASE',
    'Nongshim Wolves Gaming':'NWG','Ninjas in Pyjamas':'NIP','Mysterious Esports':'ME','Bilibili Gaming':'BLG'};
  return map[name]||name.split(' ').map(w=>w[0]).join('').toUpperCase().substring(0,3);
}

// ===== 2) AUTO BILIBILI VOD FETCH (Bilibili API) =====
let lastBiliCheck=0;
const newVodBvids=new Set();

async function checkNewBiliVods(){
  const now=Date.now();if(now-lastBiliCheck<60000)return;lastBiliCheck=now;
  let videos=[];
  // 1) Try Bilibili API via proxy
  try{
    const d=await proxyFetchJSON('https://api.bilibili.com/x/space/arc/search?mid=2071691173&ps=10&tid=0&pn=1&keyword=BLG&order=pubdate');
    if(d&&d.data&&d.data.list&&d.data.list.vlist){
      videos=d.data.list.vlist.map(v=>({bvid:v.bvid,title:v.title,date:new Date(v.created*1000).toISOString().substring(0,10)})).filter(v=>v.title.includes('BLG')||v.title.includes('ÂìîÂì©ÂìîÂì©'));
    }
  }catch(e){}
  if(!videos.length)return;
  let added=0;
  videos.forEach(v=>{
    const bv=v.bvid;if(!bv||bv.length<10)return;
    const title=v.title||'';if(!title.includes('BLG')&&!title.includes('ÂìîÂì©ÂìîÂì©'))return;
    if(Object.values(biliVodMap).includes(bv))return;
    const dateM=title.match(/(\d{1,2})Êúà(\d{1,2})Êó•/);
    if(dateM){
      const pubYear=v.date?v.date.substring(0,4):new Date().getFullYear();
      const mm=dateM[1].padStart(2,'0'),dd=dateM[2].padStart(2,'0'),dateStr=`${pubYear}-${mm}-${dd}`;
      const vsMatch=title.match(/VS\s*(\S+)/i);const oppRaw=vsMatch?vsMatch[1].replace(/[„Äê„Äë\s]/g,''):'';
      let oppTag='';for(const[tag,cn]of Object.entries(cnTeamNames)){if(oppRaw.includes(cn)||cn.includes(oppRaw)){oppTag=tag;break}}
      if(!oppTag)oppTag=oppRaw.substring(0,3).toUpperCase();
      if(oppTag&&dateStr){const k1=`BLG vs ${oppTag} ${dateStr}`,k2=`${oppTag} vs BLG ${dateStr}`;biliVodMap[k1]=bv;biliVodMap[k2]=bv;biliVodMap[bv]={tag:oppTag,date:dateStr};newVodBvids.add(bv);added++}
    }
  });
  if(added>0){renderMatches();showVodNotification(added);notifyNewVod(added)}
}

function showVodNotification(count){
  const banner=document.getElementById('liveBanner');
  if(currentLive)return; // Don't overlay on live banner
  banner.style.display='block';
  banner.innerHTML=`<div style="background:rgba(0,161,214,.1);border:1px solid rgba(0,161,214,.25);border-radius:14px;padding:12px 20px;display:flex;align-items:center;gap:10px;max-width:700px;margin:0 auto">
    <span style="font-size:20px">üÖ±</span>
    <div><div style="font-size:13px;font-weight:700;color:#00a1d6">ÏÉàÎ°úÏö¥ BÁ´ô VOD ${count}Í∞ú Î∞úÍ≤¨!</div>
    <div style="font-size:11px;color:var(--dim)">Í≤ΩÍ∏∞ Ïπ¥ÎìúÏùò üÖ± BÁ´ô Î≤ÑÌäºÏù¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§</div></div>
    <button onclick="this.parentElement.parentElement.style.display='none'" style="margin-left:auto;background:none;border:none;color:var(--dim);cursor:pointer;font-size:16px">‚úï</button>
  </div>`;
  setTimeout(()=>{if(!currentLive){banner.style.display='none';banner.innerHTML=''}},10000);
}

// ===== 3) AUTO TEAM LOGO =====
const logoCache={};

function fetchTeamLogo(tag){
  // Riot Esports API handles logo fetching (fetchRiotTeamLogos)
  // This is fallback for completely unknown teams
  if(logoCache[tag])return;
  logoCache[tag]=_tsvg(tag,_LOGO_COLORS[tag]||'#333');
  LOGOS[tag]=logoCache[tag];
}

// ===== LOCAL STATS: MAP WIN RATES + H2H =====
function calcMapStats(){
  const maps={};
  Object.values(allData).forEach(ya=>ya.forEach(t=>t.matches.forEach(m=>{
    if(!m.maps||!m.maps.length)return;
    m.maps.forEach(p=>{
      if(!p.n)return;
      if(!maps[p.n])maps[p.n]={w:0,l:0,rw:0,rl:0};
      const s=maps[p.n];
      if(p.r==='win'){s.w++;s.rw+=p.b;s.rl+=p.o}else{s.l++;s.rw+=p.b;s.rl+=p.o}
    });
  })));
  return Object.entries(maps).map(([n,s])=>({name:n,w:s.w,l:s.l,total:s.w+s.l,wr:s.w+s.l?Math.round(s.w/(s.w+s.l)*100):0,rw:s.rw,rl:s.rl})).sort((a,b)=>b.total-a.total);
}

function calcH2H(){
  const h2h={};
  Object.values(allData).forEach(ya=>ya.forEach(t=>t.matches.forEach(m=>{
    const tag=m.tag||m.opp;if(!tag)return;
    if(!h2h[tag])h2h[tag]={opp:m.opp,w:0,l:0,mw:0,ml:0};
    const s=h2h[tag];
    if(m.r==='win')s.w++;else s.l++;
    s.mw+=(m.bs||0);s.ml+=(m.os||0);
  })));
  return Object.entries(h2h).map(([tag,s])=>({tag,opp:s.opp,w:s.w,l:s.l,total:s.w+s.l,mw:s.mw,ml:s.ml})).sort((a,b)=>b.total-a.total);
}

function calcYearMapStats(year){
  const maps={};
  (allData[year]||[]).forEach(t=>t.matches.forEach(m=>{
    if(!m.maps||!m.maps.length)return;
    m.maps.forEach(p=>{
      if(!p.n)return;
      if(!maps[p.n])maps[p.n]={w:0,l:0};
      if(p.r==='win')maps[p.n].w++;else maps[p.n].l++;
    });
  }));
  return Object.entries(maps).map(([n,s])=>({name:n,w:s.w,l:s.l,total:s.w+s.l,wr:s.w+s.l?Math.round(s.w/(s.w+s.l)*100):0})).sort((a,b)=>b.total-a.total);
}

function renderStatsView(){
  const el=document.getElementById('statsView');
  const allStats=cs('all');
  const mapStats=calcMapStats();
  const h2hStats=calcH2H();
  const yrs=Object.keys(allData).sort((a,b)=>b-a);
  let h='';

  // Overall summary
  h+=`<div class="stats-section"><div class="stats-section-title">üìà Ï†ÑÏ≤¥ ÌÜµÏÇ∞ ÏÑ±Ï†Å</div>
  <div class="stat-grid">
    <div class="stat-card"><div class="sv bc">${allStats.total}</div><div class="sl">Ï¥ù Í≤ΩÍ∏∞</div></div>
    <div class="stat-card"><div class="sv wc">${allStats.w}</div><div class="sl">ÏäπÎ¶¨</div></div>
    <div class="stat-card"><div class="sv lc">${allStats.l}</div><div class="sl">Ìå®Î∞∞</div></div>
    <div class="stat-card"><div class="sv" style="color:${allStats.wr>=50?'var(--win)':'var(--loss)'}">${allStats.wr}%</div><div class="sl">ÏäπÎ•†</div></div>
    <div class="stat-card"><div class="sv" style="color:var(--txt)">${allStats.mw}<span style="color:var(--dimmer)">:</span>${allStats.ml}</div><div class="sl">Îßµ Ïä§ÏΩîÏñ¥</div></div>
  </div></div>`;

  // Year-by-year breakdown
  h+=`<div class="stats-section"><div class="stats-section-title">üìÖ Ïó∞ÎèÑÎ≥Ñ ÏÑ±Ï†Å</div>
  <div class="stat-grid">`;
  yrs.forEach(y=>{const s=cys(y);const wr=s.total?Math.round(s.w/s.total*100):0;
    h+=`<div class="stat-card"><div class="sv" style="color:var(--cyan)">${y}</div><div class="sl" style="font-size:12px;color:var(--txt);margin-top:4px"><span style="color:var(--win)">${s.w}W</span> / <span style="color:var(--loss)">${s.l}L</span> ¬∑ ${wr}%</div></div>`;
  });
  h+=`</div></div>`;

  // Map stats
  h+=`<div class="stats-section"><div class="stats-section-title">üó∫Ô∏è ÎßµÎ≥Ñ ÏäπÎ•† (Ï†ÑÏ≤¥)</div>`;
  if(mapStats.length===0){
    h+=`<div style="color:var(--dim);font-size:12px;padding:10px">Îßµ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÎäî Í≤ΩÍ∏∞Îßå ÏßëÍ≥ÑÎê©ÎãàÎã§</div>`;
  }else{
    mapStats.forEach(m=>{
      const c=m.wr>=60?'var(--win)':m.wr>=45?'var(--cyan)':'var(--loss)';
      h+=`<div class="map-bar-wrap"><div class="map-bar-label"><span class="mn">${m.name}</span><span class="mr">${m.w}W ${m.l}L ¬∑ <b style="color:${c}">${m.wr}%</b> ¬∑ ${m.total}Îßµ</span></div><div class="map-bar"><div class="map-bar-fill" style="width:${m.wr}%;background:${c}"></div></div></div>`;
    });
  }
  h+=`</div>`;

  // Year-specific map stats
  yrs.forEach(y=>{
    const ym=calcYearMapStats(y);
    if(!ym.length)return;
    h+=`<div class="stats-section"><div class="stats-section-title">üó∫Ô∏è ${y} ÎßµÎ≥Ñ ÏäπÎ•†</div>`;
    ym.forEach(m=>{
      const c=m.wr>=60?'var(--win)':m.wr>=45?'var(--cyan)':'var(--loss)';
      h+=`<div class="map-bar-wrap"><div class="map-bar-label"><span class="mn">${m.name}</span><span class="mr">${m.w}W ${m.l}L ¬∑ <b style="color:${c}">${m.wr}%</b></span></div><div class="map-bar"><div class="map-bar-fill" style="width:${m.wr}%;background:${c}"></div></div></div>`;
    });
    h+=`</div>`;
  });

  // H2H
  h+=`<div class="stats-section"><div class="stats-section-title">ü§ù ÏÉÅÎåÄ Ï†ÑÏ†Å (Head-to-Head)</div>`;
  h2hStats.forEach(s=>{
    const wr=s.total?Math.round(s.w/s.total*100):0;
    h+=`<div class="h2h-row">${L(s.tag,'sm')}<div class="h2h-team"><span class="tm">${s.tag}</span></div><div class="h2h-record"><span style="color:var(--win)">${s.w}</span><span style="color:var(--dimmer)">-</span><span style="color:var(--loss)">${s.l}</span></div><div class="h2h-bar"><div class="hw" style="width:${wr}%"></div><div class="hl" style="width:${100-wr}%"></div></div><span style="font-size:11px;color:var(--dim);min-width:35px;text-align:right">${wr}%</span></div>`;
  });
  h+=`</div>`;

  el.innerHTML=h;
}

// ===== ROSTER (Liquipedia API, 1x at load) =====
let rosterData=null;
let rosterYear=String(new Date().getFullYear());
const ROSTER_CACHE={
  "2026":{event:"VCT 2026",players:[
    {name:"whz",real:"Wang Haozhe",role:"Duelist",flag:"üá®üá≥"},
    {name:"Knight",real:"Liu Yuxiang",role:"Initiator",flag:"üá®üá≥"},
    {name:"nephh",real:"Marcus Tan Kai Wen",role:"Duelist",flag:"üá∏üá¨"},
    {name:"rushia",real:"Wang Xiaojie",role:"Sentinel",flag:"üá®üá≥"},
    {name:"bud",real:"Yang Renyu",role:"Flex",flag:"üá®üá≥"},
  ],coach:{name:"Muggle",real:"Tang Shijun",flag:"üá®üá≥"}},
  "2025":{event:"VCT 2025",players:[
    {name:"nephh",real:"Marcus Tan Kai Wen",role:"Duelist",flag:"üá∏üá¨"},
    {name:"whzy",real:"Wang Haozhe",role:"Duelist",flag:"üá®üá≥"},
    {name:"Knight",real:"Liu Yuxiang",role:"Initiator",flag:"üá®üá≥"},
    {name:"Levius",real:"Lu Yinzhong",role:"Controller",flag:"üá®üá≥"},
    {name:"rushia",real:"Wang Xiaojie",role:"Sentinel",flag:"üá®üá≥"},
    {name:"Biank",real:"Zhong Jianfei",role:"Sub",flag:"üá®üá≥",sub:true},
  ],coach:{name:"bail",real:"Lee Sung-jae",flag:"üá∞üá∑"}},
  "2024":{event:"VCT 2024",players:[
    {name:"whzy",real:"Wang Haozhe",role:"Duelist",flag:"üá®üá≥"},
    {name:"Knight",real:"Liu Yuxiang",role:"Initiator",flag:"üá®üá≥"},
    {name:"Levius",real:"Lu Yinzhong",role:"Controller",flag:"üá®üá≥"},
    {name:"rushia",real:"Wang Xiaojie",role:"Sentinel",flag:"üá®üá≥"},
    {name:"nephh",real:"Marcus Tan Kai Wen",role:"Flex",flag:"üá∏üá¨"},
  ],coach:{name:"bail",real:"Lee Sung-jae",flag:"üá∞üá∑"}},
  "2023":{event:"VCT 2023",players:[
    {name:"whzy",real:"Wang Haozhe",role:"Duelist",flag:"üá®üá≥"},
    {name:"Knight",real:"Liu Yuxiang",role:"Initiator",flag:"üá®üá≥"},
    {name:"rin",real:"Li Lewei",role:"Sentinel",flag:"üá®üá≥"},
    {name:"Biank",real:"Zhong Jianfei",role:"Controller",flag:"üá®üá≥"},
    {name:"yosemite",real:"Wang Lei",role:"Flex",flag:"üá®üá≥"},
  ],coach:{name:"JeXeN",real:"Wang Linxiao",flag:"üá®üá≥"}},
};

async function fetchRoster(){
  const CUR_YEAR=String(new Date().getFullYear());
  renderRosterView();
  // 1) Try Liquipedia API first (free, no key needed)
  try{
    const liqRoster=await liqFetchRoster();
    if(liqRoster&&liqRoster.players.length>0){
      const existing=ROSTER_CACHE[CUR_YEAR];
      const updatedPlayers=liqRoster.players.map(lp=>{
        // Match with existing hardcoded data for role info
        const match=existing?.players?.find(ep=>ep.name.toLowerCase()===lp.name.toLowerCase()||ep.name.toLowerCase()===lp.name.replace(/z$/,'zy').toLowerCase());
        return{
          name:lp.name,
          real:lp.real||match?.real||'',
          role:match?.role||'',
          flag:lp.flag||match?.flag||'üá®üá≥',
          sub:lp.sub||false,
          captain:lp.captain||false
        };
      });
      // Find head coach from staff
      const hc=liqRoster.staff.find(s=>s.staffRole==='Head Coach')||liqRoster.staff[0];
      const existCoach=existing?.coach;
      const updatedCoach=hc?{
        name:hc.name,
        real:hc.real||existCoach?.real||'',
        flag:hc.flag||existCoach?.flag||'üá®üá≥'
      }:existCoach;
      if(updatedPlayers.length>0){
        ROSTER_CACHE[CUR_YEAR]={...ROSTER_CACHE[CUR_YEAR],event:ROSTER_CACHE[CUR_YEAR]?.event||`VCT ${CUR_YEAR}`,
          players:updatedPlayers,coach:updatedCoach,_liq:true};
        console.log('‚úÖ Liquipedia roster loaded:',updatedPlayers.map(p=>p.name).join(', '));
        renderRosterView();
      }
    }
  }catch(e){console.log('Liquipedia roster fetch failed:',e)}
}

// ===== LIQUIPEDIA MEDIAWIKI API (Î¨¥Î£å, ÌÇ§ Î∂àÌïÑÏöî) =====
const LIQ_API='https://liquipedia.net/valorant/api.php';
const LIQ_PX=[
  OWN_PROXY,
  u=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`,
];
let liqProxy=null;

let liqOppStats=null;

async function liqFetch(params){
  params.format='json';
  const url=`${LIQ_API}?${new URLSearchParams(params)}`;
  const tries=liqProxy?[liqProxy,...LIQ_PX.filter(p=>p!==liqProxy)]:LIQ_PX;
  for(const px of tries){
    try{
      const r=await fetch(px(url),{headers:{'Accept':'application/json'},signal:AbortSignal.timeout(15000)});
      if(r.ok){
        const txt=await r.text();
        try{const d=JSON.parse(txt);if(d.parse){liqProxy=px;return d;}}catch(e){console.log('liqFetch JSON parse fail:',txt.substring(0,100))}
      }else{console.log('liqFetch HTTP',r.status,'from proxy',px.toString().substring(0,40))}
    }catch(e){console.log('liqFetch proxy fail:',e.message);continue}
  }
  return null;
}

function liqIsNoise(n){
  if(!n||n.length<2||n.length>30)return true;
  if(/^\[\d+\]$/.test(n)||/^\d+$/.test(n)||/^[SABC]-Tier$/i.test(n))return true;
  if('edit,View,talk,history,hide,show,Navigation,Bilibili Gaming,Online,Offline,TBD,TBA,N/A,vs,Roster'.split(',').includes(n))return true;
  if(/^(January|February|March|April|May|June|July|August|September|October|November|December)/i.test(n))return true;
  if(/^[\d\s\-:,\.\(\)]+$/.test(n))return true;
  return false;
}

async function liqFetchRoster(){
  const sd=await liqFetch({action:'parse',page:'Bilibili_Gaming',prop:'sections'});
  if(!sd?.parse)return null;
  const ss=sd.parse.sections||[];
  let pi=null,oi=null,z='';
  for(const s of ss){if(s.line==='Player Roster')z='p';if(s.line==='Organization')z='o';if(s.line==='Active'&&z==='p'&&!pi)pi=s.index;if(s.line==='Active'&&z==='o'&&!oi)oi=s.index;}

  await new Promise(r=>setTimeout(r,2500));
  const pd=await liqFetch({action:'parse',page:'Bilibili_Gaming',prop:'text',section:pi||'4'});
  const ph=pd?.parse?.text?.['*']||'';if(!ph)return null;
  const r=liqParseRoster(ph);
  let sf=[];
  if(oi){await new Promise(r2=>setTimeout(r2,2500));
    const od=await liqFetch({action:'parse',page:'Bilibili_Gaming',prop:'text',section:oi});
    if(od?.parse?.text?.['*']){const or=liqParseRoster(od.parse.text['*']);sf=[...or.players,...or.staff];}
  }
  return{players:r.players,staff:[...r.staff,...sf]};
}

function liqParseRoster(html){
  const doc=new DOMParser().parseFromString(html,'text/html'),p=[],s=[],seen=new Set();
  const FLAG_MAP={'China':'üá®üá≥','South Korea':'üá∞üá∑','Singapore':'üá∏üá¨','Japan':'üáØüáµ','United States':'üá∫üá∏','Canada':'üá®üá¶','Indonesia':'üáÆüá©','Thailand':'üáπüá≠','Vietnam':'üáªüá≥','Philippines':'üáµüá≠','Malaysia':'üá≤üáæ','Taiwan':'üáπüáº','Hong Kong':'üá≠üá∞','Macau':'üá≤üá¥','Russia':'üá∑üá∫','Brazil':'üáßüá∑','Australia':'üá¶üá∫','Sweden':'üá∏üá™','Denmark':'üá©üá∞','Finland':'üá´üáÆ','Turkey':'üáπüá∑','France':'üá´üá∑','Germany':'üá©üá™','United Kingdom':'üá¨üáß','Mongolia':'üá≤üá≥','Myanmar':'üá≤üá≤','India':'üáÆüá≥','Pakistan':'üáµüá∞','Chile':'üá®üá±','Argentina':'üá¶üá∑','Mexico':'üá≤üáΩ','Peru':'üáµüá™','Colombia':'üá®üá¥','Latvia':'üá±üáª','Ukraine':'üá∫üá¶','Poland':'üáµüá±','Spain':'üá™üá∏','Portugal':'üáµüáπ','Netherlands':'üá≥üá±','Belgium':'üáßüá™','Czech Republic':'üá®üáø','Israel':'üáÆüá±','Morocco':'üá≤üá¶','Egypt':'üá™üá¨','Saudi Arabia':'üá∏üá¶','Jordan':'üáØüá¥'};
  doc.querySelectorAll('table tr').forEach(row=>{
    const cells=Array.from(row.querySelectorAll('td'));if(cells.length<2)return;
    // Find player/staff link
    let name='',href='',country='',real='',role='';
    for(const cell of cells){
      cell.querySelectorAll('a[href*="/valorant/"]').forEach(a=>{
        const h=a.getAttribute('href')||'',n=a.textContent.trim();
        if(!n||liqIsNoise(n)||h.includes('Bilibili_Gaming')||h.includes('Category:'))return;
        if(!name){name=n;href=h;}
      });
    }
    if(!name||seen.has(name))return;seen.add(name);
    // Extract flag from img alt/title
    row.querySelectorAll('img').forEach(img=>{
      const src=(img.getAttribute('src')||'').toLowerCase();
      const alt=img.getAttribute('alt')||'';
      if(src.includes('_hd.png')||src.includes('flag')){
        const parent=img.closest('a');
        const title=parent?.getAttribute('title')||alt||'';
        if(title&&FLAG_MAP[title])country=title;
      }
    });
    // Extract real name from cells containing parentheses pattern or plain text after ID
    for(const cell of cells){
      const txt=cell.textContent.trim();
      // "(Wang Haozhe)  Wang Haozhe" pattern or just "Wang Haozhe"
      const pm=txt.match(/\(([A-Za-z\s\-]+)\)/);
      if(pm&&pm[1].length>3&&!pm[1].match(/Captain|Substitute|Coach|Manager|Streamer|Analyst|Leader/i)){
        real=pm[1].trim();break;
      }
    }
    // Extract role from row text
    const rt=row.textContent.toLowerCase();
    const isStaff=rt.includes('coach')||rt.includes('manager')||rt.includes('analyst')||rt.includes('team leader')||rt.includes('streamer');
    let staffRole='';
    if(rt.includes('head coach'))staffRole='Head Coach';
    else if(rt.includes('coach'))staffRole='Coach';
    else if(rt.includes('manager'))staffRole='Manager';
    else if(rt.includes('team leader'))staffRole='Team Leader';
    else if(rt.includes('streamer'))staffRole='Streamer';
    else if(rt.includes('analyst'))staffRole='Analyst';
    // Check for Captain/Sub markers
    const isCaptain=rt.includes('captain');
    const isSub=rt.includes('substitute')||rt.includes('(sub)');
    const flag=FLAG_MAP[country]||'üá®üá≥';
    const entry={name,real,country,flag};
    if(isStaff){entry.staffRole=staffRole;s.push(entry);}
    else{entry.captain=isCaptain;entry.sub=isSub;p.push(entry);}
  });
  return{players:p,staff:s};
}

// ===== LIQUIPEDIA MATCH HISTORY (Opponent Stats) =====
async function liqFetchOppStats(){
  const d=await liqFetch({action:'parse',page:'Bilibili_Gaming/Matches',prop:'text'});
  if(!d?.parse?.text?.['*'])return null;
  const html=d.parse.text['*'];
  return liqParseMatches(html);
}

function liqParseMatches(html){
  const doc=new DOMParser().parseFromString(html,'text/html'),ms=[];
  doc.querySelectorAll('tr').forEach(row=>{
    const cells=Array.from(row.querySelectorAll('td'));if(cells.length<3)return;
    let sc='',win=false,st='',si=-1;
    for(let i=0;i<cells.length;i++){const t=cells[i].textContent.replace(/\s+/g,' ').trim();let m=t.match(/^(\d)\s*:\s*(\d)$/);if(m){sc=m[1]+':'+m[2];win=+m[1]>+m[2];si=i;st='bo';break;}m=t.match(/^(\d{1,2})\s*-\s*(\d{1,2})$/);if(m){sc=m[1]+'-'+m[2];win=+m[1]>+m[2];si=i;st='round';break;}}
    if(si===-1){for(let i=0;i<cells.length;i++){const m=cells[i].textContent.replace(/\s+/g,' ').trim().match(/(\d)\s*:\s*(\d)/);if(m){sc=m[1]+':'+m[2];win=+m[1]>+m[2];si=i;st='bo';break;}}}
    if(!sc)return;
    const isT=a=>{const n=a.textContent.trim();if(!n||liqIsNoise(n)||n.length>20||n.match(/VCT|Champions|Stage|Kickoff|Masters|Invitational|EVO|Series|CEF|EWC|Radiant|Super|Group|Playoff|Week|Day|Tournament|ACL|Shanghai/i)||n.match(/Bilibili|BLG/i))return false;return n.length>=2&&n.length<=15;};
    let op='';
    for(let i=si+1;i<cells.length&&!op;i++)for(const a of cells[i].querySelectorAll('a'))if(isT(a)){op=a.textContent.trim();break;}
    if(!op)for(let i=si-1;i>=0&&!op;i--)for(const a of cells[i].querySelectorAll('a'))if(isT(a)){op=a.textContent.trim();break;}
    if(op&&st==='bo')ms.push({opponent:op,isWin:win});
  });
  // Aggregate
  const os={};
  ms.forEach(m=>{if(!os[m.opponent])os[m.opponent]={w:0,l:0};if(m.isWin)os[m.opponent].w++;else os[m.opponent].l++;});
  return{matches:ms,oppStats:os,total:ms.length,wins:ms.filter(m=>m.isWin).length};
}


function renderRosterView(){
  const el=document.getElementById('rosterView');
  const yrs=Object.keys(ROSTER_CACHE).sort((a,b)=>b-a);
  let h=`<div class="roster-year-tabs">`;
  yrs.forEach(y=>{h+=`<button class="roster-year-btn ${y===rosterYear?'active':''}" onclick="rosterYear='${y}';renderRosterView()">${y}</button>`});
  h+=`</div>`;

  const data=ROSTER_CACHE[rosterYear];
  if(!data){h+=`<div style="text-align:center;color:var(--dim);padding:40px">Î°úÏä§ÌÑ∞ Ï†ïÎ≥¥ ÏóÜÏùå</div>`;el.innerHTML=h;return}

  h+=`<div class="roster-card"><div class="roster-header">${L('BLG','lg')}<div><div class="rh-year">${rosterYear}${data._liq?'<span class="liq-badge">üì° Liquipedia</span>':''}</div><div class="rh-event">${data.event||''}</div></div></div>`;
  h+=`<div class="roster-grid">`;
  (data.players||[]).forEach(p=>{
    h+=`<div class="player-card ${p.sub?'sub':''}"><div class="p-flag">${p.flag||'üá®üá≥'}</div><div class="p-role">${p.role||''}${p.sub?' ¬∑ SUB':''}</div><div class="p-name">${p.name}</div><div class="p-real">${p.real||''}</div></div>`;
  });
  if(data.coach){
    h+=`<div class="player-card coach"><div class="p-flag">${data.coach.flag||'üá®üá≥'}</div><div class="p-role">COACH</div><div class="p-name">${data.coach.name}</div><div class="p-real">${data.coach.real||''}</div></div>`;
  }
  h+=`</div>`;

  // Transfer timeline
  h+=renderTransferTimeline(rosterYear);

  h+=`</div>`;
  el.innerHTML=h;
}

// ===== TRANSFER HISTORY =====
let transferData=[];
let transferFilterYear='all';
const TRANSFER_BASELINE=[
// 2026
{date:'2026-01-13',player:'Biank',type:'promote',detail:'ÏÑúÎ∏å ‚Üí ÏûÑÏãú Ïä§ÌÉÄÌÑ∞ (Knight ÏûÖÏõê)',from:'BLG'},
{date:'2026-01-06',player:'Muggle',type:'join',detail:'Ïï†ÎÑêÎ¶¨Ïä§Ìä∏ Ìï©Î•ò',from:''},
// 2025
{date:'2025-10-20',player:'whzy',type:'role',detail:'whzy ‚Üí whz (ÎãâÎÑ§ÏûÑ Î≥ÄÍ≤Ω)',from:'BLG'},
{date:'2025-09-10',player:'Biank',type:'join',detail:'ÏÑúÎ∏å ÏÑ†Ïàò Ìï©Î•ò',from:''},
{date:'2025-01-15',player:'nephh',type:'join',detail:'ÏÑ†Ïàò Ìï©Î•ò (üá∏üá¨)',from:'Paper Rex'},
{date:'2025-01-10',player:'bud',type:'join',detail:'ÏÑ†Ïàò Ìï©Î•ò',from:''},
{date:'2025-01-10',player:'yosemite',type:'leave',detail:'ÌåÄ Ïù¥ÌÉà',from:'BLG'},
{date:'2025-01-10',player:'rin',type:'leave',detail:'ÌåÄ Ïù¥ÌÉà',from:'BLG'},
// 2024
{date:'2024-10-01',player:'JeXeN',type:'leave',detail:'ÏΩîÏπò Í≥ÑÏïΩ Ï¢ÖÎ£å',from:'BLG'},
{date:'2024-10-01',player:'bail',type:'join',detail:'ÏΩîÏπò Ìï©Î•ò (üá∞üá∑)',from:''},
{date:'2024-05-20',player:'yosemite',type:'join',detail:'ÏÑ†Ïàò Ìï©Î•ò',from:''},
{date:'2024-01-15',player:'rushia',type:'join',detail:'ÏÑ†Ïàò Ìï©Î•ò',from:''},
{date:'2024-01-15',player:'rin',type:'join',detail:'ÏÑ†Ïàò Ìï©Î•ò',from:''},
{date:'2024-01-10',player:'Levius',type:'leave',detail:'ÌåÄ Ïù¥ÌÉà',from:'BLG'},
// 2023
{date:'2023-06-01',player:'Knight',type:'join',detail:'ÏÑ†Ïàò Ìï©Î•ò',from:''},
{date:'2023-06-01',player:'whzy',type:'join',detail:'ÏÑ†Ïàò Ìï©Î•ò',from:''},
{date:'2023-06-01',player:'Levius',type:'join',detail:'ÏÑ†Ïàò Ìï©Î•ò',from:''},
{date:'2023-06-01',player:'JeXeN',type:'join',detail:'ÏΩîÏπò Ìï©Î•ò',from:''},
{date:'2023-05-01',player:'BLG VALORANT',type:'join',detail:'ÌåÄ Ï∞ΩÎã®',from:'Bilibili Gaming'},
];

async function fetchTransfers(){
  transferData=[...TRANSFER_BASELINE];
  // Try Liquipedia for latest transfers
  try{
    const sd=await liqFetch({action:'parse',page:'Bilibili_Gaming',prop:'sections'});
    if(!sd?.parse)return;
    const ss=sd.parse.sections||[];
    let tfIdx=null;
    for(const s of ss){
      if(s.line&&(s.line.includes('Roster Changes')||s.line.includes('Player Roster Changes')||s.line==='Transfers')){
        tfIdx=s.index;break;
      }
    }
    if(!tfIdx)return;
    await new Promise(r=>setTimeout(r,2500));
    const td=await liqFetch({action:'parse',page:'Bilibili_Gaming',prop:'text',section:tfIdx});
    if(!td?.parse?.text?.['*'])return;
    const parsed=liqParseTransfers(td.parse.text['*']);
    if(parsed.length>0){
      // Merge: add any Liquipedia entries not in baseline
      const baseKeys=new Set(transferData.map(t=>`${t.date}_${t.player}_${t.type}`));
      let added=0;
      parsed.forEach(p=>{
        const key=`${p.date}_${p.player}_${p.type}`;
        if(!baseKeys.has(key)){transferData.push(p);added++;}
      });
      if(added>0)console.log(`‚úÖ Liquipedia transfers: ${added}Í∞ú Ï∂îÍ∞Ä`);
    }
  }catch(e){console.log('Transfer fetch failed:',e)}
  // Sort by date desc
  transferData.sort((a,b)=>b.date.localeCompare(a.date));
  renderRosterView();
}

function liqParseTransfers(html){
  const doc=new DOMParser().parseFromString(html,'text/html');
  const results=[];
  const rows=doc.querySelectorAll('.divRow, .roster-change-row, table tr');
  rows.forEach(row=>{
    const cells=row.querySelectorAll('.divCell, td');
    if(cells.length<2)return;
    let date='',player='',type='',detail='',from='';
    // Try to extract date
    const allText=row.textContent;
    const dateMatch=allText.match(/(\d{4})-(\d{2})-(\d{2})/);
    if(dateMatch)date=dateMatch[0];
    else{
      const dateMatch2=allText.match(/(\w+ \d{1,2}, \d{4})/);
      if(dateMatch2){
        try{const d=new Date(dateMatch2[1]);if(!isNaN(d))date=d.toISOString().substring(0,10);}catch(e){}
      }
    }
    if(!date)return;
    // Extract player names from links
    const links=row.querySelectorAll('a[href*="/valorant/"]');
    links.forEach(a=>{
      const n=a.textContent.trim(),h=a.getAttribute('href')||'';
      if(n&&!liqIsNoise(n)&&!h.includes('Bilibili_Gaming')&&!h.includes('Category:')&&n.length<=20){
        if(!player)player=n;
      }
    });
    if(!player)return;
    // Determine type from text
    const lt=allText.toLowerCase();
    if(lt.includes('joins')||lt.includes('join')||lt.includes('signs')||lt.includes('sign')||lt.includes('added')||lt.includes('Ìï©Î•ò'))type='join';
    else if(lt.includes('leaves')||lt.includes('left')||lt.includes('released')||lt.includes('departed')||lt.includes('Ïù¥ÌÉà')||lt.includes('benched'))type='leave';
    else if(lt.includes('promoted')||lt.includes('moved to active')||lt.includes('ÏäπÍ≤©'))type='promote';
    else if(lt.includes('role change')||lt.includes('moved to')||lt.includes('Î≥ÄÍ≤Ω'))type='role';
    else type=lt.includes('inactive')||lt.includes('bench')?'leave':'join';
    // Extract detail
    if(lt.includes('coach'))detail=(type==='join'?'ÏΩîÏπò Ìï©Î•ò':'ÏΩîÏπò Ïù¥ÌÉà');
    else if(lt.includes('analyst'))detail=(type==='join'?'Ïï†ÎÑêÎ¶¨Ïä§Ìä∏ Ìï©Î•ò':'Ïï†ÎÑêÎ¶¨Ïä§Ìä∏ Ïù¥ÌÉà');
    else if(lt.includes('manager'))detail=(type==='join'?'Îß§ÎãàÏ†Ä Ìï©Î•ò':'Îß§ÎãàÏ†Ä Ïù¥ÌÉà');
    else if(lt.includes('substitute')||lt.includes('sub'))detail=(type==='join'?'ÏÑúÎ∏å ÏÑ†Ïàò Ìï©Î•ò':'ÏÑúÎ∏å Ìï¥Ï†ú');
    else detail=(type==='join'?'ÏÑ†Ïàò Ìï©Î•ò':type==='leave'?'ÌåÄ Ïù¥ÌÉà':type==='promote'?'Ïä§ÌÉÄÌÑ∞ ÏäπÍ≤©':'Ïó≠Ìï† Î≥ÄÍ≤Ω');
    // Check for "from TEAM" pattern
    const fromMatch=allText.match(/from\s+([A-Za-z0-9\s]+?)(?:\s*\(|\s*$|\s*,)/i);
    if(fromMatch&&fromMatch[1].trim()!=='Bilibili Gaming')from=fromMatch[1].trim();
    results.push({date,player,type,detail,from});
  });
  return results;
}

function renderTransferTimeline(year){
  if(!transferData.length)return'<div class="tf-section"><div class="tf-header"><div class="tf-title">Ïù¥Ï†Å Í∏∞Î°ù</div></div><div class="tf-empty">üì° Ïù¥Ï†Å Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë...</div></div>';
  const filtered=year==='all'||transferFilterYear==='all'?transferData:transferData.filter(t=>t.date.startsWith(year));
  // Get available years
  const tfYears=[...new Set(transferData.map(t=>t.date.substring(0,4)))].sort((a,b)=>b-a);
  const activeFilter=transferFilterYear==='all'?year:transferFilterYear;

  let h=`<div class="tf-section"><div class="tf-header"><div class="tf-title">Ïù¥Ï†Å Í∏∞Î°ù <span class="tf-badge">${transferData.length}Í±¥</span></div>`;
  h+=`<div class="tf-year-filter">`;
  tfYears.forEach(y=>{h+=`<button class="tf-year-btn ${y===activeFilter?'active':''}" onclick="transferFilterYear='${y}';renderRosterView()">${y}</button>`});
  h+=`<button class="tf-year-btn ${activeFilter==='all'?'active':''}" onclick="transferFilterYear='all';renderRosterView()">Ï†ÑÏ≤¥</button>`;
  h+=`</div></div>`;

  const show=activeFilter==='all'?transferData:transferData.filter(t=>t.date.startsWith(activeFilter));
  if(!show.length){h+=`<div class="tf-empty">Ìï¥Îãπ Ïó∞ÎèÑ Ïù¥Ï†Å Í∏∞Î°ù ÏóÜÏùå</div></div>`;return h;}

  h+=`<div class="tf-timeline">`;
  let lastMonth='';
  show.forEach(t=>{
    const m=t.date.substring(0,7);
    if(m!==lastMonth){
      const[yy,mm]=m.split('-');
      h+=`<div style="font-size:11px;color:var(--dimmer);font-family:'JetBrains Mono',monospace;margin:${lastMonth?'14px':'0'} 0 6px 4px">${yy}.${mm}</div>`;
      lastMonth=m;
    }
    const icon=t.type==='join'?'‚ûï':t.type==='leave'?'‚ûñ':t.type==='promote'?'‚¨ÜÔ∏è':'üîÑ';
    const typeLabel=t.type==='join'?'Ìï©Î•ò':t.type==='leave'?'Ïù¥ÌÉà':t.type==='promote'?'ÏäπÍ≤©':'Î≥ÄÍ≤Ω';
    h+=`<div class="tf-item ${t.type}">`;
    h+=`<div class="tf-date">${t.date}</div>`;
    h+=`<div class="tf-content">`;
    h+=`<span class="tf-type ${t.type}">${icon} ${typeLabel}</span>`;
    h+=`<span class="tf-player">${t.player}</span>`;
    h+=`<span class="tf-detail">${t.detail}</span>`;
    if(t.from&&t.type==='join')h+=`<span class="tf-from">‚Üê ${t.from}</span>`;
    h+=`</div></div>`;
  });
  h+=`</div></div>`;
  return h;
}

// ===== STANDINGS (vlresports, every 10min) =====
// ===== STANDINGS: HISTORICAL PLACEMENTS + LIVE 2026 =====
let standingsData=null;
let standingsUpdated='';
const PLACEMENTS={
  "2026":[
    {event:"VCT 2026: China Kickoff",place:"4th",type:"CN",note:"AG¬∑XLG¬∑EDG ÏßÑÏ∂ú, Knight ÏûÖÏõêÏúºÎ°ú Biank Ìà¨ÏûÖ",prize:""},
    {event:"VCT 2026: China Stage 1",place:"ÏßÑÌñâ ÏòàÏ†ï",type:"CN",note:"Group Alpha ¬∑ 3Ïõî 31Ïùº~",prize:"",live:true},
  ],
  "2025":[
    {event:"VCT 2025: China Kickoff",place:"3rd",type:"CN",note:"EDGÏóê 0-3 Ìå®, Masters Bangkok ÏßÑÏ∂ú Ïã§Ìå®",prize:""},
    {event:"China Evolution Series Act 1",place:"3rd",type:"CN",note:"",prize:""},
    {event:"VCT 2025: China Stage 1",place:"2nd",type:"CN",note:"Í≤∞Ïäπ XLGÏóê 1-3 Ìå®, Masters Toronto ÏßÑÏ∂ú",prize:""},
    {event:"VALORANT Masters Toronto",place:"9th-10th",type:"INTL",note:"TL 2-0 Ïäπ, SEN¬∑WolvesÏóê Ìå®",prize:"$25,000"},
    {event:"China Evo Series Act 2 x ACL",place:"9th-12th",type:"CN",note:"",prize:""},
    {event:"HERO Esports ACL",place:"4th",type:"INTL",note:"",prize:"$10,000"},
    {event:"Esports World Cup 2025",place:"9th-12th",type:"INTL",note:"G2 2-1 Ïäπ, PRX¬∑KCÏóê Ìå®",prize:"$25,000"},
    {event:"VCT 2025: China Stage 2",place:"1st üèÜ",type:"CN",note:"Í≤∞Ïäπ DRG 3-1 Ïäπ, whzy MVP",prize:""},
    {event:"China Evo Series Act 3",place:"9th-12th",type:"CN",note:"",prize:""},
    {event:"VALORANT Champions 2025",place:"13th-16th",type:"INTL",note:"MIBR 0-2, RRQ 1-2 Ìå®",prize:"$20,000"},
    {event:"China Esports Festival Super Cup",place:"3rd",type:"INTL",note:"",prize:"$7,067"},
    {event:"Shanghai Esports Masters",place:"3rd-4th",type:"CN",note:"",prize:""},
    {event:"Radiant Intl Invitational",place:"6th",type:"INTL",note:"Bo1 Í∑∏Î£π 0-4",prize:""},
  ],
  "2024":[
    {event:"VCT 2024: China Kickoff",place:"5th",type:"CN",note:"Masters Madrid ÏßÑÏ∂ú Ïã§Ìå®",prize:""},
    {event:"VCT 2024: China Stage 1",place:"7th-8th",type:"CN",note:"Ï†ïÍ∑úÏãúÏ¶å 2W-4L",prize:""},
    {event:"VCT 2024: China Stage 2",place:"4th",type:"CN",note:"Ï†ïÍ∑úÏãúÏ¶å 4W-3L, Champions ÏßÑÏ∂ú",prize:""},
    {event:"VALORANT Champions 2024",place:"13th-16th",type:"INTL",note:"FNC 0-2, KR√ú 0-2 (0Îßµ Ïäπ)",prize:"$20,000"},
    {event:"FGC Invitational 2024",place:"1st üèÜ",type:"CN",note:"Í≤∞Ïäπ Wolves 3-1 Ïäπ, Ï≤´ Ïö∞Ïäπ!",prize:""},
    {event:"Radiant Asia Invitational",place:"7th-8th",type:"INTL",note:"",prize:""},
    {event:"SOOP VALORANT League",place:"7th-8th",type:"INTL",note:"",prize:"$5,000"},
  ],
  "2023":[
    {event:"FGC Invitational Act 1",place:"9th-10th",type:"CN",note:"Ï≤´ ÎåÄÌöå, Ï°∞Î≥Ñ ÌÉàÎùΩ",prize:""},
    {event:"FGC Invitational Act 2",place:"2nd",type:"CN",note:"Í≤∞Ïäπ EDGÏóê 0-3 Ìå®",prize:""},
    {event:"VCT China Champions CQ",place:"2nd",type:"CN",note:"Í≤∞Ïäπ EDGÏóê 1-3 Ìå®, Champions ÏßÑÏ∂ú",prize:""},
    {event:"VALORANT Champions 2023",place:"7th-8th",type:"INTL",note:"NRG 2Ïó∞Ïäπ, DRXÏóê 0-2 Ìå® (Ïó≠ÎåÄ ÏµúÍ≥† Íµ≠Ï†ú ÏÑ±Ï†Å)",prize:"$50,000"},
    {event:"China Evolution Series Act 1",place:"5th-6th",type:"CN",note:"",prize:""},
    {event:"China Evolution Series Act 2",place:"5th-6th",type:"CN",note:"",prize:""},
    {event:"China Evolution Series Act 3",place:"9th-12th",type:"CN",note:"",prize:""},
  ]
};

function placeColor(p){
  if(p.includes('1st'))return'var(--cyan)';
  if(p.includes('2nd'))return'#FFD700';
  if(p.includes('3rd'))return'#CD7F32';
  if(p.includes('4th')||p.includes('5th'))return'var(--win)';
  if(p.includes('ÏßÑÌñâ'))return'var(--cyan)';
  return'var(--dim)';
}
function placeIcon(p){
  if(p.includes('1st'))return'üèÜ';
  if(p.includes('2nd'))return'ü•à';
  if(p.includes('3rd'))return'ü•â';
  if(p.includes('ÏßÑÌñâ'))return'‚è≥';
  return'';
}

async function fetchStandings(){
  const CUR_YEAR=String(new Date().getFullYear());
  if(!PLACEMENTS[CUR_YEAR])PLACEMENTS[CUR_YEAR]=[];
  // Rankings: vlresports doesn't have rankings endpoint, use hardcoded PLACEMENTS
  renderStandingsView();
}

function renderStandingsView(){
  const el=document.getElementById('standingsView');
  const yrs=Object.keys(PLACEMENTS).sort((a,b)=>b-a);
  let h=`<div class="standings-wrap">`;

  // BLG ranking badge
  if(standingsData&&standingsData.blgRank){
    const wr=standingsData.blgRank.world;const cr=standingsData.blgRank.china;
    h+=`<div style="display:flex;gap:8px;justify-content:center;margin-bottom:14px">`;
    if(wr)h+=`<div class="stat-card" style="flex:0 0 auto;padding:10px 20px"><div class="sv" style="color:var(--cyan)">#${wr}</div><div class="sl">ÏÑ∏Í≥Ñ Îû≠ÌÇπ</div></div>`;
    if(cr)h+=`<div class="stat-card" style="flex:0 0 auto;padding:10px 20px"><div class="sv" style="color:var(--cyan)">#${cr}</div><div class="sl">Ï§ëÍµ≠ Îû≠ÌÇπ</div></div>`;
    h+=`</div>`;
  }

  // Year tabs
  h+=`<div class="roster-year-tabs" style="margin-bottom:16px">`;
  yrs.forEach(y=>{h+=`<button class="roster-year-btn ${y===yrs[0]?'active':''}" onclick="filterStandingsYear('${y}',this)">${y}</button>`});
  h+=`<button class="roster-year-btn" onclick="filterStandingsYear('all',this)">Ï†ÑÏ≤¥</button></div>`;

  // Placement cards per year
  yrs.forEach(y=>{
    const placements=PLACEMENTS[y]||[];
    const cnCount=placements.filter(p=>p.type==='CN').length;
    const intlCount=placements.filter(p=>p.type==='INTL').length;
    const trophies=placements.filter(p=>p.place.includes('1st')).length;
    const top3=placements.filter(p=>p.place.match(/1st|2nd|3rd/)).length;

    h+=`<div class="standings-card standings-year-card" data-year="${y}">`;
    h+=`<div class="standings-title"><span>${y}</span><span style="font-size:11px;color:var(--dim);font-weight:400;margin-left:auto">${placements.length}Í∞ú ÎåÄÌöå ¬∑ CN ${cnCount} ¬∑ Íµ≠Ï†ú ${intlCount}${trophies?' ¬∑ üèÜ'+trophies:''}${top3>trophies?' ¬∑ üèÖTop3 '+top3:''}</span></div>`;
    h+=`<table class="standings-table"><thead><tr><th style="width:40%">ÎåÄÌöå</th><th style="width:18%">ÏàúÏúÑ</th><th>Ïú†Ìòï</th><th>ÎπÑÍ≥†</th></tr></thead><tbody>`;

    placements.forEach(p=>{
      const ic=placeIcon(p.place);
      const clr=placeColor(p.place);
      const typeTag=p.type==='INTL'?'<span style="color:#FFD700;font-size:10px;font-weight:700">üåç Íµ≠Ï†ú</span>':'<span style="color:var(--dim);font-size:10px">üá®üá≥ CN</span>';
      h+=`<tr${p.live?' style="background:rgba(0,212,255,.08)"':''}>`;
      h+=`<td style="font-size:12px;font-weight:600">${p.event}</td>`;
      h+=`<td style="color:${clr};font-weight:800;font-family:'Orbitron',sans-serif;font-size:13px">${ic} ${p.place}</td>`;
      h+=`<td>${typeTag}</td>`;
      h+=`<td style="font-size:11px;color:var(--dim)">${p.note}${p.prize?' ¬∑ <b style="color:var(--win)">'+p.prize+'</b>':''}</td>`;
      h+=`</tr>`;
    });
    h+=`</tbody></table></div>`;
  });

  // Overall summary
  const allP=Object.values(PLACEMENTS).flat();
  const totalPrize=allP.reduce((s,p)=>{const m=(p.prize||'').match(/\$([\d,]+)/);return s+(m?parseInt(m[1].replace(/,/g,'')):0)},0);
  h+=`<div style="text-align:center;margin:16px 0 8px">`;
  h+=`<span class="stat-card" style="display:inline-block;padding:8px 16px;margin:0 4px"><span class="sv" style="font-size:16px;color:var(--cyan)">${allP.length}</span><span class="sl"> Ï¥ù ÎåÄÌöå</span></span>`;
  h+=`<span class="stat-card" style="display:inline-block;padding:8px 16px;margin:0 4px"><span class="sv" style="font-size:16px;color:#FFD700">${allP.filter(p=>p.place.includes('1st')).length}üèÜ</span><span class="sl"> Ïö∞Ïäπ</span></span>`;
  h+=`<span class="stat-card" style="display:inline-block;padding:8px 16px;margin:0 4px"><span class="sv" style="font-size:16px;color:var(--win)">$${totalPrize.toLocaleString()}</span><span class="sl"> Ï¥ù ÏÉÅÍ∏à</span></span>`;
  h+=`</div>`;

  if(standingsUpdated)h+=`<div class="standings-updated">ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: ${standingsUpdated}</div>`;
  h+=`</div>`;
  el.innerHTML=h;
}

function filterStandingsYear(yr,btn){
  document.querySelectorAll('.standings-wrap .roster-year-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.standings-year-card').forEach(c=>{
    if(yr==='all')c.style.display='';
    else c.style.display=c.dataset.year===yr?'':'none';
  });
}

// ===== AUTO UPCOMING SCHEDULE UPDATE =====
async function fetchUpcomingSchedule(){
  let matches=[];
  // 0) Try Riot Esports API (official!)
  try{
    const events=await getRiotSchedule();
    const upcoming=events.filter(ev=>ev.state==='unstarted'&&ev.match?.teams?.some(t=>isBLGTeam(t)));
    upcoming.forEach(ev=>{
      const teams=ev.match.teams;
      const isBLG0=isBLGTeam(teams[0]);
      const oppTeam=isBLG0?teams[1]:teams[0];
      const date=ev.startTime?.substring(0,10)||'';
      const time=ev.startTime?new Date(ev.startTime).toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'}):'';
      matches.push({event:ev.league?.name||'VCT CN',stage:ev.blockName||'',date,
        dateLabel:date?`${parseInt(date.substring(5,7))}Ïõî ${parseInt(date.substring(8,10))}Ïùº`:'TBD',
        format:`Bo${ev.match.strategy?.count||3}`,opponent:oppTeam.name,oppTag:oppTeam.code||guessTag(oppTeam.name),
        time:time?time+' KST':''});
    });
  }catch(e){}
  // 1) Try vlresports
  try{
    const d=await proxyFetchJSON('https://vlr.orlandomm.net/api/v1/matches');
    if(d&&Array.isArray(d.data)){
      d.data.forEach(m=>{
        if(!m.teams||m.teams.length<2)return;
        const t1=(m.teams[0].name||'').toLowerCase(),t2=(m.teams[1].name||'').toLowerCase();
        if(t1.includes('bilibili')||t1.includes('blg')||t2.includes('bilibili')||t2.includes('blg')){
          const st=(m.status||'').toLowerCase();
          if(st==='live'||st==='ongoing')return; // skip live
          const opp=t1.includes('bilibili')||t1.includes('blg')?m.teams[1].name:m.teams[0].name;
          matches.push({event:m.event?.name||'VCT',stage:'',date:m.createdAt?.substring(0,10)||'',dateLabel:m.eta||m.createdAt?.substring(0,10)||'',format:'Bo3',opponent:opp,oppTag:guessTag(opp)});
        }
      });
    }
  }catch(e){}
  if(!matches.length)return;
  let newCount=0;
  matches.forEach(m=>{
    const existing=upcomingData.find(u=>u.date===m.date&&u.event===m.event);
    if(!existing){
      newCount++;
      notifyNewSchedule(m.event,m.dateLabel||m.date,m.opponent);
      upcomingData.unshift({event:m.event,stage:m.stage||'',date:m.date,dateLabel:m.dateLabel||m.date,format:m.format||'Bo3',
        opponents:m.opponent?[m.opponent]:[],note:m.time?`${m.time} ÏãúÏûë`:'',confirmed:true,
        groupTeams:m.oppTag?[{name:'BLG',self:true},{name:m.oppTag,self:false}]:[]});
    }
  });
  upcomingData.sort((a,b)=>a.date.localeCompare(b.date));
  if(newCount)renderUpcoming();
}

// ===== PAGE NAVIGATION =====
function switchPage(pg){document.querySelectorAll('.pn-btn').forEach(b=>b.classList.toggle('active',b.dataset.page===pg));document.querySelectorAll('.page-view').forEach(v=>v.classList.toggle('active',v.id==='view-'+pg))}

// ===== SKINS: STATIC DATA =====
let blgSkinData=[];
let skinSyncStatus='idle';
const SKIN_META={
'2024':{price:'1,880 VP',priceDiscount:null,contents:['Classic Ïä§ÌÇ®','Í±¥ Î≤ÑÎîî'],cnRank:'CN 2ÏúÑ',added:'2024-05-14'},
'2025':{price:'2,320 VP',priceDiscount:'1,650 VP (Ïû¨Íµ¨Îß§)',contents:['Classic Ïä§ÌÇ®','Ïï†ÎãàÎ©îÏù¥ÏÖò ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥Îìú','Ïä§ÌîÑÎ†àÏù¥','Í±¥ Î≤ÑÎîî'],cnRank:'CN 2ÏúÑ',added:'2025-01-08'},
'2026':{price:'2,320 VP',priceDiscount:'1,650 VP (Ïû¨Íµ¨Îß§)',contents:['Classic Ïä§ÌÇ®','Ïï†ÎãàÎ©îÏù¥ÏÖò ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥Îìú','Ïä§ÌîÑÎ†àÏù¥','Í±¥ Î≤ÑÎîî'],cnRank:'TBD',added:'2026-01-13'}
};
function getSkinMeta(yr){return SKIN_META[yr]||{price:'2,320 VP',priceDiscount:'1,650 VP (Ïû¨Íµ¨Îß§)',contents:['Classic Ïä§ÌÇ®','ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥Îìú','Ïä§ÌîÑÎ†àÏù¥','Í±¥ Î≤ÑÎîî'],cnRank:'TBD',added:yr+'-01'}}

const STATIC_SKINS=[
{year:'2026',name:'VCT26 x BLG ÌÅ¥ÎûòÏãù',
img:'https://static.wikia.nocookie.net/valorant/images/5/58/VCT26_x_BLG_Classic.png/revision/latest?cb=20260106171511',
bundleImg:'https://static.wikia.nocookie.net/valorant/images/8/8d/Bundle_VCT26_x_BLG.png/revision/latest?cb=20260107150813',
items:[
{label:'üî´ Classic Ïä§ÌÇ®',img:'https://static.wikia.nocookie.net/valorant/images/5/58/VCT26_x_BLG_Classic.png/revision/latest?cb=20260106171511'},
{label:'üÉè ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥Îìú',img:'https://static.wikia.nocookie.net/valorant/images/1/1f/VCT26_x_BLG_Card_Large.png/revision/latest?cb=20260106172255'},
{label:'üí® Ïä§ÌîÑÎ†àÏù¥',img:'https://static.wikia.nocookie.net/valorant/images/4/4f/VCT_x_BLG_Spray.png/revision/latest?cb=20250109150555'},
{label:'üîó Í±¥ Î≤ÑÎîî',img:'https://static.wikia.nocookie.net/valorant/images/2/2e/VCT_x_BLG_Buddy.png/revision/latest?cb=20240514190747'}
],link:'https://valorant.fandom.com/wiki/VCT_x_BLG_Capsule'},
{year:'2025',name:'VCT25 x BLG ÌÅ¥ÎûòÏãù',
img:'https://static.wikia.nocookie.net/valorant/images/1/19/VCT25_x_BLG_Classic.png/revision/latest?cb=20250107193406',
bundleImg:'https://static.wikia.nocookie.net/valorant/images/0/06/Bundle_VCT25_x_BLG.png/revision/latest?cb=20250109150334',
items:[
{label:'üî´ Classic Ïä§ÌÇ®',img:'https://static.wikia.nocookie.net/valorant/images/1/19/VCT25_x_BLG_Classic.png/revision/latest?cb=20250107193406'},
{label:'üÉè ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥Îìú',img:'https://static.wikia.nocookie.net/valorant/images/b/bd/VCT25_x_BLG_Card_Large.png/revision/latest?cb=20250107193011'},
{label:'üí® Ïä§ÌîÑÎ†àÏù¥',img:'https://static.wikia.nocookie.net/valorant/images/4/4f/VCT_x_BLG_Spray.png/revision/latest?cb=20250109150555'},
{label:'üîó Í±¥ Î≤ÑÎîî',img:'https://static.wikia.nocookie.net/valorant/images/2/2e/VCT_x_BLG_Buddy.png/revision/latest?cb=20240514190747'}
],link:'https://valorant.fandom.com/wiki/VCT_x_BLG_Capsule'},
{year:'2024',name:'VCT x BLG ÌÅ¥ÎûòÏãù',
img:'https://static.wikia.nocookie.net/valorant/images/c/c4/VCT_x_BLG_Classic.png/revision/latest?cb=20240514190840',
bundleImg:'https://static.wikia.nocookie.net/valorant/images/0/0d/Bundle_VCT_x_BLG.png/revision/latest?cb=20240515122408',
items:[
{label:'üî´ Classic Ïä§ÌÇ®',img:'https://static.wikia.nocookie.net/valorant/images/c/c4/VCT_x_BLG_Classic.png/revision/latest?cb=20240514190840'},
{label:'üîó Í±¥ Î≤ÑÎîî',img:'https://static.wikia.nocookie.net/valorant/images/2/2e/VCT_x_BLG_Buddy.png/revision/latest?cb=20240514190747'}
],link:'https://valorant.fandom.com/wiki/VCT_x_BLG_Capsule'}
];

async function fetchSkinData(){
  blgSkinData=[...STATIC_SKINS]; // fallback
  skinSyncStatus='static';
  renderSkins();

  // Auto-detect new skins from Fandom Wiki API
  try{
    const FANDOM='https://valorant.fandom.com/api.php';
    const urlMap={};
    const tsMap={}; // filename‚Üítimestamp for release date

    // Method 1: Get images from VCT_x_BLG_Capsule page
    const pgData=await proxyFetchJSON(`${FANDOM}?action=query&titles=VCT_x_BLG_Capsule&prop=images&imlimit=100&format=json`);
    let blgImgs=[];
    if(pgData?.query?.pages){
      const pages=Object.values(pgData.query.pages);
      if(pages[0]?.images) blgImgs=pages[0].images.map(i=>i.title).filter(t=>t.includes('BLG'));
    }

    // Method 2: Also search allimages for VCT*BLG (catches future skins not yet on the page)
    await new Promise(r=>setTimeout(r,500));
    const curYr=String(new Date().getFullYear()).substring(2); // "26","27"...
    const prefixes=['VCT_x_BLG','VCT'+curYr+'_x_BLG','Bundle_VCT'+curYr+'_x_BLG'];
    for(const pfx of prefixes){
      const aiData=await proxyFetchJSON(`${FANDOM}?action=query&list=allimages&aiprefix=${encodeURIComponent(pfx)}&ailimit=20&format=json`);
      if(aiData?.query?.allimages){
        aiData.query.allimages.forEach(img=>{
          const title='File:'+img.name;
          if(title.includes('BLG')&&!blgImgs.includes(title)){blgImgs.push(title);urlMap[img.name]=img.url;}
          if(img.timestamp)tsMap[img.name]=img.timestamp;
        });
      }
      await new Promise(r=>setTimeout(r,300));
    }
    // Also check next year
    const nextYr=String(Number(curYr)+1);
    const aiNext=await proxyFetchJSON(`${FANDOM}?action=query&list=allimages&aiprefix=VCT${nextYr}_x_BLG&ailimit=20&format=json`);
    if(aiNext?.query?.allimages){
      aiNext.query.allimages.forEach(img=>{
        const title='File:'+img.name;
        if(!blgImgs.includes(title)){blgImgs.push(title);urlMap[img.name]=img.url;}
          if(img.timestamp)tsMap[img.name]=img.timestamp;
      });
    }

    if(!blgImgs.length)return;

    // Get actual URLs for page-sourced images (allimages already have URLs)
    const needUrls=blgImgs.filter(t=>{const fn=t.replace('File:','');return!urlMap[fn]});
    for(let i=0;i<needUrls.length;i+=50){
      const batch=needUrls.slice(i,i+50).join('|');
      await new Promise(r=>setTimeout(r,500));
      const imgData=await proxyFetchJSON(`${FANDOM}?action=query&titles=${encodeURIComponent(batch)}&prop=imageinfo&iiprop=url|timestamp&format=json`);
      if(!imgData?.query?.pages)continue;
      Object.values(imgData.query.pages).forEach(p=>{
        if(p.imageinfo&&p.imageinfo[0]?.url){
          const fn=p.title.replace('File:','');
          urlMap[fn]=p.imageinfo[0].url;
          if(p.imageinfo[0].timestamp)tsMap[fn]=p.imageinfo[0].timestamp;
        }
      });
    }

    console.log(`üì° Fandom Wiki: ${Object.keys(urlMap).length}Í∞ú BLG Ïù¥ÎØ∏ÏßÄ Î∞úÍ≤¨`);

    // Group by year
    const yearGroups={};
    const existingYears=new Set(STATIC_SKINS.map(s=>s.year));

    Object.entries(urlMap).forEach(([fname,url])=>{
      let year=null;
      const yrMatch=fname.match(/VCT(\d{2})_x_BLG/i);
      if(yrMatch) year='20'+yrMatch[1];
      else if(fname.match(/^(VCT|Bundle_VCT)_x_BLG/i)) year='2024';
      if(!year)return;

      if(!yearGroups[year])yearGroups[year]={classic:null,bundle:null,card:null,spray:null,buddy:null,banner:null,earliest:null};
      const fl=fname.toLowerCase();
      // Track earliest upload timestamp per year
      const ts=tsMap[fname];
      if(ts&&(!yearGroups[year].earliest||ts<yearGroups[year].earliest))yearGroups[year].earliest=ts;
      if(fl.includes('bundle'))yearGroups[year].bundle=url;
      else if(fl.includes('card'))yearGroups[year].card=url;
      else if(fl.includes('spray'))yearGroups[year].spray=url;
      else if(fl.includes('buddy'))yearGroups[year].buddy=url;
      else if(fl.includes('banner'))yearGroups[year].banner=url;
      else if(fl.includes('classic'))yearGroups[year].classic=url;
    });

    // Build new entries for years not in STATIC_SKINS
    let newCount=0;
    Object.entries(yearGroups).forEach(([yr,imgs])=>{
      if(existingYears.has(yr))return;
      if(!imgs.classic)return;

      const prefix=yr==='2024'?'VCT':'VCT'+yr.substring(2);
      const entry={
        year:yr,
        name:`${prefix} x BLG ÌÅ¥ÎûòÏãù`,
        img:imgs.classic,
        bundleImg:imgs.bundle||imgs.classic,
        items:[{label:'üî´ Classic Ïä§ÌÇ®',img:imgs.classic}],
        link:'https://valorant.fandom.com/wiki/VCT_x_BLG_Capsule',
        _auto:true
      };
      if(imgs.card)entry.items.push({label:'üÉè ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥Îìú',img:imgs.card});
      if(imgs.spray)entry.items.push({label:'üí® Ïä§ÌîÑÎ†àÏù¥',img:imgs.spray});
      if(imgs.buddy)entry.items.push({label:'üîó Í±¥ Î≤ÑÎîî',img:imgs.buddy});
      if(imgs.banner)entry.items.push({label:'üè≥Ô∏è Î∞∞ÎÑà',img:imgs.banner});

      blgSkinData.push(entry);
      // Auto-populate SKIN_META with detected date
      if(imgs.earliest&&!SKIN_META[yr]){
        SKIN_META[yr]={price:'2,320 VP',priceDiscount:'1,650 VP (Ïû¨Íµ¨Îß§)',contents:entry.items.map(i=>i.label.replace(/^.\s*/,'')),cnRank:'TBD',added:imgs.earliest.substring(0,10)};
      }
      newCount++;
      console.log(`‚úÖ Ïã†Í∑ú Ïä§ÌÇ® ÏûêÎèô Í∞êÏßÄ: ${yr} (${entry.items.length}Í∞ú ÏïÑÏù¥ÌÖú)`);
    });

    // Update existing entries with fresh URLs
    blgSkinData.forEach(s=>{
      const g=yearGroups[s.year];
      if(!g)return;
      if(g.classic)s.img=g.classic;
      if(g.bundle)s.bundleImg=g.bundle;
      // Update SKIN_META added date from Fandom timestamp (only if no manual date exists)
      if(g.earliest&&!SKIN_META[s.year])SKIN_META[s.year]={price:'2,320 VP',priceDiscount:'1,650 VP (Ïû¨Íµ¨Îß§)',contents:s.items.map(i=>i.label.replace(/^.\s*/,'')),cnRank:'TBD',added:g.earliest.substring(0,10)};
      // Update item URLs too
      s.items.forEach(item=>{
        const ll=item.label.toLowerCase();
        if(ll.includes('classic')&&g.classic)item.img=g.classic;
        else if(ll.includes('Ïπ¥Îìú')&&g.card)item.img=g.card;
        else if(ll.includes('Ïä§ÌîÑÎ†àÏù¥')&&g.spray)item.img=g.spray;
        else if(ll.includes('Î≤ÑÎîî')&&g.buddy)item.img=g.buddy;
      });
    });

    skinSyncStatus=newCount>0?'auto':'synced';
    renderSkins();
  }catch(e){console.log('Skin auto-detect failed:',e.message)}
}

function toggleSkinCard(id){const card=document.getElementById(id);if(!card)return;const wasOpen=card.classList.contains('open');document.querySelectorAll('.skin-card.open').forEach(c=>{if(c.id!==id)c.classList.remove('open')});card.classList.toggle('open')}

function renderSkins(){const wrap=document.getElementById('skinsWrap');
const sorted=[...blgSkinData].sort((a,b)=>parseInt(b.year)-parseInt(a.year));
const maxYear=sorted.length?parseInt(sorted[0].year):0;
let syncHTML='';
if(skinSyncStatus==='auto')syncHTML=`<div class="skins-sync"><span class="ss-dot done" style="background:var(--cyan)"></span>${blgSkinData.length}Í∞ú Ï∫°Ïäê ¬∑ üì° Fandom Wiki ÏûêÎèô Í∞êÏßÄ</div>`;
else if(skinSyncStatus==='synced')syncHTML=`<div class="skins-sync"><span class="ss-dot done"></span>${blgSkinData.length}Í∞ú Ï∫°Ïäê ¬∑ Fandom Wiki ‚úì</div>`;
else if(skinSyncStatus==='static')syncHTML=`<div class="skins-sync"><span class="ss-dot done"></span>${blgSkinData.length}Í∞ú Ï∫°Ïäê ¬∑ Fandom Wiki</div>`;
else syncHTML='';

let h=`<div class="skins-title">BLG TEAM CLASSIC SKINS</div><div class="skins-sub">Îß§ÎÖÑ Î∞úÎß§ÎêòÎäî VCT ÌåÄ Ï∫°Ïäê ‚Äî Classic Ïä§ÌÇ® Ïª¨Î†âÏÖò</div>${syncHTML}<div class="skins-grid">`;
sorted.forEach(s=>{
const isCurrent=parseInt(s.year)===maxYear;
const cid='skincard_'+s.year;
const meta=getSkinMeta(s.year);
h+=`<div class="skin-card ${isCurrent?'latest':''}" id="${cid}">
<div class="skin-header" onclick="toggleSkinCard('${cid}')">
<div class="skin-year">${s.year}</div>
<div class="skin-hright">
<span class="skin-badge ${isCurrent?'current':'past'}">${isCurrent?'ON SALE':'ARCHIVED'}</span>
<span class="skin-arrow">‚ñº</span>
</div></div>
<div class="skin-preview">
<div class="skin-img-wrap"><img src="${s.bundleImg||s.img}" alt="${s.name}" loading="lazy" onerror="this.src='${s.img}';this.onerror=null"></div>
<div class="skin-info">
<div class="skin-name">${s.name}</div>
<div class="skin-detail">${meta.contents.map(c=>'¬∑ '+c).join('<br>')}</div>
<div class="skin-tags">
<span class="sk-tag price">üí∞ ${meta.price}</span>
${meta.priceDiscount?`<span class="sk-tag price">üîÅ ${meta.priceDiscount}</span>`:''}
${meta.cnRank?`<span class="sk-tag rank">üèÜ ${meta.cnRank}</span>`:''}
<span class="sk-tag contents">üìÖ ${meta.added}</span>
</div></div></div>
<div class="skin-expand"><div class="skin-detail-inner">
<div class="item-label">üì¶ Ï∫°Ïäê Íµ¨ÏÑ±Ìíà</div>
<div class="items-grid">${s.items.map(it=>`<div class="item-cell">
<div class="item-img-box"><img src="${it.img}" alt="${it.label}" loading="lazy" onerror="this.parentElement.innerHTML='<div class=item-placeholder>Ïù¥ÎØ∏ÏßÄ ÏóÜÏùå</div>'"></div>
<div class="item-name">${it.label}</div></div>`).join('')}</div>
<a href="${s.link}" target="_blank" class="skin-link">üîó Valorant WikiÏóêÏÑú ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ ‚Üí</a>
</div></div></div>`;
});
h+='</div>';wrap.innerHTML=h}

// ===== LIVE FETCH =====
async function fetchLiveData(){const dot=document.getElementById('liveDot'),txt=document.getElementById('liveText'),btn=document.getElementById('refreshBtn'),ico=document.getElementById('refreshIcon');dot.className='live-dot loading';txt.textContent='ÏµúÏã† Í≤ΩÍ∏∞ Îç∞Ïù¥ÌÑ∞ Í≤ÄÏÉâ Ï§ë...';btn.disabled=true;ico.innerHTML='<span class="spin-i">‚Üª</span>';
let syncCount=0;
// 0) Try Riot Esports API (official data!)
try{
  const events=await getRiotSchedule(true);
  const blgMatches=events.filter(ev=>ev.state==='completed'&&ev.match?.teams?.some(t=>isBLGTeam(t)));
  blgMatches.forEach(ev=>{
    const teams=ev.match.teams;
    const isBLG0=isBLGTeam(teams[0]);
    const blgTeam=isBLG0?teams[0]:teams[1];
    const oppTeam=isBLG0?teams[1]:teams[0];
    const bs=blgTeam.result?.gameWins||0;
    const os=oppTeam.result?.gameWins||0;
    const date=ev.startTime?.substring(0,10)||'';
    const yr=date.substring(0,4);
    if(!yr)return;
    const oppTag=oppTeam.code||guessTag(oppTeam.name);
    const tn=`VCT 2025: China ${ev.tournament?.split?.name||'Stage 1'}`;
    if(!allData[yr])allData[yr]=[];
    let tg=allData[yr].find(t=>t.tournament.includes('China')&&t.tournament.includes(yr.substring(2)));
    if(!tg){tg={tournament:tn,intl:false,matches:[]};allData[yr].unshift(tg)}
    const ex=tg.matches.some(x=>x.date===date&&x.tag===oppTag);
    if(!ex){tg.matches.push({date,opp:oppTeam.name,tag:oppTag,stage:ev.blockName||'',fmt:`Bo${ev.match.strategy?.count||3}`,bs,os,r:bs>os?'win':'loss',maps:[]});syncCount++}
  });
}catch(e){}
// 1) Try vlresports for recent results
try{
  const d=await proxyFetchJSON('https://vlr.orlandomm.net/api/v1/results');
  if(d&&Array.isArray(d.data)){
    d.data.forEach(m=>{
      if(!m.teams||m.teams.length<2)return;
      const t1=(m.teams[0].name||'').toLowerCase(),t2=(m.teams[1].name||'').toLowerCase();
      if(t1.includes('bilibili')||t1.includes('blg')||t2.includes('bilibili')||t2.includes('blg')){
        const isBLG1=t1.includes('bilibili')||t1.includes('blg');
        const opp=isBLG1?m.teams[1].name:m.teams[0].name;const oppTag=guessTag(opp);
        const bs=parseInt(isBLG1?m.teams[0].score:m.teams[1].score)||0;
        const os=parseInt(isBLG1?m.teams[1].score:m.teams[0].score)||0;
        const yr=m.createdAt?m.createdAt.substring(0,4):String(new Date().getFullYear());
        const tn=m.event?.name||'VCT';
        if(!allData[yr])allData[yr]=[];
        let tg=allData[yr].find(t=>t.tournament===tn);
        if(!tg){tg={tournament:tn,intl:false,matches:[]};allData[yr].unshift(tg)}
        const dt=m.createdAt?m.createdAt.substring(0,10):'';
        const ex=tg.matches.some(x=>x.date===dt&&x.tag===oppTag);
        if(!ex){tg.matches.push({date:dt,opp,tag:oppTag,stage:'',fmt:'Bo3',bs,os,r:bs>os?'win':'loss',maps:[]});syncCount++}
      }
    });
  }
}catch(e){}
dot.className='live-dot';txt.textContent=`ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: ${new Date().toLocaleTimeString('ko-KR')} ¬∑ ${syncCount>0?syncCount+'Í∞ú ÎèôÍ∏∞Ìôî':'Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©'}`;renderAll();
btn.disabled=false;ico.innerHTML='‚Üª'}

renderAll();
fetchLiveData().then(()=>setInterval(fetchLiveData,5*60*1000));
fetchSkinData();
// Live match detection: check every 60s (Riot Esports API)
checkLiveMatch();setInterval(checkLiveMatch,60000);
// Bilibili VOD auto-check: once at load + every 10min
setTimeout(checkNewBiliVods,5000);setInterval(checkNewBiliVods,10*60*1000);
// Roster: fetch once at load (with cache fallback)
setTimeout(fetchRoster,2000);
// Transfers: fetch from Liquipedia (delayed to respect rate limit)
setTimeout(fetchTransfers,8000);

// Standings: fetch at load + every 10min
setTimeout(fetchStandings,4000);setInterval(fetchStandings,10*60*1000);
// Upcoming schedule: fetch at load + every 10min
setTimeout(fetchUpcomingSchedule,6000);setInterval(fetchUpcomingSchedule,10*60*1000);
</script>

<!-- VOD MODAL -->
<div class="vod-overlay" id="vodOverlay" onclick="if(event.target===this)closeVod()">
  <div class="vod-modal">
    <div class="vod-modal-header">
      <div class="vod-modal-title"><span class="vod-icon">üì∫</span><span id="vodTitle">VOD</span></div>
      <button class="vod-close" onclick="closeVod()">‚úï</button>
    </div>
    <div class="vod-body" id="vodBody">
      <div class="vod-loading" id="vodLoading">
        <div class="vod-spinner"></div>
        <span>VOD Í≤ÄÏÉâ Ï§ë...</span>
      </div>
    </div>
    <div class="vod-match-info">
      <span class="vod-match-label" id="vodMatchLabel"></span>
      <div class="vod-links">
        <a href="#" target="_blank" class="vod-yt-link" id="vodYtLink" style="display:none">‚ñ∂ YouTube</a>
        <a href="#" target="_blank" class="vod-bili-link" id="vodBiliLink" style="display:none">‚ñ∂ Bilibili</a>
      </div>
    </div>
  </div>
</div>

<script>
// ===== VOD PLAYER (YouTube + Bilibili) =====
const vodCache={};
let currentVodPlatform='yt'; // 'yt' or 'bili'

function openVod(queryEnc, label, directBvid){
  const overlay=document.getElementById('vodOverlay');
  const body=document.getElementById('vodBody');
  const title=document.getElementById('vodTitle');
  const matchLabel=document.getElementById('vodMatchLabel');
  const ytLink=document.getElementById('vodYtLink');
  const biliLink=document.getElementById('vodBiliLink');

  title.textContent='VOD Í≤ÄÏÉâ Ï§ë...';
  matchLabel.textContent=label;
  ytLink.style.display='none';
  biliLink.style.display='none';
  body.innerHTML=`<div class="vod-loading"><div class="vod-spinner"></div><span>YouTube + BilibiliÏóêÏÑú VOD Í≤ÄÏÉâ Ï§ë...</span></div>`;
  overlay.classList.add('active');
  document.body.style.overflow='hidden';

  const query=decodeURIComponent(queryEnc);

  // If direct bilibili BV ID provided, show it immediately
  if(directBvid){
    const result={bvid:directBvid, biliTitle:label};
    // Still try to find YouTube via API, but show Bilibili immediately
    vodCache[query]=result;
    showVodResult(result, query);
    // Also search for YouTube in background
    searchVod(query).then(apiResult=>{
      if(apiResult && apiResult.videoId){
        result.videoId=apiResult.videoId;
        result.videoTitle=apiResult.videoTitle;
        vodCache[query]=result;
        const ytLink2=document.getElementById('vodYtLink');
        ytLink2.href=`https://www.youtube.com/watch?v=${result.videoId}`;
        ytLink2.style.display='flex';
      }
    }).catch(()=>{});
    return;
  }

  if(vodCache[query]){
    showVodResult(vodCache[query], query);
    return;
  }

  searchVod(query).then(result=>{
    if(result && (result.videoId || result.bvid)){
      vodCache[query]=result;
      showVodResult(result, query);
    } else {
      showVodFallback(query);
    }
  }).catch(()=>showVodFallback(query));
}

function showVodResult(result, query){
  const ytLink=document.getElementById('vodYtLink');
  const biliLink=document.getElementById('vodBiliLink');

  if(result.videoId){
    ytLink.href=`https://www.youtube.com/watch?v=${result.videoId}`;
    ytLink.style.display='flex';
  }
  if(result.bvid){
    biliLink.href=`https://www.bilibili.com/video/${result.bvid}`;
    biliLink.style.display='flex';
  }

  // Default: prefer Bilibili for VOD replays
  if(result.bvid){
    embedBilibili(result.bvid, result.biliTitle||query);
  } else if(result.videoId){
    embedYoutube(result.videoId, result.videoTitle||query);
  }
}

function embedYoutube(videoId, videoTitle){
  const body=document.getElementById('vodBody');
  const title=document.getElementById('vodTitle');
  currentVodPlatform='yt';
  title.textContent=videoTitle||'VOD';
  body.innerHTML=`<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0" allow="autoplay; encrypted-media; picture-in-picture"></iframe>`;
}

function embedBilibili(bvid, biliTitle){
  const body=document.getElementById('vodBody');
  const title=document.getElementById('vodTitle');
  currentVodPlatform='bili';
  title.textContent=biliTitle||'VOD (Bilibili)';
  
  // First show player with p=1, then fetch part list
  body.innerHTML=`<iframe id="biliFrame" src="https://player.bilibili.com/player.html?bvid=${bvid}&page=1&autoplay=1&high_quality=1&danmaku=0" allow="autoplay; fullscreen" scrolling="no" frameborder="0" style="width:100%;height:100%;border:0"></iframe>`;
  
  // Fetch video info to get part count
  fetchBiliParts(bvid);
}

async function fetchBiliParts(bvid){
  try{
    const d=await proxyFetchJSON(`https://api.bilibili.com/x/web-interface/view?bvid=${bvid}`);
    if(!d||!d.data||!d.data.pages||d.data.pages.length<=1)return;
    
    const pages=d.data.pages;
    const body=document.getElementById('vodBody');
    
    // Add part selector below the iframe
    let partHtml=`<div class="bili-parts" id="biliParts">`;
    partHtml+=`<div class="bili-parts-label">üìã ÌååÌä∏ ÏÑ†ÌÉù (${pages.length}Í∞ú)</div>`;
    partHtml+=`<div class="bili-parts-list">`;
    pages.forEach((p,i)=>{
      const active=i===0?'active':'';
      const dur=p.duration?`${Math.floor(p.duration/60)}:${String(p.duration%60).padStart(2,'0')}`:'';
      partHtml+=`<button class="bili-part-btn ${active}" onclick="switchBiliPart('${bvid}',${i+1},this)" title="${p.part||''}">${p.part||`Part ${i+1}`}${dur?' ¬∑ '+dur:''}</button>`;
    });
    partHtml+=`</div>`;
    partHtml+=`<div style="display:flex;justify-content:center;padding:6px 0 0"><a href="https://www.bilibili.com/video/${bvid}" target="_blank" rel="noopener" style="font-size:11px;color:#00a1d6;text-decoration:none">üÖ± BÁ´ôÏóêÏÑú Ïó¥Í∏∞ (ÎåìÍ∏Ä/ÌÉÑÎßâ)</a></div>`;
    partHtml+=`</div>`;
    
    // Insert after vod-body (inside vod-modal, below the player)
    const existing=document.getElementById('biliParts');
    if(existing) existing.remove();
    body.parentElement.insertBefore(createEl(partHtml), body.nextSibling);
  }catch(e){}
}

function createEl(html){
  const div=document.createElement('div');
  div.innerHTML=html;
  return div.firstElementChild;
}

function switchBiliPart(bvid, page, btn){
  const frame=document.getElementById('biliFrame');
  if(frame) frame.src=`https://player.bilibili.com/player.html?bvid=${bvid}&page=${page}&autoplay=1&high_quality=1&danmaku=0`;
  // Update active button
  document.querySelectorAll('.bili-part-btn').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
}

async function searchVod(query){
  try{
    // Search Bilibili directly for VODs
    const kw=encodeURIComponent(query.replace(/bilibili gaming/i,'BLG').replace(/VALORANT/i,'Êó†ÁïèÂ•ëÁ∫¶'));
    const d=await proxyFetchJSON(`https://api.bilibili.com/x/web-interface/search/type?search_type=video&keyword=${kw}&order=totalrank&duration=4`);
    let result={videoId:null,videoTitle:null,bvid:null,biliTitle:null};
    if(d&&d.data&&d.data.result){
      const vid=d.data.result.find(v=>v.bvid&&(v.title.includes('BLG')||v.title.includes('ÂìîÂì©ÂìîÂì©')));
      if(vid){result.bvid=vid.bvid;result.biliTitle=vid.title.replace(/<[^>]+>/g,'');}
    }
    // Also try official channel search
    if(!result.bvid){
      const d2=await proxyFetchJSON(`https://api.bilibili.com/x/space/arc/search?mid=2071691173&ps=5&keyword=${encodeURIComponent(query.replace(/bilibili gaming/i,'BLG'))}&order=pubdate`);
      if(d2&&d2.data&&d2.data.list&&d2.data.list.vlist){
        const vid=d2.data.list.vlist[0];
        if(vid){result.bvid=vid.bvid;result.biliTitle=vid.title;}
      }
    }
    if(result.bvid)return result;
    return null;
  }catch(e){
    console.error('VOD search error:',e);
    return null;
  }
}

function showVodFallback(query){
  const body=document.getElementById('vodBody');
  const title=document.getElementById('vodTitle');
  const ytLink=document.getElementById('vodYtLink');
  const biliLink=document.getElementById('vodBiliLink');
  const ytSearch=`https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`;
  // Extract team/date for better Bilibili search
  const matchTeam=(query.match(/BLG vs (\w+)/)||[])[1]||'';
  const matchDate=(query.match(/(\d{4}-\d{2}-\d{2})/)||[])[1]||'';
  const biliQ=matchTeam&&matchDate?getBiliSearchUrl(matchTeam,matchDate,''):`https://search.bilibili.com/all?keyword=${encodeURIComponent('Êó†ÁïèÂ•ëÁ∫¶ BLG Êó†ÁïèÂ•ëÁ∫¶Ëµõ‰∫ã')}`;

  title.textContent='VODÎ•º Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§';
  body.innerHTML=`<div class="vod-loading"><div class="vod-error">
    <p style="margin-bottom:16px;color:#8585a8">ÏûêÎèô Í≤ÄÏÉâÏúºÎ°ú VODÎ•º Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§.</p>
    <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
      <a href="${ytSearch}" target="_blank" style="color:#ff6b6b;font-size:13px;padding:8px 16px;border:1px solid rgba(255,0,0,.2);border-radius:8px;text-decoration:none;background:rgba(255,0,0,.05)">‚ñ∂ YouTubeÏóêÏÑú Í≤ÄÏÉâ</a>
      <a href="${biliQ}" target="_blank" style="color:#00a1d6;font-size:13px;padding:8px 16px;border:1px solid rgba(0,161,214,.2);border-radius:8px;text-decoration:none;background:rgba(0,161,214,.05)">‚ñ∂ BilibiliÏóêÏÑú Í≤ÄÏÉâ</a>
    </div>
  </div></div>`;
  ytLink.href=ytSearch;
  ytLink.style.display='flex';
  biliLink.href=biliQ;
  biliLink.style.display='flex';
}

function closeVod(){
  const overlay=document.getElementById('vodOverlay');
  const body=document.getElementById('vodBody');
  overlay.classList.remove('active');
  document.body.style.overflow='';
  body.innerHTML='';
  const parts=document.getElementById('biliParts');
  if(parts) parts.remove();
}

// ESC key to close
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeVod()});
</script>
</body>
</html>
